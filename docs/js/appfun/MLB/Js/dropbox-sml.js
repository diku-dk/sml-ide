if ((typeof(appfun2$0dropbox$1)) == "undefined") {appfun2$0dropbox$1 = {};
};
(function(){appfun2$0dropbox$1.client$65 = function(client_id$68){return ["https://www.dropbox.com/oauth2/authorize",client_id$68,"http://localhost:8000"];
};
appfun2$0dropbox$1.authorize$69 = function(c$72){return oauth$0oauth$1.authorize$246(c$72[0],c$72[1],c$72[2]);
};
appfun2$0dropbox$1.isAuthorized$73 = function(c$76){switch ((oauth$0oauth$1.token$167(c$76[0],c$76[1],c$76[2]))[0]) { case 0: {return true;
 break; }default: {return false;
} };
};
appfun2$0dropbox$1.signOut$82 = function(c$85,f$88){return oauth$0oauth$1.logout$274(c$85[0],c$85[1],c$85[2]);
};
var postRequestAsync$135 = function(url$138,headers$141,data$144,cont$147){var r$148 = SmlPrims.newRequest();
(function(r,m,u,a){return r.open(m,u,a);})(r$148,"POST",url$138,true);
var fix$858 = {};
fix$858.$app = function(v$562){lab$app: while (true) {if (v$562 == null) {return 0;
} else {var v$563 = v$562;
var v$564 = v$563[0];
var v$565 = v$563[1];
(function(r,k,v){return r.setRequestHeader(k,v);})(r$148,v$564[0],v$564[1]);
var t$859 = v$565;
var v$562 = t$859;
continue lab$app;
};
};
};
var app$561 = fix$858.$app;
app$561(headers$141);
(function(r,f){r.onreadystatechange = f;})(r$148,function(v$154){if (((function(r){return r.readyState;})(r$148)) >= 4) {var v$163 = (function(r){return SmlPrims.option(r.responseText);})(r$148);
switch (v$163[0]) { case 0: {var v$165 = v$163[1];
return cont$147(v$165);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"dropbox.postRequestAsync failed: " + url$138];
} };
} else {return 0;
};
});
return js$0Js$1.send$654(r$148,[0,data$144]);
};
appfun2$0dropbox$1.dropboxUid$186 = function(c$189,cont$192){var t$864 = postRequestAsync$135;
var t$863 = "https://api.dropboxapi.com/2/users/get_current_account";
var t$862;
var t$861 = basis$0List$1.s$n$686;
var t$860;
var v$580 = oauth$0oauth$1.token$167(c$189[0],c$189[1],c$189[2]);
switch (v$580[0]) { case 0: {t$860 = [["Authorization","Bearer " + v$580[1]],null];
 break; }default: {t$860 = null;
} };
t$862 = (t$861(t$860,[["Content-Type","application/json; charset=utf-8"],null]));
return t$864(t$863,t$862,"null",function(res$197){var v$202 = json$0json$1.fromString$853(res$197);
switch (v$202[0]) { case 2: {var v$226 = v$202[1];
var v$209 = json$0json$1.objLook$98(v$226,"name");
switch (v$209[0]) { case 0: {var v$211 = v$209[1];
switch (v$211[0]) { case 2: {var v$224 = v$211[1];
var v$218 = json$0json$1.objLook$98(v$224,"display_name");
switch (v$218[0]) { case 0: {var v$220 = v$218[1];
switch (v$220[0]) { case 0: {var v$222 = v$220[1];
return cont$192(v$222);
 break; }default: {return cont$192("noname1");
} };
 break; }default: {return cont$192("noname1");
} };
 break; }default: {return cont$192("noname2");
} };
 break; }default: {return cont$192("noname2");
} };
 break; }default: {return cont$192("noname3");
} };
});
};
appfun2$0dropbox$1.filestore$227 = function(c$230){return c$230;
};
appfun2$0dropbox$1.all_files$231 = function(fs$234,cont$237){var data$238 = [["path",[0,""]],[["recursive",[5,true]],null]];
var data$239 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$238)]);
var t$869 = postRequestAsync$135;
var t$868 = "https://api.dropboxapi.com/2/files/list_folder";
var t$867;
var t$866 = basis$0List$1.s$n$686;
var t$865;
var v$596 = oauth$0oauth$1.token$167(fs$234[0],fs$234[1],fs$234[2]);
switch (v$596[0]) { case 0: {t$865 = [["Authorization","Bearer " + v$596[1]],null];
 break; }default: {t$865 = null;
} };
t$867 = (t$866(t$865,[["Content-Type","application/json; charset=utf-8"],null]));
return t$869(t$868,t$867,data$239,function(res$599){var filenames$600;
var v$601 = json$0json$1.fromString$853(res$599);
switch (v$601[0]) { case 2: {var v$602 = v$601[1];
var v$603 = json$0json$1.objLook$98(v$602,"entries");
switch (v$603[0]) { case 0: {var v$604 = v$603[1];
switch (v$604[0]) { case 6: {var v$605 = v$604[1];
filenames$600 = (basis$0List$1.map$697(function(v$606){switch (v$606[0]) { case 2: {var v$607 = v$606[1];
var v$608 = json$0json$1.objLook$98(v$607,"path_display");
switch (v$608[0]) { case 0: {var v$609 = v$608[1];
switch (v$609[0]) { case 0: {return "Dropbox" + v$609[1];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.no path_display"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.no path_display"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.expecting obj"];
} };
},v$605));
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.expecing array"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.expecing array"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.expecting obj2"];
} };
return cont$237(filenames$600);
});
};
appfun2$0dropbox$1.content$289 = function(fs$292,f$295,cont$298){var data$299;
var t$877;
var t$876;
var t$875 = "path";
var t$874;
var t$873;
var t$870;
var n2$624 = f$295.length;
var stop$625 = (8 < n2$624)?8:n2$624;
var fix$871 = {};
fix$871.$h = function(j$627){lab$h: while (true) {if (j$627 == stop$625) {return true;
} else {if (("Dropbox/".charCodeAt(j$627)) == (f$295.charCodeAt(j$627))) {var t$872 = SmlPrims.chk_ovf_i32(j$627 + 1);
var j$627 = t$872;
continue lab$h;
} else {return false;
};
};
};
};
var h$626 = fix$871.$h;
t$870 = ((8 <= n2$624)?(h$626(0)):false);
t$873 = (t$870?(basis$0String$1.extract$116(f$295,7,[1])):f$295);
t$874 = [0,t$873];
t$876 = [t$875,t$874];
t$877 = [t$876,null];
data$299 = t$877;
var data$300 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$299)]);
var hs$301;
var t$879 = basis$0List$1.s$n$686;
var t$878;
var v$629 = oauth$0oauth$1.token$167(fs$292[0],fs$292[1],fs$292[2]);
switch (v$629[0]) { case 0: {t$878 = [["Authorization","Bearer " + v$629[1]],null];
 break; }default: {t$878 = null;
} };
hs$301 = (t$879(t$878,[["Dropbox-API-Arg",data$300],[["Content-Type","text/plain"],null]]));
return postRequestAsync$135("https://content.dropboxapi.com/2/files/download",hs$301,"",cont$298);
};
appfun2$0dropbox$1.write_file$302 = function(fs$305,f$308,content$311,cont$314){var data$315;
var t$887;
var t$886;
var t$885 = "path";
var t$884;
var t$883;
var t$880;
var n2$639 = f$308.length;
var stop$640 = (8 < n2$639)?8:n2$639;
var fix$881 = {};
fix$881.$h = function(j$642){lab$h: while (true) {if (j$642 == stop$640) {return true;
} else {if (("Dropbox/".charCodeAt(j$642)) == (f$308.charCodeAt(j$642))) {var t$882 = SmlPrims.chk_ovf_i32(j$642 + 1);
var j$642 = t$882;
continue lab$h;
} else {return false;
};
};
};
};
var h$641 = fix$881.$h;
t$880 = ((8 <= n2$639)?(h$641(0)):false);
t$883 = (t$880?(basis$0String$1.extract$116(f$308,7,[1])):f$308);
t$884 = [0,t$883];
t$886 = [t$885,t$884];
t$887 = [t$886,[["mode",[0,"overwrite"]],null]];
data$315 = t$887;
var data$316 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$315)]);
var hs$317;
var t$889 = basis$0List$1.s$n$686;
var t$888;
var v$645 = oauth$0oauth$1.token$167(fs$305[0],fs$305[1],fs$305[2]);
switch (v$645[0]) { case 0: {t$888 = [["Authorization","Bearer " + v$645[1]],null];
 break; }default: {t$888 = null;
} };
hs$317 = (t$889(t$888,[["Dropbox-API-Arg",data$316],[["Content-Type","application/octet-stream"],null]]));
return postRequestAsync$135("https://content.dropboxapi.com/2/files/upload",hs$317,content$311,function(res$653){var msg$654;
var v$655 = json$0json$1.fromString$853(res$653);
switch (v$655[0]) { case 2: {var v$656 = v$655[1];
var v$657 = json$0json$1.objLook$98(v$656,"size");
switch (v$657[0]) { case 0: {var v$658 = v$657[1];
switch (v$658[0]) { case 3: {msg$654 = (v$658[1] + " bytes");
 break; }default: {msg$654 = "expecting number";
} };
 break; }default: {msg$654 = "expecting number";
} };
 break; }default: {msg$654 = "expecting object";
} };
return cont$314([msg$654]);
});
};
appfun2$0dropbox$1.mkdir$341 = function(fs$344,d$347,cont$350){var hs$351;
var t$891 = basis$0List$1.s$n$686;
var t$890;
var v$662 = oauth$0oauth$1.token$167(fs$344[0],fs$344[1],fs$344[2]);
switch (v$662[0]) { case 0: {t$890 = [["Authorization","Bearer " + v$662[1]],null];
 break; }default: {t$890 = null;
} };
hs$351 = (t$891(t$890,[["Content-Type","application/json"],null]));
var data$352;
var t$899;
var t$898;
var t$897 = "path";
var t$896;
var t$895;
var t$892;
var n2$671 = d$347.length;
var stop$672 = (8 < n2$671)?8:n2$671;
var fix$893 = {};
fix$893.$h = function(j$674){lab$h: while (true) {if (j$674 == stop$672) {return true;
} else {if (("Dropbox/".charCodeAt(j$674)) == (d$347.charCodeAt(j$674))) {var t$894 = SmlPrims.chk_ovf_i32(j$674 + 1);
var j$674 = t$894;
continue lab$h;
} else {return false;
};
};
};
};
var h$673 = fix$893.$h;
t$892 = ((8 <= n2$671)?(h$673(0)):false);
t$895 = (t$892?(basis$0String$1.extract$116(d$347,7,[1])):d$347);
t$896 = [0,t$895];
t$898 = [t$897,t$896];
t$899 = [t$898,null];
data$352 = t$899;
var data$353 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$352)]);
return postRequestAsync$135("https://api.dropboxapi.com/2/files/create_folder_v2",hs$351,data$353,function(res$680){var msg$681;
var v$682 = json$0json$1.fromString$853(res$680);
switch (v$682[0]) { case 2: {var v$683 = v$682[1];
var v$684 = json$0json$1.objLook$98(v$683,"metadata");
switch (v$684[0]) { case 0: {var v$685 = v$684[1];
switch (v$685[0]) { case 2: {var v$686 = v$685[1];
var v$687 = json$0json$1.objLook$98(v$686,"name");
switch (v$687[0]) { case 0: {var v$688 = v$687[1];
switch (v$688[0]) { case 0: {msg$681 = ("name " + v$688[1]);
 break; }default: {msg$681 = "expecting string";
} };
 break; }default: {msg$681 = "expecting string";
} };
 break; }default: {msg$681 = "expecting object";
} };
 break; }default: {msg$681 = "expecting object";
} };
 break; }default: {msg$681 = "expecting object0";
} };
return cont$350([msg$681]);
});
};
appfun2$0dropbox$1.delete_file$388 = function(fs$391,f$394,cont$397){var hs$398;
var t$901 = basis$0List$1.s$n$686;
var t$900;
var v$692 = oauth$0oauth$1.token$167(fs$391[0],fs$391[1],fs$391[2]);
switch (v$692[0]) { case 0: {t$900 = [["Authorization","Bearer " + v$692[1]],null];
 break; }default: {t$900 = null;
} };
hs$398 = (t$901(t$900,[["Content-Type","application/json"],null]));
var data$399;
var t$909;
var t$908;
var t$907 = "path";
var t$906;
var t$905;
var t$902;
var n2$701 = f$394.length;
var stop$702 = (8 < n2$701)?8:n2$701;
var fix$903 = {};
fix$903.$h = function(j$704){lab$h: while (true) {if (j$704 == stop$702) {return true;
} else {if (("Dropbox/".charCodeAt(j$704)) == (f$394.charCodeAt(j$704))) {var t$904 = SmlPrims.chk_ovf_i32(j$704 + 1);
var j$704 = t$904;
continue lab$h;
} else {return false;
};
};
};
};
var h$703 = fix$903.$h;
t$902 = ((8 <= n2$701)?(h$703(0)):false);
t$905 = (t$902?(basis$0String$1.extract$116(f$394,7,[1])):f$394);
t$906 = [0,t$905];
t$908 = [t$907,t$906];
t$909 = [t$908,null];
data$399 = t$909;
var data$400 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$399)]);
return postRequestAsync$135("https://api.dropboxapi.com/2/files/delete_v2",hs$398,data$400,function(res$716){var msg$717;
var v$718 = json$0json$1.fromString$853(res$716);
switch (v$718[0]) { case 2: {var v$719 = v$718[1];
var v$720 = json$0json$1.objLook$98(v$719,"metadata");
switch (v$720[0]) { case 0: {var v$721 = v$720[1];
switch (v$721[0]) { case 2: {var v$722 = v$721[1];
var v$723 = json$0json$1.objLook$98(v$722,"name");
switch (v$723[0]) { case 0: {var v$724 = v$723[1];
switch (v$724[0]) { case 0: {var v$725 = v$724[1];
var v$726 = json$0json$1.objLook$98(v$722,".tag");
switch (v$726[0]) { case 0: {var v$727 = v$726[1];
switch (v$727[0]) { case 0: {msg$717 = ((v$727[1] + " ") + v$725);
 break; }default: {msg$717 = ("name " + v$725);
} };
 break; }default: {msg$717 = ("name " + v$725);
} };
 break; }default: {msg$717 = "expecting string";
} };
 break; }default: {msg$717 = "expecting string";
} };
 break; }default: {msg$717 = "expecting object";
} };
 break; }default: {msg$717 = "expecting object";
} };
 break; }default: {msg$717 = "expecting object0";
} };
return cont$397([msg$717]);
});
};
appfun2$0dropbox$1.delete_dir$446 = function(fs$449,d$452,cont$455){return appfun2$0dropbox$1.delete_file$388(fs$449,d$452,cont$455);
};
appfun2$0dropbox$1.move_file$456 = function(fs$459,f$462,fnew$465,cont$468){var hs$469;
var t$911 = basis$0List$1.s$n$686;
var t$910;
var v$734 = oauth$0oauth$1.token$167(fs$459[0],fs$459[1],fs$459[2]);
switch (v$734[0]) { case 0: {t$910 = [["Authorization","Bearer " + v$734[1]],null];
 break; }default: {t$910 = null;
} };
hs$469 = (t$911(t$910,[["Content-Type","application/json"],null]));
var data$470;
var t$928;
var t$927;
var t$926 = "from_path";
var t$925;
var t$924;
var t$921;
var n2$743 = f$462.length;
var stop$744 = (8 < n2$743)?8:n2$743;
var fix$922 = {};
fix$922.$h = function(j$746){lab$h: while (true) {if (j$746 == stop$744) {return true;
} else {if (("Dropbox/".charCodeAt(j$746)) == (f$462.charCodeAt(j$746))) {var t$923 = SmlPrims.chk_ovf_i32(j$746 + 1);
var j$746 = t$923;
continue lab$h;
} else {return false;
};
};
};
};
var h$745 = fix$922.$h;
t$921 = ((8 <= n2$743)?(h$745(0)):false);
t$924 = (t$921?(basis$0String$1.extract$116(f$462,7,[1])):f$462);
t$925 = [0,t$924];
t$927 = [t$926,t$925];
var t$920;
var t$919;
var t$918;
var t$917 = "to_path";
var t$916;
var t$915;
var t$912;
var n2$752 = fnew$465.length;
var stop$753 = (8 < n2$752)?8:n2$752;
var fix$913 = {};
fix$913.$h = function(j$755){lab$h: while (true) {if (j$755 == stop$753) {return true;
} else {if (("Dropbox/".charCodeAt(j$755)) == (fnew$465.charCodeAt(j$755))) {var t$914 = SmlPrims.chk_ovf_i32(j$755 + 1);
var j$755 = t$914;
continue lab$h;
} else {return false;
};
};
};
};
var h$754 = fix$913.$h;
t$912 = ((8 <= n2$752)?(h$754(0)):false);
t$915 = (t$912?(basis$0String$1.extract$116(fnew$465,7,[1])):fnew$465);
t$916 = [0,t$915];
t$918 = [t$917,t$916];
t$919 = [t$918,null];
t$920 = t$919;
t$928 = [t$927,t$920];
data$470 = t$928;
var data$471 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$470)]);
return postRequestAsync$135("https://api.dropboxapi.com/2/files/move_v2",hs$469,data$471,function(res$767){var msg$768;
var v$769 = json$0json$1.fromString$853(res$767);
switch (v$769[0]) { case 2: {var v$770 = v$769[1];
var v$771 = json$0json$1.objLook$98(v$770,"metadata");
switch (v$771[0]) { case 0: {var v$772 = v$771[1];
switch (v$772[0]) { case 2: {var v$773 = v$772[1];
var v$774 = json$0json$1.objLook$98(v$773,"name");
switch (v$774[0]) { case 0: {var v$775 = v$774[1];
switch (v$775[0]) { case 0: {var v$776 = v$775[1];
var v$777 = json$0json$1.objLook$98(v$773,".tag");
switch (v$777[0]) { case 0: {var v$778 = v$777[1];
switch (v$778[0]) { case 0: {msg$768 = ((v$778[1] + " ") + v$776);
 break; }default: {msg$768 = ("name " + v$776);
} };
 break; }default: {msg$768 = ("name " + v$776);
} };
 break; }default: {msg$768 = "expecting string";
} };
 break; }default: {msg$768 = "expecting string";
} };
 break; }default: {msg$768 = "expecting object";
} };
 break; }default: {msg$768 = "expecting object";
} };
 break; }default: {msg$768 = "expecting object0";
} };
return cont$468([msg$768]);
});
};
appfun2$0dropbox$1.move_dir$517 = function(fs$520,f$523,fnew$526,cont$529){return appfun2$0dropbox$1.move_file$456(fs$520,f$523,fnew$526,cont$529);
};
return 0;
})();
