if ((typeof(appfun2$0dropbox$1)) == "undefined") {appfun2$0dropbox$1 = {};
};
(function(){appfun2$0dropbox$1.client$91 = function(client_id$94){var t$904 = "https://www.dropbox.com/oauth2/authorize";
var t$903 = client_id$94;
var t$900;
var s$589;
var href$593 = (function(){return window.location.href;})();
var v$594 = basis$0String$1.tokens$224(function(c$595){return c$595 == 35;
},href$593);
s$589 = ((v$594 == null)?href$593:v$594[0]);
var t$902;
if (s$589.length >= 1) {var t$901;
var v$825 = SmlPrims.chk_ovf_i32(s$589.length - 1);
if ((v$825 < 0)?true:(v$825 >= s$589.length)) {throw CompilerInitial.exn$Subscript$52;
} else {t$901 = (s$589.charCodeAt(v$825));
};
t$902 = (t$901 == 47);
} else {t$902 = false;
};
t$900 = (t$902?(basis$0String$1.extract$116(s$589,0,[0,SmlPrims.chk_ovf_i32(s$589.length - 1)])):s$589);
return [t$904,t$903,t$900];
};
appfun2$0dropbox$1.authorize$95 = function(c$98){return oauth$0oauth$1.authorize$250(c$98[0],c$98[1],c$98[2]);
};
appfun2$0dropbox$1.isAuthorized$99 = function(c$102){switch ((oauth$0oauth$1.token$167(c$102[0],c$102[1],c$102[2]))[0]) { case 0: {return true;
 break; }default: {return false;
} };
};
appfun2$0dropbox$1.signOut$108 = function(c$111,f$114){return oauth$0oauth$1.logout$278(c$111[0],c$111[1],c$111[2]);
};
var postRequestAsync$161 = function(url$164,headers$167,data$170,cont$173){var r$174 = SmlPrims.newRequest();
(function(r,m,u,a){return r.open(m,u,a);})(r$174,"POST",url$164,true);
var fix$905 = {};
fix$905.$app = function(v$602){lab$app: while (true) {if (v$602 == null) {return 0;
} else {var v$603 = v$602;
var v$604 = v$603[0];
var v$605 = v$603[1];
(function(r,k,v){return r.setRequestHeader(k,v);})(r$174,v$604[0],v$604[1]);
var t$906 = v$605;
var v$602 = t$906;
continue lab$app;
};
};
};
var app$601 = fix$905.$app;
app$601(headers$167);
(function(r,f){r.onreadystatechange = f;})(r$174,function(v$180){if (((function(r){return r.readyState;})(r$174)) >= 4) {var v$189 = (function(r){return SmlPrims.option(r.responseText);})(r$174);
switch (v$189[0]) { case 0: {var v$191 = v$189[1];
return cont$173(v$191);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"dropbox.postRequestAsync failed: " + url$164];
} };
} else {return 0;
};
});
return js$0Js$1.send$654(r$174,[0,data$170]);
};
appfun2$0dropbox$1.dropboxUid$212 = function(c$215,cont$218){var t$911 = postRequestAsync$161;
var t$910 = "https://api.dropboxapi.com/2/users/get_current_account";
var t$909;
var t$908 = basis$0List$1.s$n$686;
var t$907;
var v$620 = oauth$0oauth$1.token$167(c$215[0],c$215[1],c$215[2]);
switch (v$620[0]) { case 0: {t$907 = [["Authorization","Bearer " + v$620[1]],null];
 break; }default: {t$907 = null;
} };
t$909 = (t$908(t$907,[["Content-Type","application/json; charset=utf-8"],null]));
return t$911(t$910,t$909,"null",function(res$223){var v$228 = json$0json$1.fromString$853(res$223);
switch (v$228[0]) { case 2: {var v$252 = v$228[1];
var v$235 = json$0json$1.objLook$98(v$252,"name");
switch (v$235[0]) { case 0: {var v$237 = v$235[1];
switch (v$237[0]) { case 2: {var v$250 = v$237[1];
var v$244 = json$0json$1.objLook$98(v$250,"display_name");
switch (v$244[0]) { case 0: {var v$246 = v$244[1];
switch (v$246[0]) { case 0: {var v$248 = v$246[1];
return cont$218(v$248);
 break; }default: {return cont$218("noname1");
} };
 break; }default: {return cont$218("noname1");
} };
 break; }default: {return cont$218("noname2");
} };
 break; }default: {return cont$218("noname2");
} };
 break; }default: {return cont$218("noname3");
} };
});
};
appfun2$0dropbox$1.filestore$253 = function(c$256){return c$256;
};
appfun2$0dropbox$1.all_files$257 = function(fs$260,cont$263){var data$264 = [["path",[0,""]],[["recursive",[5,true]],null]];
var data$265 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$264)]);
var t$916 = postRequestAsync$161;
var t$915 = "https://api.dropboxapi.com/2/files/list_folder";
var t$914;
var t$913 = basis$0List$1.s$n$686;
var t$912;
var v$636 = oauth$0oauth$1.token$167(fs$260[0],fs$260[1],fs$260[2]);
switch (v$636[0]) { case 0: {t$912 = [["Authorization","Bearer " + v$636[1]],null];
 break; }default: {t$912 = null;
} };
t$914 = (t$913(t$912,[["Content-Type","application/json; charset=utf-8"],null]));
return t$916(t$915,t$914,data$265,function(res$639){var filenames$640;
var v$641 = json$0json$1.fromString$853(res$639);
switch (v$641[0]) { case 2: {var v$642 = v$641[1];
var v$643 = json$0json$1.objLook$98(v$642,"entries");
switch (v$643[0]) { case 0: {var v$644 = v$643[1];
switch (v$644[0]) { case 6: {var v$645 = v$644[1];
filenames$640 = (basis$0List$1.map$697(function(v$646){switch (v$646[0]) { case 2: {var v$647 = v$646[1];
var v$648 = json$0json$1.objLook$98(v$647,"path_display");
switch (v$648[0]) { case 0: {var v$649 = v$648[1];
switch (v$649[0]) { case 0: {return "Dropbox" + v$649[1];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.no path_display"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.no path_display"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.expecting obj"];
} };
},v$645));
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.expecing array"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.expecing array"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.expecting obj2"];
} };
return cont$263(filenames$640);
});
};
appfun2$0dropbox$1.content$315 = function(fs$318,f$321,cont$324){var data$325;
var t$924;
var t$923;
var t$922 = "path";
var t$921;
var t$920;
var t$917;
var n2$664 = f$321.length;
var stop$665 = (8 < n2$664)?8:n2$664;
var fix$918 = {};
fix$918.$h = function(j$667){lab$h: while (true) {if (j$667 == stop$665) {return true;
} else {if (("Dropbox/".charCodeAt(j$667)) == (f$321.charCodeAt(j$667))) {var t$919 = SmlPrims.chk_ovf_i32(j$667 + 1);
var j$667 = t$919;
continue lab$h;
} else {return false;
};
};
};
};
var h$666 = fix$918.$h;
t$917 = ((8 <= n2$664)?(h$666(0)):false);
t$920 = (t$917?(basis$0String$1.extract$116(f$321,7,[1])):f$321);
t$921 = [0,t$920];
t$923 = [t$922,t$921];
t$924 = [t$923,null];
data$325 = t$924;
var data$326 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$325)]);
var hs$327;
var t$926 = basis$0List$1.s$n$686;
var t$925;
var v$669 = oauth$0oauth$1.token$167(fs$318[0],fs$318[1],fs$318[2]);
switch (v$669[0]) { case 0: {t$925 = [["Authorization","Bearer " + v$669[1]],null];
 break; }default: {t$925 = null;
} };
hs$327 = (t$926(t$925,[["Dropbox-API-Arg",data$326],[["Content-Type","text/plain"],null]]));
return postRequestAsync$161("https://content.dropboxapi.com/2/files/download",hs$327,"",cont$324);
};
appfun2$0dropbox$1.write_file$328 = function(fs$331,f$334,content$337,cont$340){var data$341;
var t$934;
var t$933;
var t$932 = "path";
var t$931;
var t$930;
var t$927;
var n2$679 = f$334.length;
var stop$680 = (8 < n2$679)?8:n2$679;
var fix$928 = {};
fix$928.$h = function(j$682){lab$h: while (true) {if (j$682 == stop$680) {return true;
} else {if (("Dropbox/".charCodeAt(j$682)) == (f$334.charCodeAt(j$682))) {var t$929 = SmlPrims.chk_ovf_i32(j$682 + 1);
var j$682 = t$929;
continue lab$h;
} else {return false;
};
};
};
};
var h$681 = fix$928.$h;
t$927 = ((8 <= n2$679)?(h$681(0)):false);
t$930 = (t$927?(basis$0String$1.extract$116(f$334,7,[1])):f$334);
t$931 = [0,t$930];
t$933 = [t$932,t$931];
t$934 = [t$933,[["mode",[0,"overwrite"]],null]];
data$341 = t$934;
var data$342 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$341)]);
var hs$343;
var t$936 = basis$0List$1.s$n$686;
var t$935;
var v$685 = oauth$0oauth$1.token$167(fs$331[0],fs$331[1],fs$331[2]);
switch (v$685[0]) { case 0: {t$935 = [["Authorization","Bearer " + v$685[1]],null];
 break; }default: {t$935 = null;
} };
hs$343 = (t$936(t$935,[["Dropbox-API-Arg",data$342],[["Content-Type","application/octet-stream"],null]]));
return postRequestAsync$161("https://content.dropboxapi.com/2/files/upload",hs$343,content$337,function(res$693){var msg$694;
var v$695 = json$0json$1.fromString$853(res$693);
switch (v$695[0]) { case 2: {var v$696 = v$695[1];
var v$697 = json$0json$1.objLook$98(v$696,"size");
switch (v$697[0]) { case 0: {var v$698 = v$697[1];
switch (v$698[0]) { case 3: {msg$694 = (v$698[1] + " bytes");
 break; }default: {msg$694 = "expecting number";
} };
 break; }default: {msg$694 = "expecting number";
} };
 break; }default: {msg$694 = "expecting object";
} };
return cont$340([msg$694]);
});
};
appfun2$0dropbox$1.mkdir$367 = function(fs$370,d$373,cont$376){var hs$377;
var t$938 = basis$0List$1.s$n$686;
var t$937;
var v$702 = oauth$0oauth$1.token$167(fs$370[0],fs$370[1],fs$370[2]);
switch (v$702[0]) { case 0: {t$937 = [["Authorization","Bearer " + v$702[1]],null];
 break; }default: {t$937 = null;
} };
hs$377 = (t$938(t$937,[["Content-Type","application/json"],null]));
var data$378;
var t$946;
var t$945;
var t$944 = "path";
var t$943;
var t$942;
var t$939;
var n2$711 = d$373.length;
var stop$712 = (8 < n2$711)?8:n2$711;
var fix$940 = {};
fix$940.$h = function(j$714){lab$h: while (true) {if (j$714 == stop$712) {return true;
} else {if (("Dropbox/".charCodeAt(j$714)) == (d$373.charCodeAt(j$714))) {var t$941 = SmlPrims.chk_ovf_i32(j$714 + 1);
var j$714 = t$941;
continue lab$h;
} else {return false;
};
};
};
};
var h$713 = fix$940.$h;
t$939 = ((8 <= n2$711)?(h$713(0)):false);
t$942 = (t$939?(basis$0String$1.extract$116(d$373,7,[1])):d$373);
t$943 = [0,t$942];
t$945 = [t$944,t$943];
t$946 = [t$945,null];
data$378 = t$946;
var data$379 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$378)]);
return postRequestAsync$161("https://api.dropboxapi.com/2/files/create_folder_v2",hs$377,data$379,function(res$720){var msg$721;
var v$722 = json$0json$1.fromString$853(res$720);
switch (v$722[0]) { case 2: {var v$723 = v$722[1];
var v$724 = json$0json$1.objLook$98(v$723,"metadata");
switch (v$724[0]) { case 0: {var v$725 = v$724[1];
switch (v$725[0]) { case 2: {var v$726 = v$725[1];
var v$727 = json$0json$1.objLook$98(v$726,"name");
switch (v$727[0]) { case 0: {var v$728 = v$727[1];
switch (v$728[0]) { case 0: {msg$721 = ("name " + v$728[1]);
 break; }default: {msg$721 = "expecting string";
} };
 break; }default: {msg$721 = "expecting string";
} };
 break; }default: {msg$721 = "expecting object";
} };
 break; }default: {msg$721 = "expecting object";
} };
 break; }default: {msg$721 = "expecting object0";
} };
return cont$376([msg$721]);
});
};
appfun2$0dropbox$1.delete_file$414 = function(fs$417,f$420,cont$423){var hs$424;
var t$948 = basis$0List$1.s$n$686;
var t$947;
var v$732 = oauth$0oauth$1.token$167(fs$417[0],fs$417[1],fs$417[2]);
switch (v$732[0]) { case 0: {t$947 = [["Authorization","Bearer " + v$732[1]],null];
 break; }default: {t$947 = null;
} };
hs$424 = (t$948(t$947,[["Content-Type","application/json"],null]));
var data$425;
var t$956;
var t$955;
var t$954 = "path";
var t$953;
var t$952;
var t$949;
var n2$741 = f$420.length;
var stop$742 = (8 < n2$741)?8:n2$741;
var fix$950 = {};
fix$950.$h = function(j$744){lab$h: while (true) {if (j$744 == stop$742) {return true;
} else {if (("Dropbox/".charCodeAt(j$744)) == (f$420.charCodeAt(j$744))) {var t$951 = SmlPrims.chk_ovf_i32(j$744 + 1);
var j$744 = t$951;
continue lab$h;
} else {return false;
};
};
};
};
var h$743 = fix$950.$h;
t$949 = ((8 <= n2$741)?(h$743(0)):false);
t$952 = (t$949?(basis$0String$1.extract$116(f$420,7,[1])):f$420);
t$953 = [0,t$952];
t$955 = [t$954,t$953];
t$956 = [t$955,null];
data$425 = t$956;
var data$426 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$425)]);
return postRequestAsync$161("https://api.dropboxapi.com/2/files/delete_v2",hs$424,data$426,function(res$756){var msg$757;
var v$758 = json$0json$1.fromString$853(res$756);
switch (v$758[0]) { case 2: {var v$759 = v$758[1];
var v$760 = json$0json$1.objLook$98(v$759,"metadata");
switch (v$760[0]) { case 0: {var v$761 = v$760[1];
switch (v$761[0]) { case 2: {var v$762 = v$761[1];
var v$763 = json$0json$1.objLook$98(v$762,"name");
switch (v$763[0]) { case 0: {var v$764 = v$763[1];
switch (v$764[0]) { case 0: {var v$765 = v$764[1];
var v$766 = json$0json$1.objLook$98(v$762,".tag");
switch (v$766[0]) { case 0: {var v$767 = v$766[1];
switch (v$767[0]) { case 0: {msg$757 = ((v$767[1] + " ") + v$765);
 break; }default: {msg$757 = ("name " + v$765);
} };
 break; }default: {msg$757 = ("name " + v$765);
} };
 break; }default: {msg$757 = "expecting string";
} };
 break; }default: {msg$757 = "expecting string";
} };
 break; }default: {msg$757 = "expecting object";
} };
 break; }default: {msg$757 = "expecting object";
} };
 break; }default: {msg$757 = "expecting object0";
} };
return cont$423([msg$757]);
});
};
appfun2$0dropbox$1.delete_dir$472 = function(fs$475,d$478,cont$481){return appfun2$0dropbox$1.delete_file$414(fs$475,d$478,cont$481);
};
appfun2$0dropbox$1.move_file$482 = function(fs$485,f$488,fnew$491,cont$494){var hs$495;
var t$958 = basis$0List$1.s$n$686;
var t$957;
var v$774 = oauth$0oauth$1.token$167(fs$485[0],fs$485[1],fs$485[2]);
switch (v$774[0]) { case 0: {t$957 = [["Authorization","Bearer " + v$774[1]],null];
 break; }default: {t$957 = null;
} };
hs$495 = (t$958(t$957,[["Content-Type","application/json"],null]));
var data$496;
var t$975;
var t$974;
var t$973 = "from_path";
var t$972;
var t$971;
var t$968;
var n2$783 = f$488.length;
var stop$784 = (8 < n2$783)?8:n2$783;
var fix$969 = {};
fix$969.$h = function(j$786){lab$h: while (true) {if (j$786 == stop$784) {return true;
} else {if (("Dropbox/".charCodeAt(j$786)) == (f$488.charCodeAt(j$786))) {var t$970 = SmlPrims.chk_ovf_i32(j$786 + 1);
var j$786 = t$970;
continue lab$h;
} else {return false;
};
};
};
};
var h$785 = fix$969.$h;
t$968 = ((8 <= n2$783)?(h$785(0)):false);
t$971 = (t$968?(basis$0String$1.extract$116(f$488,7,[1])):f$488);
t$972 = [0,t$971];
t$974 = [t$973,t$972];
var t$967;
var t$966;
var t$965;
var t$964 = "to_path";
var t$963;
var t$962;
var t$959;
var n2$792 = fnew$491.length;
var stop$793 = (8 < n2$792)?8:n2$792;
var fix$960 = {};
fix$960.$h = function(j$795){lab$h: while (true) {if (j$795 == stop$793) {return true;
} else {if (("Dropbox/".charCodeAt(j$795)) == (fnew$491.charCodeAt(j$795))) {var t$961 = SmlPrims.chk_ovf_i32(j$795 + 1);
var j$795 = t$961;
continue lab$h;
} else {return false;
};
};
};
};
var h$794 = fix$960.$h;
t$959 = ((8 <= n2$792)?(h$794(0)):false);
t$962 = (t$959?(basis$0String$1.extract$116(fnew$491,7,[1])):fnew$491);
t$963 = [0,t$962];
t$965 = [t$964,t$963];
t$966 = [t$965,null];
t$967 = t$966;
t$975 = [t$974,t$967];
data$496 = t$975;
var data$497 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$496)]);
return postRequestAsync$161("https://api.dropboxapi.com/2/files/move_v2",hs$495,data$497,function(res$807){var msg$808;
var v$809 = json$0json$1.fromString$853(res$807);
switch (v$809[0]) { case 2: {var v$810 = v$809[1];
var v$811 = json$0json$1.objLook$98(v$810,"metadata");
switch (v$811[0]) { case 0: {var v$812 = v$811[1];
switch (v$812[0]) { case 2: {var v$813 = v$812[1];
var v$814 = json$0json$1.objLook$98(v$813,"name");
switch (v$814[0]) { case 0: {var v$815 = v$814[1];
switch (v$815[0]) { case 0: {var v$816 = v$815[1];
var v$817 = json$0json$1.objLook$98(v$813,".tag");
switch (v$817[0]) { case 0: {var v$818 = v$817[1];
switch (v$818[0]) { case 0: {msg$808 = ((v$818[1] + " ") + v$816);
 break; }default: {msg$808 = ("name " + v$816);
} };
 break; }default: {msg$808 = ("name " + v$816);
} };
 break; }default: {msg$808 = "expecting string";
} };
 break; }default: {msg$808 = "expecting string";
} };
 break; }default: {msg$808 = "expecting object";
} };
 break; }default: {msg$808 = "expecting object";
} };
 break; }default: {msg$808 = "expecting object0";
} };
return cont$494([msg$808]);
});
};
appfun2$0dropbox$1.move_dir$543 = function(fs$546,f$549,fnew$552,cont$555){return appfun2$0dropbox$1.move_file$482(fs$546,f$549,fnew$552,cont$555);
};
return 0;
})();
