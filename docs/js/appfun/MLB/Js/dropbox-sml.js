if ((typeof(appfun2$0dropbox$1)) == "undefined") {appfun2$0dropbox$1 = {};
};
(function(){appfun2$0dropbox$1.client$79 = function(client_id$82){var t$878 = "https://www.dropbox.com/oauth2/authorize";
var t$877 = client_id$82;
var t$876;
var href$571 = (function(){return window.location.href;})();
var v$572 = basis$0String$1.tokens$224(function(c$573){return c$573 == 35;
},href$571);
t$876 = ((v$572 == null)?href$571:v$572[0]);
return [t$878,t$877,t$876];
};
appfun2$0dropbox$1.authorize$83 = function(c$86){return oauth$0oauth$1.authorize$246(c$86[0],c$86[1],c$86[2]);
};
appfun2$0dropbox$1.isAuthorized$87 = function(c$90){switch ((oauth$0oauth$1.token$167(c$90[0],c$90[1],c$90[2]))[0]) { case 0: {return true;
 break; }default: {return false;
} };
};
appfun2$0dropbox$1.signOut$96 = function(c$99,f$102){return oauth$0oauth$1.logout$274(c$99[0],c$99[1],c$99[2]);
};
var postRequestAsync$149 = function(url$152,headers$155,data$158,cont$161){var r$162 = SmlPrims.newRequest();
(function(r,m,u,a){return r.open(m,u,a);})(r$162,"POST",url$152,true);
var fix$879 = {};
fix$879.$app = function(v$580){lab$app: while (true) {if (v$580 == null) {return 0;
} else {var v$581 = v$580;
var v$582 = v$581[0];
var v$583 = v$581[1];
(function(r,k,v){return r.setRequestHeader(k,v);})(r$162,v$582[0],v$582[1]);
var t$880 = v$583;
var v$580 = t$880;
continue lab$app;
};
};
};
var app$579 = fix$879.$app;
app$579(headers$155);
(function(r,f){r.onreadystatechange = f;})(r$162,function(v$168){if (((function(r){return r.readyState;})(r$162)) >= 4) {var v$177 = (function(r){return SmlPrims.option(r.responseText);})(r$162);
switch (v$177[0]) { case 0: {var v$179 = v$177[1];
return cont$161(v$179);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"dropbox.postRequestAsync failed: " + url$152];
} };
} else {return 0;
};
});
return js$0Js$1.send$654(r$162,[0,data$158]);
};
appfun2$0dropbox$1.dropboxUid$200 = function(c$203,cont$206){var t$885 = postRequestAsync$149;
var t$884 = "https://api.dropboxapi.com/2/users/get_current_account";
var t$883;
var t$882 = basis$0List$1.s$n$686;
var t$881;
var v$598 = oauth$0oauth$1.token$167(c$203[0],c$203[1],c$203[2]);
switch (v$598[0]) { case 0: {t$881 = [["Authorization","Bearer " + v$598[1]],null];
 break; }default: {t$881 = null;
} };
t$883 = (t$882(t$881,[["Content-Type","application/json; charset=utf-8"],null]));
return t$885(t$884,t$883,"null",function(res$211){var v$216 = json$0json$1.fromString$853(res$211);
switch (v$216[0]) { case 2: {var v$240 = v$216[1];
var v$223 = json$0json$1.objLook$98(v$240,"name");
switch (v$223[0]) { case 0: {var v$225 = v$223[1];
switch (v$225[0]) { case 2: {var v$238 = v$225[1];
var v$232 = json$0json$1.objLook$98(v$238,"display_name");
switch (v$232[0]) { case 0: {var v$234 = v$232[1];
switch (v$234[0]) { case 0: {var v$236 = v$234[1];
return cont$206(v$236);
 break; }default: {return cont$206("noname1");
} };
 break; }default: {return cont$206("noname1");
} };
 break; }default: {return cont$206("noname2");
} };
 break; }default: {return cont$206("noname2");
} };
 break; }default: {return cont$206("noname3");
} };
});
};
appfun2$0dropbox$1.filestore$241 = function(c$244){return c$244;
};
appfun2$0dropbox$1.all_files$245 = function(fs$248,cont$251){var data$252 = [["path",[0,""]],[["recursive",[5,true]],null]];
var data$253 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$252)]);
var t$890 = postRequestAsync$149;
var t$889 = "https://api.dropboxapi.com/2/files/list_folder";
var t$888;
var t$887 = basis$0List$1.s$n$686;
var t$886;
var v$614 = oauth$0oauth$1.token$167(fs$248[0],fs$248[1],fs$248[2]);
switch (v$614[0]) { case 0: {t$886 = [["Authorization","Bearer " + v$614[1]],null];
 break; }default: {t$886 = null;
} };
t$888 = (t$887(t$886,[["Content-Type","application/json; charset=utf-8"],null]));
return t$890(t$889,t$888,data$253,function(res$617){var filenames$618;
var v$619 = json$0json$1.fromString$853(res$617);
switch (v$619[0]) { case 2: {var v$620 = v$619[1];
var v$621 = json$0json$1.objLook$98(v$620,"entries");
switch (v$621[0]) { case 0: {var v$622 = v$621[1];
switch (v$622[0]) { case 6: {var v$623 = v$622[1];
filenames$618 = (basis$0List$1.map$697(function(v$624){switch (v$624[0]) { case 2: {var v$625 = v$624[1];
var v$626 = json$0json$1.objLook$98(v$625,"path_display");
switch (v$626[0]) { case 0: {var v$627 = v$626[1];
switch (v$627[0]) { case 0: {return "Dropbox" + v$627[1];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.no path_display"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.no path_display"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.expecting obj"];
} };
},v$623));
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.expecing array"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.expecing array"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"Dropbox.FileStore.all_files.expecting obj2"];
} };
return cont$251(filenames$618);
});
};
appfun2$0dropbox$1.content$303 = function(fs$306,f$309,cont$312){var data$313;
var t$898;
var t$897;
var t$896 = "path";
var t$895;
var t$894;
var t$891;
var n2$642 = f$309.length;
var stop$643 = (8 < n2$642)?8:n2$642;
var fix$892 = {};
fix$892.$h = function(j$645){lab$h: while (true) {if (j$645 == stop$643) {return true;
} else {if (("Dropbox/".charCodeAt(j$645)) == (f$309.charCodeAt(j$645))) {var t$893 = SmlPrims.chk_ovf_i32(j$645 + 1);
var j$645 = t$893;
continue lab$h;
} else {return false;
};
};
};
};
var h$644 = fix$892.$h;
t$891 = ((8 <= n2$642)?(h$644(0)):false);
t$894 = (t$891?(basis$0String$1.extract$116(f$309,7,[1])):f$309);
t$895 = [0,t$894];
t$897 = [t$896,t$895];
t$898 = [t$897,null];
data$313 = t$898;
var data$314 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$313)]);
var hs$315;
var t$900 = basis$0List$1.s$n$686;
var t$899;
var v$647 = oauth$0oauth$1.token$167(fs$306[0],fs$306[1],fs$306[2]);
switch (v$647[0]) { case 0: {t$899 = [["Authorization","Bearer " + v$647[1]],null];
 break; }default: {t$899 = null;
} };
hs$315 = (t$900(t$899,[["Dropbox-API-Arg",data$314],[["Content-Type","text/plain"],null]]));
return postRequestAsync$149("https://content.dropboxapi.com/2/files/download",hs$315,"",cont$312);
};
appfun2$0dropbox$1.write_file$316 = function(fs$319,f$322,content$325,cont$328){var data$329;
var t$908;
var t$907;
var t$906 = "path";
var t$905;
var t$904;
var t$901;
var n2$657 = f$322.length;
var stop$658 = (8 < n2$657)?8:n2$657;
var fix$902 = {};
fix$902.$h = function(j$660){lab$h: while (true) {if (j$660 == stop$658) {return true;
} else {if (("Dropbox/".charCodeAt(j$660)) == (f$322.charCodeAt(j$660))) {var t$903 = SmlPrims.chk_ovf_i32(j$660 + 1);
var j$660 = t$903;
continue lab$h;
} else {return false;
};
};
};
};
var h$659 = fix$902.$h;
t$901 = ((8 <= n2$657)?(h$659(0)):false);
t$904 = (t$901?(basis$0String$1.extract$116(f$322,7,[1])):f$322);
t$905 = [0,t$904];
t$907 = [t$906,t$905];
t$908 = [t$907,[["mode",[0,"overwrite"]],null]];
data$329 = t$908;
var data$330 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$329)]);
var hs$331;
var t$910 = basis$0List$1.s$n$686;
var t$909;
var v$663 = oauth$0oauth$1.token$167(fs$319[0],fs$319[1],fs$319[2]);
switch (v$663[0]) { case 0: {t$909 = [["Authorization","Bearer " + v$663[1]],null];
 break; }default: {t$909 = null;
} };
hs$331 = (t$910(t$909,[["Dropbox-API-Arg",data$330],[["Content-Type","application/octet-stream"],null]]));
return postRequestAsync$149("https://content.dropboxapi.com/2/files/upload",hs$331,content$325,function(res$671){var msg$672;
var v$673 = json$0json$1.fromString$853(res$671);
switch (v$673[0]) { case 2: {var v$674 = v$673[1];
var v$675 = json$0json$1.objLook$98(v$674,"size");
switch (v$675[0]) { case 0: {var v$676 = v$675[1];
switch (v$676[0]) { case 3: {msg$672 = (v$676[1] + " bytes");
 break; }default: {msg$672 = "expecting number";
} };
 break; }default: {msg$672 = "expecting number";
} };
 break; }default: {msg$672 = "expecting object";
} };
return cont$328([msg$672]);
});
};
appfun2$0dropbox$1.mkdir$355 = function(fs$358,d$361,cont$364){var hs$365;
var t$912 = basis$0List$1.s$n$686;
var t$911;
var v$680 = oauth$0oauth$1.token$167(fs$358[0],fs$358[1],fs$358[2]);
switch (v$680[0]) { case 0: {t$911 = [["Authorization","Bearer " + v$680[1]],null];
 break; }default: {t$911 = null;
} };
hs$365 = (t$912(t$911,[["Content-Type","application/json"],null]));
var data$366;
var t$920;
var t$919;
var t$918 = "path";
var t$917;
var t$916;
var t$913;
var n2$689 = d$361.length;
var stop$690 = (8 < n2$689)?8:n2$689;
var fix$914 = {};
fix$914.$h = function(j$692){lab$h: while (true) {if (j$692 == stop$690) {return true;
} else {if (("Dropbox/".charCodeAt(j$692)) == (d$361.charCodeAt(j$692))) {var t$915 = SmlPrims.chk_ovf_i32(j$692 + 1);
var j$692 = t$915;
continue lab$h;
} else {return false;
};
};
};
};
var h$691 = fix$914.$h;
t$913 = ((8 <= n2$689)?(h$691(0)):false);
t$916 = (t$913?(basis$0String$1.extract$116(d$361,7,[1])):d$361);
t$917 = [0,t$916];
t$919 = [t$918,t$917];
t$920 = [t$919,null];
data$366 = t$920;
var data$367 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$366)]);
return postRequestAsync$149("https://api.dropboxapi.com/2/files/create_folder_v2",hs$365,data$367,function(res$698){var msg$699;
var v$700 = json$0json$1.fromString$853(res$698);
switch (v$700[0]) { case 2: {var v$701 = v$700[1];
var v$702 = json$0json$1.objLook$98(v$701,"metadata");
switch (v$702[0]) { case 0: {var v$703 = v$702[1];
switch (v$703[0]) { case 2: {var v$704 = v$703[1];
var v$705 = json$0json$1.objLook$98(v$704,"name");
switch (v$705[0]) { case 0: {var v$706 = v$705[1];
switch (v$706[0]) { case 0: {msg$699 = ("name " + v$706[1]);
 break; }default: {msg$699 = "expecting string";
} };
 break; }default: {msg$699 = "expecting string";
} };
 break; }default: {msg$699 = "expecting object";
} };
 break; }default: {msg$699 = "expecting object";
} };
 break; }default: {msg$699 = "expecting object0";
} };
return cont$364([msg$699]);
});
};
appfun2$0dropbox$1.delete_file$402 = function(fs$405,f$408,cont$411){var hs$412;
var t$922 = basis$0List$1.s$n$686;
var t$921;
var v$710 = oauth$0oauth$1.token$167(fs$405[0],fs$405[1],fs$405[2]);
switch (v$710[0]) { case 0: {t$921 = [["Authorization","Bearer " + v$710[1]],null];
 break; }default: {t$921 = null;
} };
hs$412 = (t$922(t$921,[["Content-Type","application/json"],null]));
var data$413;
var t$930;
var t$929;
var t$928 = "path";
var t$927;
var t$926;
var t$923;
var n2$719 = f$408.length;
var stop$720 = (8 < n2$719)?8:n2$719;
var fix$924 = {};
fix$924.$h = function(j$722){lab$h: while (true) {if (j$722 == stop$720) {return true;
} else {if (("Dropbox/".charCodeAt(j$722)) == (f$408.charCodeAt(j$722))) {var t$925 = SmlPrims.chk_ovf_i32(j$722 + 1);
var j$722 = t$925;
continue lab$h;
} else {return false;
};
};
};
};
var h$721 = fix$924.$h;
t$923 = ((8 <= n2$719)?(h$721(0)):false);
t$926 = (t$923?(basis$0String$1.extract$116(f$408,7,[1])):f$408);
t$927 = [0,t$926];
t$929 = [t$928,t$927];
t$930 = [t$929,null];
data$413 = t$930;
var data$414 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$413)]);
return postRequestAsync$149("https://api.dropboxapi.com/2/files/delete_v2",hs$412,data$414,function(res$734){var msg$735;
var v$736 = json$0json$1.fromString$853(res$734);
switch (v$736[0]) { case 2: {var v$737 = v$736[1];
var v$738 = json$0json$1.objLook$98(v$737,"metadata");
switch (v$738[0]) { case 0: {var v$739 = v$738[1];
switch (v$739[0]) { case 2: {var v$740 = v$739[1];
var v$741 = json$0json$1.objLook$98(v$740,"name");
switch (v$741[0]) { case 0: {var v$742 = v$741[1];
switch (v$742[0]) { case 0: {var v$743 = v$742[1];
var v$744 = json$0json$1.objLook$98(v$740,".tag");
switch (v$744[0]) { case 0: {var v$745 = v$744[1];
switch (v$745[0]) { case 0: {msg$735 = ((v$745[1] + " ") + v$743);
 break; }default: {msg$735 = ("name " + v$743);
} };
 break; }default: {msg$735 = ("name " + v$743);
} };
 break; }default: {msg$735 = "expecting string";
} };
 break; }default: {msg$735 = "expecting string";
} };
 break; }default: {msg$735 = "expecting object";
} };
 break; }default: {msg$735 = "expecting object";
} };
 break; }default: {msg$735 = "expecting object0";
} };
return cont$411([msg$735]);
});
};
appfun2$0dropbox$1.delete_dir$460 = function(fs$463,d$466,cont$469){return appfun2$0dropbox$1.delete_file$402(fs$463,d$466,cont$469);
};
appfun2$0dropbox$1.move_file$470 = function(fs$473,f$476,fnew$479,cont$482){var hs$483;
var t$932 = basis$0List$1.s$n$686;
var t$931;
var v$752 = oauth$0oauth$1.token$167(fs$473[0],fs$473[1],fs$473[2]);
switch (v$752[0]) { case 0: {t$931 = [["Authorization","Bearer " + v$752[1]],null];
 break; }default: {t$931 = null;
} };
hs$483 = (t$932(t$931,[["Content-Type","application/json"],null]));
var data$484;
var t$949;
var t$948;
var t$947 = "from_path";
var t$946;
var t$945;
var t$942;
var n2$761 = f$476.length;
var stop$762 = (8 < n2$761)?8:n2$761;
var fix$943 = {};
fix$943.$h = function(j$764){lab$h: while (true) {if (j$764 == stop$762) {return true;
} else {if (("Dropbox/".charCodeAt(j$764)) == (f$476.charCodeAt(j$764))) {var t$944 = SmlPrims.chk_ovf_i32(j$764 + 1);
var j$764 = t$944;
continue lab$h;
} else {return false;
};
};
};
};
var h$763 = fix$943.$h;
t$942 = ((8 <= n2$761)?(h$763(0)):false);
t$945 = (t$942?(basis$0String$1.extract$116(f$476,7,[1])):f$476);
t$946 = [0,t$945];
t$948 = [t$947,t$946];
var t$941;
var t$940;
var t$939;
var t$938 = "to_path";
var t$937;
var t$936;
var t$933;
var n2$770 = fnew$479.length;
var stop$771 = (8 < n2$770)?8:n2$770;
var fix$934 = {};
fix$934.$h = function(j$773){lab$h: while (true) {if (j$773 == stop$771) {return true;
} else {if (("Dropbox/".charCodeAt(j$773)) == (fnew$479.charCodeAt(j$773))) {var t$935 = SmlPrims.chk_ovf_i32(j$773 + 1);
var j$773 = t$935;
continue lab$h;
} else {return false;
};
};
};
};
var h$772 = fix$934.$h;
t$933 = ((8 <= n2$770)?(h$772(0)):false);
t$936 = (t$933?(basis$0String$1.extract$116(fnew$479,7,[1])):fnew$479);
t$937 = [0,t$936];
t$939 = [t$938,t$937];
t$940 = [t$939,null];
t$941 = t$940;
t$949 = [t$948,t$941];
data$484 = t$949;
var data$485 = json$0json$1.toString$255([2,json$0json$1.objFromList$72(data$484)]);
return postRequestAsync$149("https://api.dropboxapi.com/2/files/move_v2",hs$483,data$485,function(res$785){var msg$786;
var v$787 = json$0json$1.fromString$853(res$785);
switch (v$787[0]) { case 2: {var v$788 = v$787[1];
var v$789 = json$0json$1.objLook$98(v$788,"metadata");
switch (v$789[0]) { case 0: {var v$790 = v$789[1];
switch (v$790[0]) { case 2: {var v$791 = v$790[1];
var v$792 = json$0json$1.objLook$98(v$791,"name");
switch (v$792[0]) { case 0: {var v$793 = v$792[1];
switch (v$793[0]) { case 0: {var v$794 = v$793[1];
var v$795 = json$0json$1.objLook$98(v$791,".tag");
switch (v$795[0]) { case 0: {var v$796 = v$795[1];
switch (v$796[0]) { case 0: {msg$786 = ((v$796[1] + " ") + v$794);
 break; }default: {msg$786 = ("name " + v$794);
} };
 break; }default: {msg$786 = ("name " + v$794);
} };
 break; }default: {msg$786 = "expecting string";
} };
 break; }default: {msg$786 = "expecting string";
} };
 break; }default: {msg$786 = "expecting object";
} };
 break; }default: {msg$786 = "expecting object";
} };
 break; }default: {msg$786 = "expecting object0";
} };
return cont$482([msg$786]);
});
};
appfun2$0dropbox$1.move_dir$531 = function(fs$534,f$537,fnew$540,cont$543){return appfun2$0dropbox$1.move_file$470(fs$534,f$537,fnew$540,cont$543);
};
return 0;
})();
