if ((typeof(smltojs0$0SmlToJsCompApp$1$2)) == "undefined") {smltojs0$0SmlToJsCompApp$1$2 = {};
};
(function(){smltojs0$0SmlToJsCompApp$1$2.scrollDown$928 = function(e$931){return (function(t){t.scrollTop = t.scrollHeight;})(e$931);
};
smltojs0$0SmlToJsCompApp$1$2.userAgent$935 = function(v$937){return (function(){return navigator.userAgent;})();
};
smltojs0$0SmlToJsCompApp$1$2.agent$940 = basis$0String$1.translate$217(function(x$2894){return basis$0Char$1.toString$277(((65 <= x$2894)?(x$2894 <= 90):false)?(SmlPrims.chk_ovf_i32(x$2894 + 32)):x$2894);
},(function(){return navigator.userAgent;})());
smltojs0$0SmlToJsCompApp$1$2.touchDevices$941 = ["ipod",["ipad",["iphone",["series60",["symbian",["android",["windows ce",["blackberry",null]]]]]]]];
smltojs0$0SmlToJsCompApp$1$2.touchScreen$942 = function(a$945){var fix$10170 = {};
fix$10170.$exists = function(v$2904){lab$exists: while (true) {if (v$2904 == null) {return false;
} else {var v$2905 = v$2904;
var v$2906 = v$2905[0];
var v$2907 = v$2905[1];
if (basis$0String$1.isSubstring$268(v$2906,a$945)) {return true;
} else {var t$10171 = v$2907;
var v$2904 = t$10171;
continue lab$exists;
};
};
};
};
var exists$2903 = fix$10170.$exists;
return exists$2903(smltojs0$0SmlToJsCompApp$1$2.touchDevices$941);
};
smltojs0$0SmlToJsCompApp$1$2.serverGet$953 = function(file$956){var file$957;
var t$10175 = file$956 + "?_=";
var t$10174;
var t$10173 = basis$0Real$1.toString$153;
var t$10172;
var v$2911 = SmlPrims.getrealtime();
t$10172 = ((v$2911[0] - (-2147483648)) + (v$2911[1] / 1000000.0));
t$10174 = (t$10173(t$10172));
file$957 = (t$10175 + t$10174);
var r$958 = SmlPrims.newRequest();
(function(r,m,u,a){return r.open(m,u,a);})(r$958,"GET",file$957,false);
js$0Js$1.send$654(r$958,[1]);
var v$965 = (function(r){return SmlPrims.option(r.responseText);})(r$958);
switch (v$965[0]) { case 0: {return v$965[1];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"serverGet failed on file " + file$957];
} };
};
smltojs0$0SmlToJsCompApp$1$2.outarea$973;
var attrs$2919 = [["readonly","readonly"],null];
var newelem$2920 = document.createElement("textarea");
var fix$10176 = {};
fix$10176.$app = function(v$2922){lab$app: while (true) {if (v$2922 == null) {return 0;
} else {var v$2923 = v$2922;
var v$2924 = v$2923[0];
var v$2925 = v$2923[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$2920,v$2924[0],v$2924[1]);
var t$10177 = v$2925;
var v$2922 = t$10177;
continue lab$app;
};
};
};
var app$2921 = fix$10176.$app;
app$2921(attrs$2919);
smltojs0$0SmlToJsCompApp$1$2.outarea$973 = newelem$2920;
smltojs0$0SmlToJsCompApp$1$2.outareaDiv$974;
var attrs$2927 = [["class","textareacontainer"],null];
var newelem$2929 = document.createElement("div");
var fix$10178 = {};
fix$10178.$app = function(v$2931){lab$app: while (true) {if (v$2931 == null) {return 0;
} else {var v$2932 = v$2931;
var v$2933 = v$2932[0];
var v$2934 = v$2932[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$2929,v$2933[0],v$2933[1]);
var t$10179 = v$2934;
var v$2931 = t$10179;
continue lab$app;
};
};
};
var app$2930 = fix$10178.$app;
app$2930(attrs$2927);
(function(e,a){return e.appendChild(a);})(newelem$2929,smltojs0$0SmlToJsCompApp$1$2.outarea$973);
smltojs0$0SmlToJsCompApp$1$2.outareaDiv$974 = newelem$2929;
smltojs0$0SmlToJsCompApp$1$2.logarea$975;
var attrs$2936 = [["readonly","readonly"],null];
var newelem$2937 = document.createElement("textarea");
var fix$10180 = {};
fix$10180.$app = function(v$2939){lab$app: while (true) {if (v$2939 == null) {return 0;
} else {var v$2940 = v$2939;
var v$2941 = v$2940[0];
var v$2942 = v$2940[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$2937,v$2941[0],v$2941[1]);
var t$10181 = v$2942;
var v$2939 = t$10181;
continue lab$app;
};
};
};
var app$2938 = fix$10180.$app;
app$2938(attrs$2936);
smltojs0$0SmlToJsCompApp$1$2.logarea$975 = newelem$2937;
smltojs0$0SmlToJsCompApp$1$2.logareaDiv$976;
var attrs$2944 = [["class","textareacontainer"],null];
var newelem$2946 = document.createElement("div");
var fix$10182 = {};
fix$10182.$app = function(v$2948){lab$app: while (true) {if (v$2948 == null) {return 0;
} else {var v$2949 = v$2948;
var v$2950 = v$2949[0];
var v$2951 = v$2949[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$2946,v$2950[0],v$2950[1]);
var t$10183 = v$2951;
var v$2948 = t$10183;
continue lab$app;
};
};
};
var app$2947 = fix$10182.$app;
app$2947(attrs$2944);
(function(e,a){return e.appendChild(a);})(newelem$2946,smltojs0$0SmlToJsCompApp$1$2.logarea$975);
smltojs0$0SmlToJsCompApp$1$2.logareaDiv$976 = newelem$2946;
smltojs0$0SmlToJsCompApp$1$2.clearoutbutton$977;
var attrs$2953 = [["type","button"],[["value","Clear Output"],null]];
var newelem$2954 = document.createElement("input");
var fix$10184 = {};
fix$10184.$app = function(v$2956){lab$app: while (true) {if (v$2956 == null) {return 0;
} else {var v$2957 = v$2956;
var v$2958 = v$2957[0];
var v$2959 = v$2957[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$2954,v$2958[0],v$2958[1]);
var t$10185 = v$2959;
var v$2956 = t$10185;
continue lab$app;
};
};
};
var app$2955 = fix$10184.$app;
app$2955(attrs$2953);
smltojs0$0SmlToJsCompApp$1$2.clearoutbutton$977 = newelem$2954;
smltojs0$0SmlToJsCompApp$1$2.nodropboxPng$978 = "nodropbox.png";
smltojs0$0SmlToJsCompApp$1$2.dropboxPng$979 = "dropbox.png";
smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980;
var attrs$2961 = [["class","notify_area"],null];
var elem$2962 = document.createTextNode("welcome!");
var newelem$2963 = document.createElement("div");
var fix$10186 = {};
fix$10186.$app = function(v$2965){lab$app: while (true) {if (v$2965 == null) {return 0;
} else {var v$2966 = v$2965;
var v$2967 = v$2966[0];
var v$2968 = v$2966[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$2963,v$2967[0],v$2967[1]);
var t$10187 = v$2968;
var v$2965 = t$10187;
continue lab$app;
};
};
};
var app$2964 = fix$10186.$app;
app$2964(attrs$2961);
(function(e,a){return e.appendChild(a);})(newelem$2963,elem$2962);
smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980 = newelem$2963;
smltojs0$0SmlToJsCompApp$1$2.dropboxAreaElem$981;
var attrs$2971 = [["src","nodropbox.png"],[["class","dropbox_area"],null]];
var newelem$2972 = document.createElement("img");
var fix$10188 = {};
fix$10188.$app = function(v$2974){lab$app: while (true) {if (v$2974 == null) {return 0;
} else {var v$2975 = v$2974;
var v$2976 = v$2975[0];
var v$2977 = v$2975[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$2972,v$2976[0],v$2976[1]);
var t$10189 = v$2977;
var v$2974 = t$10189;
continue lab$app;
};
};
};
var app$2973 = fix$10188.$app;
app$2973(attrs$2971);
smltojs0$0SmlToJsCompApp$1$2.dropboxAreaElem$981 = newelem$2972;
smltojs0$0SmlToJsCompApp$1$2.setNoDropboxPng$982 = function(v$984){return (function(e,a,b){return e.setAttribute(a,b);})(smltojs0$0SmlToJsCompApp$1$2.dropboxAreaElem$981,"src","nodropbox.png");
};
smltojs0$0SmlToJsCompApp$1$2.setDropboxPng$985 = function(v$987){return (function(e,a,b){return e.setAttribute(a,b);})(smltojs0$0SmlToJsCompApp$1$2.dropboxAreaElem$981,"src","dropbox.png");
};
var notifyTimeout$988 = [[1]];
var notify0$1026 = function(color$1029,e$1032,s$1035){var v$1046 = notifyTimeout$988[0];
switch (v$1046[0]) { case 0: {(function(id){return clearTimeout(id);})(v$1046[1]);
 break; }default: {0;
} };
(function(e,s){e.innerHTML = s;})(e$1032,s$1035);
(function(e,a,b){return e.setAttribute(a,b);})(e$1032,"style",((("opacity:" + (basis$0Real$1.toString$153(1.0))) + "; background-color:") + color$1029) + ";");
var t$10203 = notifyTimeout$988;
var t$10202;
var t$10201;
var t$10200 = 3000;
var t$10199;
var fix$10190 = {};
fix$10190.$fadeNotification = function(opacity$9989,v$9990){lab$fadeNotification: while (true) {if (opacity$9989 < 0.0) {(function(e,a,b){return e.setAttribute(a,b);})(e$1032,"style","opacity:0.0;");
return (notifyTimeout$988[0] = [1],0);
} else {(function(e,a,b){return e.setAttribute(a,b);})(e$1032,"style",((("opacity:" + (basis$0Real$1.toString$153(opacity$9989))) + "; background-color:") + color$1029) + ";");
var t$10198 = notifyTimeout$988;
var t$10197;
var t$10196;
var t$10195 = 50;
var t$10191;
var v$10030 = opacity$9989 - 0.02;
t$10191 = ((function(env$10194){return function(v$10031){var v$10192 = env$10194[0];
var v$10193 = env$10194[1];
return v$10193(v$10192,v$10031);
};
})([v$10030,fix$10190.$fadeNotification]));
t$10196 = ((function(i,f){return setTimeout(f,i);})(t$10195,t$10191));
t$10197 = [0,t$10196];
return (t$10198[0] = t$10197,0);
};
};
};
var fadeNotification$9988 = fix$10190.$fadeNotification;
t$10199 = (function(v$10033){return fadeNotification$9988(0.98,v$10033);
});
t$10201 = ((function(i,f){return setTimeout(f,i);})(t$10200,t$10199));
t$10202 = [0,t$10201];
return (t$10203[0] = t$10202,0);
};
smltojs0$0SmlToJsCompApp$1$2.notify_err$1049 = function(v$10036){return notify0$1026("#dd8888",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,v$10036);
};
smltojs0$0SmlToJsCompApp$1$2.notify_errE$1050 = function(v$10038){return function(v$10039){return notify0$1026("#dd8888",v$10038,v$10039);
};
};
smltojs0$0SmlToJsCompApp$1$2.notify_warn$1051 = function(v$10042){return notify0$1026("#dddd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,v$10042);
};
smltojs0$0SmlToJsCompApp$1$2.notify$1052 = function(v$10045){return notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,v$10045);
};
smltojs0$0SmlToJsCompApp$1$2.outRef$1053 = [function(v$1055){throw [basis$0Initial$1.en$Fail$54,"outRef not initialized"];
}];
smltojs0$0SmlToJsCompApp$1$2.out$1056 = function(s$1059){return smltojs0$0SmlToJsCompApp$1$2.outRef$1053[0](s$1059);
};
var fix$10204 = {};
fix$10204.$whileSome = function(f$1063,g$1066){lab$whileSome: while (true) {var v$1071 = f$1063(0);
switch (v$1071[0]) { case 0: {var v$1075 = v$1071[1];
g$1066(v$1075);
var t$10205 = f$1063;
var t$10206 = g$1066;
var f$1063 = t$10205;
var g$1066 = t$10206;
continue lab$whileSome;
 break; }default: {return 0;
} };
};
};
smltojs0$0SmlToJsCompApp$1$2.whileSome$1060 = fix$10204.$whileSome;
smltojs0$0SmlToJsCompApp$1$2.clearoutarea$1076 = function(v$1078){var fix$10207 = {};
fix$10207.$whileSome = function(g$6268){lab$whileSome: while (true) {var v$6269 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.outarea$973);
switch (v$6269[0]) { case 0: {var v$6270 = v$6269[1];
g$6268(v$6270);
var t$10208 = g$6268;
var g$6268 = t$10208;
continue lab$whileSome;
 break; }default: {return 0;
} };
};
};
var whileSome$6267 = fix$10207.$whileSome;
return whileSome$6267(function(e$1083){return (function(e,a){return e.removeChild(a);})(smltojs0$0SmlToJsCompApp$1$2.outarea$973,e$1083);
});
};
smltojs0$0SmlToJsCompApp$1$2.outfun$1084 = function(s$1087){(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.outarea$973,document.createTextNode(s$1087));
return (function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.outarea$973);
};
smltojs0$0SmlToJsCompApp$1$2.clearlogarea$1090 = function(v$1092){var fix$10209 = {};
fix$10209.$whileSome = function(g$6275){lab$whileSome: while (true) {var v$6276 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
switch (v$6276[0]) { case 0: {var v$6277 = v$6276[1];
g$6275(v$6277);
var t$10210 = g$6275;
var g$6275 = t$10210;
continue lab$whileSome;
 break; }default: {return 0;
} };
};
};
var whileSome$6274 = fix$10209.$whileSome;
return whileSome$6274(function(e$1097){return (function(e,a){return e.removeChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,e$1097);
});
};
smltojs0$0SmlToJsCompApp$1$2.log0$1098 = function(s$1101){var s$1102;
var t$10216;
var t$10215;
var t$10214;
var t$10213 = basis$0Date$1.fmt$816;
var t$10212 = "%H:%M:%S";
var t$10211;
var v$10004 = SmlPrims.getrealtime();
t$10211 = (basis$0Date$1.fromTimeLocal$512(v$10004[0],v$10004[1]));
t$10214 = (t$10213(t$10212,t$10211));
t$10215 = (t$10214 + ": ");
t$10216 = (t$10215 + s$1101);
s$1102 = (t$10216 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$1102));
return (function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
};
smltojs0$0SmlToJsCompApp$1$2.log$1105 = function(s$1108){notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,s$1108);
var s$3060;
var t$10222;
var t$10221;
var t$10220;
var t$10219 = basis$0Date$1.fmt$816;
var t$10218 = "%H:%M:%S";
var t$10217;
var v$10005 = SmlPrims.getrealtime();
t$10217 = (basis$0Date$1.fromTimeLocal$512(v$10005[0],v$10005[1]));
t$10220 = (t$10219(t$10218,t$10217));
t$10221 = (t$10220 + ": ");
t$10222 = (t$10221 + s$1108);
s$3060 = (t$10222 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$3060));
return (function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
};
smltojs0$0SmlToJsCompApp$1$2.topelem$1111 = (function(d){return d.documentElement;})(js$0Js$1.document$88);
smltojs0$0SmlToJsCompApp$1$2.appendStyleLink$1112 = function(path$1115){var v$1120 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111);
switch (v$1120[0]) { case 0: {var t$10226 = v$1120[1];
var t$10223;
var attrs$3073 = [["rel","stylesheet"],[["href",path$1115],null]];
var newelem$3074 = document.createElement("link");
var fix$10224 = {};
fix$10224.$app = function(v$3076){lab$app: while (true) {if (v$3076 == null) {return 0;
} else {var v$3077 = v$3076;
var v$3078 = v$3077[0];
var v$3079 = v$3077[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$3074,v$3078[0],v$3078[1]);
var t$10225 = v$3079;
var v$3076 = t$10225;
continue lab$app;
};
};
};
var app$3075 = fix$10224.$app;
app$3075(attrs$3073);
t$10223 = newelem$3074;
return (function(e,a){return e.appendChild(a);})(t$10226,t$10223);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"appendStyleLink"];
} };
};
smltojs0$0SmlToJsCompApp$1$2.appendIconLink$1123 = function(path$1126){var v$1131 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111);
switch (v$1131[0]) { case 0: {var t$10230 = v$1131[1];
var t$10227;
var attrs$3084 = [["rel","shortcut icon"],[["type","image/x-icon"],[["href",path$1126],null]]];
var newelem$3085 = document.createElement("link");
var fix$10228 = {};
fix$10228.$app = function(v$3087){lab$app: while (true) {if (v$3087 == null) {return 0;
} else {var v$3088 = v$3087;
var v$3089 = v$3088[0];
var v$3090 = v$3088[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$3085,v$3089[0],v$3089[1]);
var t$10229 = v$3090;
var v$3087 = t$10229;
continue lab$app;
};
};
};
var app$3086 = fix$10228.$app;
app$3086(attrs$3084);
t$10227 = newelem$3085;
return (function(e,a){return e.appendChild(a);})(t$10230,t$10227);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"appendStyleLink"];
} };
};
smltojs0$0SmlToJsCompApp$1$2.appendScript$1134 = function(path$1137){var v$1142 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111);
switch (v$1142[0]) { case 0: {var t$10234 = v$1142[1];
var t$10231;
var attrs$3095 = [["type","text/javascript"],[["src",path$1137],null]];
var newelem$3096 = document.createElement("script");
var fix$10232 = {};
fix$10232.$app = function(v$3098){lab$app: while (true) {if (v$3098 == null) {return 0;
} else {var v$3099 = v$3098;
var v$3100 = v$3099[0];
var v$3101 = v$3099[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$3096,v$3100[0],v$3100[1]);
var t$10233 = v$3101;
var v$3098 = t$10233;
continue lab$app;
};
};
};
var app$3097 = fix$10232.$app;
app$3097(attrs$3095);
t$10231 = newelem$3096;
return (function(e,a){return e.appendChild(a);})(t$10234,t$10231);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"appendScript"];
} };
};
smltojs0$0SmlToJsCompApp$1$2.cleanupBody$1145 = function(v$1147){var v$1152 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111);
switch (v$1152[0]) { case 0: {var v$1168 = v$1152[1];
var v$1158 = (function(e){return SmlPrims.option(e.nextSibling);})(v$1168);
switch (v$1158[0]) { case 0: {var v$1167 = v$1158[1];
var v$1164 = (function(e){return SmlPrims.option(e.nextSibling);})(v$1167);
switch (v$1164[0]) { case 0: {return (function(e,a){return e.removeChild(a);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111,v$1164[1]);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"cleanupBody"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"cleanupBody2"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"cleanupBody3"];
} };
};
smltojs0$0SmlToJsCompApp$1$2.createBody$1169 = function(v$1171){var v$1176 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111);
switch (v$1176[0]) { case 0: {var v$1187 = v$1176[1];
var v$1184 = (function(e){return SmlPrims.option(e.nextSibling);})(v$1187);
switch (v$1184[0]) { case 0: {(function(e,a){return e.removeChild(a);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111,v$1184[1]);
 break; }default: {0;
} };
var t$10238 = smltojs0$0SmlToJsCompApp$1$2.topelem$1111;
var t$10235;
var attrs$3114 = [["class","claro"],[["id","body"],null]];
var newelem$3115 = document.createElement("body");
var fix$10236 = {};
fix$10236.$app = function(v$3117){lab$app: while (true) {if (v$3117 == null) {return 0;
} else {var v$3118 = v$3117;
var v$3119 = v$3118[0];
var v$3120 = v$3118[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$3115,v$3119[0],v$3119[1]);
var t$10237 = v$3120;
var v$3117 = t$10237;
continue lab$app;
};
};
};
var app$3116 = fix$10236.$app;
app$3116(attrs$3114);
t$10235 = newelem$3115;
return (function(e,a){return e.appendChild(a);})(t$10238,t$10235);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"createBody"];
} };
};
var v$6280 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111);
switch (v$6280[0]) { case 0: {var t$10242 = v$6280[1];
var t$10239;
var attrs$6281 = [["rel","stylesheet"],[["href","dijit/themes/claro/claro.css"],null]];
var newelem$6282 = document.createElement("link");
var fix$10240 = {};
fix$10240.$app = function(v$6284){lab$app: while (true) {if (v$6284 == null) {return 0;
} else {var v$6285 = v$6284;
var v$6286 = v$6285[0];
var v$6287 = v$6285[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$6282,v$6286[0],v$6286[1]);
var t$10241 = v$6287;
var v$6284 = t$10241;
continue lab$app;
};
};
};
var app$6283 = fix$10240.$app;
app$6283(attrs$6281);
t$10239 = newelem$6282;
(function(e,a){return e.appendChild(a);})(t$10242,t$10239);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"appendStyleLink"];
} };
var v$6289 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111);
switch (v$6289[0]) { case 0: {var t$10246 = v$6289[1];
var t$10243;
var attrs$6290 = [["rel","stylesheet"],[["href","js/codemirror/codemirror.css"],null]];
var newelem$6291 = document.createElement("link");
var fix$10244 = {};
fix$10244.$app = function(v$6293){lab$app: while (true) {if (v$6293 == null) {return 0;
} else {var v$6294 = v$6293;
var v$6295 = v$6294[0];
var v$6296 = v$6294[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$6291,v$6295[0],v$6295[1]);
var t$10245 = v$6296;
var v$6293 = t$10245;
continue lab$app;
};
};
};
var app$6292 = fix$10244.$app;
app$6292(attrs$6290);
t$10243 = newelem$6291;
(function(e,a){return e.appendChild(a);})(t$10246,t$10243);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"appendStyleLink"];
} };
var v$6298 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111);
switch (v$6298[0]) { case 0: {var t$10250 = v$6298[1];
var t$10247;
var attrs$6299 = [["type","text/javascript"],[["src","js/codemirror/sml.js"],null]];
var newelem$6300 = document.createElement("script");
var fix$10248 = {};
fix$10248.$app = function(v$6302){lab$app: while (true) {if (v$6302 == null) {return 0;
} else {var v$6303 = v$6302;
var v$6304 = v$6303[0];
var v$6305 = v$6303[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$6300,v$6304[0],v$6304[1]);
var t$10249 = v$6305;
var v$6302 = t$10249;
continue lab$app;
};
};
};
var app$6301 = fix$10248.$app;
app$6301(attrs$6299);
t$10247 = newelem$6300;
(function(e,a){return e.appendChild(a);})(t$10250,t$10247);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"appendScript"];
} };
var v$6307 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111);
switch (v$6307[0]) { case 0: {var t$10254 = v$6307[1];
var t$10251;
var attrs$6308 = [["rel","stylesheet"],[["href","appfunstyle.css"],null]];
var newelem$6309 = document.createElement("link");
var fix$10252 = {};
fix$10252.$app = function(v$6311){lab$app: while (true) {if (v$6311 == null) {return 0;
} else {var v$6312 = v$6311;
var v$6313 = v$6312[0];
var v$6314 = v$6312[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$6309,v$6313[0],v$6313[1]);
var t$10253 = v$6314;
var v$6311 = t$10253;
continue lab$app;
};
};
};
var app$6310 = fix$10252.$app;
app$6310(attrs$6308);
t$10251 = newelem$6309;
(function(e,a){return e.appendChild(a);})(t$10254,t$10251);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"appendStyleLink"];
} };
var v$6316 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111);
switch (v$6316[0]) { case 0: {var t$10258 = v$6316[1];
var t$10255;
var attrs$6317 = [["rel","shortcut icon"],[["type","image/x-icon"],[["href","favicon.ico"],null]]];
var newelem$6318 = document.createElement("link");
var fix$10256 = {};
fix$10256.$app = function(v$6320){lab$app: while (true) {if (v$6320 == null) {return 0;
} else {var v$6321 = v$6320;
var v$6322 = v$6321[0];
var v$6323 = v$6321[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$6318,v$6322[0],v$6322[1]);
var t$10257 = v$6323;
var v$6320 = t$10257;
continue lab$app;
};
};
};
var app$6319 = fix$10256.$app;
app$6319(attrs$6317);
t$10255 = newelem$6318;
(function(e,a){return e.appendChild(a);})(t$10258,t$10255);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"appendStyleLink"];
} };
smltojs0$0SmlToJsCompApp$1$2.createBody$1169(0);
smltojs0$0SmlToJsCompApp$1$2.getElem$1194 = function(id$1197){var v$1202 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(js$0Js$1.document$88,id$1197);
switch (v$1202[0]) { case 0: {return v$1202[1];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"getElem"];
} };
};
var fix$10259 = {};
fix$10259.$app = function(v$3125){lab$app: while (true) {if (v$3125 == null) {return 0;
} else {var v$3126 = v$3125;
var v$3127 = v$3126[0];
var v$3128 = v$3126[1];
var v$6325 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111);
switch (v$6325[0]) { case 0: {var t$10263 = v$6325[1];
var t$10260;
var attrs$6326 = [["type","text/javascript"],[["src",v$3127],null]];
var newelem$6327 = document.createElement("script");
var fix$10261 = {};
fix$10261.$app = function(v$6329){lab$app: while (true) {if (v$6329 == null) {return 0;
} else {var v$6330 = v$6329;
var v$6331 = v$6330[0];
var v$6332 = v$6330[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$6327,v$6331[0],v$6331[1]);
var t$10262 = v$6332;
var v$6329 = t$10262;
continue lab$app;
};
};
};
var app$6328 = fix$10261.$app;
app$6328(attrs$6326);
t$10260 = newelem$6327;
(function(e,a){return e.appendChild(a);})(t$10263,t$10260);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"appendScript"];
} };
var t$10264 = v$3128;
var v$3125 = t$10264;
continue lab$app;
};
};
};
var app$3124 = fix$10259.$app;
app$3124(smltojs0$0SmlToJsCompApp$1$1.script_paths$88);
smltojs0$0SmlToJsCompApp$1$2.mkEditor$1206 = function(inarea$1209){var t$10267;
var fix$10265 = {};
fix$10265.$exists = function(v$3132){lab$exists: while (true) {if (v$3132 == null) {return false;
} else {var v$3133 = v$3132;
var v$3134 = v$3133[0];
var v$3135 = v$3133[1];
if (basis$0String$1.isSubstring$268(v$3134,smltojs0$0SmlToJsCompApp$1$2.agent$940)) {return true;
} else {var t$10266 = v$3135;
var v$3132 = t$10266;
continue lab$exists;
};
};
};
};
var exists$3131 = fix$10265.$exists;
t$10267 = (exists$3131(smltojs0$0SmlToJsCompApp$1$2.touchDevices$941));
if (t$10267) {return [function(v$1215){return (function(e){return e.value;})(inarea$1209);
},function(s$1218){var v$1223 = (function(e){return SmlPrims.option(e.firstChild);})(inarea$1209);
switch (v$1223[0]) { case 0: {var v$1225 = v$1223[1];
return (function(e,a,old){return e.replaceChild(a,old);})(inarea$1209,document.createTextNode(s$1218),v$1225);
 break; }default: {return (function(e,a){return e.appendChild(a);})(inarea$1209,document.createTextNode(s$1218));
} };
}];
} else {var properties$1226;
var t$1227 = (function(){return {};})();
(function(fp,s,v){fp[s] = v;})(t$1227,"textWrapping",true);
(function(fp,s,v){fp[s] = v;})(t$1227,"lineNumbers",true);
(function(fp,s,v){fp[s] = v;})(t$1227,"height","100%");
(function(fp,s,v){fp[s] = v;})(t$1227,"width","100%");
(function(fp,s,v){fp[s] = v;})(t$1227,"mode","sml");
properties$1226 = t$1227;
var ed$1238 = (function(e,props){return CodeMirror.fromTextArea(e,props);})(inarea$1209,properties$1226);
return [function(v$1242){return (function(e){return e.getValue();})(ed$1238);
},function(s$1245){return (function(e,s){return e.setValue(s);})(ed$1238,s$1245);
}];
};
};
smltojs0$0SmlToJsCompApp$1$2.exec_print$1250 = function(f$1253,v$1256){var p_old$1257 = basis$0Control$1.printer_get$55(0);
var buf$1258 = [null];
basis$0Control$1.printer_set$54(function(s$3163){return (buf$1258[0] = [s$3163,buf$1258[0]],0);
});
try {f$1253(v$1256);
} catch(v$10268) {(function(v$1270){return 0;
})(v$10268);
};
var res$1265 = SmlPrims.concat(basis$0List$1.rev$682(buf$1258[0]));
basis$0Control$1.printer_set$54(p_old$1257);
return res$1265;
};
smltojs0$0SmlToJsCompApp$1$2.compileAndRunEditor$1272 = function(f$1275,editor$1278){var res$1279;
var v$3168 = editor$1278[0](0);
var p_old$3169 = basis$0Control$1.printer_get$55(0);
var buf$3170 = [null];
basis$0Control$1.printer_set$54(function(s$3171){return (buf$3170[0] = [s$3171,buf$3170[0]],0);
});
try {smltojs0$0SmlToJsCompApp$1$1.compute$102(f$1275,v$3168);
} catch(v$10269) {(function(v$3173){return 0;
})(v$10269);
};
var res$3174 = SmlPrims.concat(basis$0List$1.rev$682(buf$3170[0]));
basis$0Control$1.printer_set$54(p_old$3169);
res$1279 = res$3174;
return smltojs0$0SmlToJsCompApp$1$2.outRef$1053[0](res$1279);
};
smltojs0$0SmlToJsCompApp$1$2.noop$1284 = function(v$1286){return 0;
};
smltojs0$0SmlToJsCompApp$1$2.put$1287 = function(s$1290,v$1292){var s$3176 = s$1290 + "\n";
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.outarea$973,document.createTextNode(s$3176));
return (function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.outarea$973);
};
smltojs0$0SmlToJsCompApp$1$2.logo$1293;
var attrs$3183 = [["src","smltojs_logo_transparent_small.png"],[["height","30px"],[["alt","SMLtoJs Online"],null]]];
var newelem$3184 = document.createElement("img");
var fix$10270 = {};
fix$10270.$app = function(v$3186){lab$app: while (true) {if (v$3186 == null) {return 0;
} else {var v$3187 = v$3186;
var v$3188 = v$3187[0];
var v$3189 = v$3187[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$3184,v$3188[0],v$3188[1]);
var t$10271 = v$3189;
var v$3186 = t$10271;
continue lab$app;
};
};
};
var app$3185 = fix$10270.$app;
app$3185(attrs$3183);
smltojs0$0SmlToJsCompApp$1$2.logo$1293 = newelem$3184;
smltojs0$0SmlToJsCompApp$1$2.menuStyle$1294 = ["style","border:0;padding:2;"];
smltojs0$0SmlToJsCompApp$1$2.qq$1295 = function(s$1298){return ("'" + s$1298) + "'";
};
smltojs0$0SmlToJsCompApp$1$2.s$rr$1299 = function(v$1310,v$10006){switch (v$1310) { case "0": {return v$10006;
 break; }default: {return (v$1310 + "/") + v$10006;
} };
};
smltojs0$0SmlToJsCompApp$1$2.okExt$1313 = function(s$1316){var fix$10272 = {};
fix$10272.$exists = function(v$3199){lab$exists: while (true) {if (v$3199 == null) {return false;
} else {var v$3200 = v$3199;
var v$3201 = v$3200[0];
var v$3202 = v$3200[1];
if (s$1316 == v$3201) {return true;
} else {var t$10273 = v$3202;
var v$3199 = t$10273;
continue lab$exists;
};
};
};
};
var exists$3198 = fix$10272.$exists;
return exists$3198(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211);
};
smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320 = function(n$1323){if (n$1323.length > 0) {var t$10274;
var c$3215;
if (0 >= n$1323.length) {throw CompilerInitial.exn$Subscript$52;
} else {c$3215 = (n$1323.charCodeAt(0));
};
t$10274 = (((97 <= c$3215)?(c$3215 <= 122):false)?true:((65 <= c$3215)?(c$3215 <= 90):false));
if (t$10274) {var stop$3221 = n$1323.length;
var fix$10275 = {};
fix$10275.$lr = function(j$3223){lab$lr: while (true) {if (j$3223 >= stop$3221) {return true;
} else {var t$10276;
var c$6333 = n$1323.charCodeAt(j$3223);
t$10276 = (((((97 <= c$6333)?(c$6333 <= 122):false)?true:((65 <= c$6333)?(c$6333 <= 90):false))?true:((48 <= c$6333)?(c$6333 <= 57):false))?true:((c$6333 == 95)?true:(c$6333 == 45)));
if (t$10276) {var t$10277 = SmlPrims.chk_ovf_i32(j$3223 + 1);
var j$3223 = t$10277;
continue lab$lr;
} else {return false;
};
};
};
};
var lr$3222 = fix$10275.$lr;
return lr$3222(0);
} else {return false;
};
} else {return false;
};
};
smltojs0$0SmlToJsCompApp$1$2.okFileName$1343 = function(n$1346){var v$1354 = basis$0String$1.fields$231(function(c$1370){return c$1370 == 46;
},n$1346);
if (v$1354 == null) {return false;
} else {var v$1356 = v$1354;
var v$1357 = v$1356[1];
if (v$1357 == null) {return false;
} else {var v$1359 = v$1357;
if (v$1359[1] == null) {var v$1365 = v$1356[0];
var v$1366 = v$1359[0];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$1365)) {var fix$10278 = {};
fix$10278.$exists = function(v$3227){lab$exists: while (true) {if (v$3227 == null) {return false;
} else {var v$3228 = v$3227;
var v$3229 = v$3228[0];
var v$3230 = v$3228[1];
if (v$1366 == v$3229) {return true;
} else {var t$10279 = v$3230;
var v$3227 = t$10279;
continue lab$exists;
};
};
};
};
var exists$3226 = fix$10278.$exists;
return exists$3226(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211);
} else {return false;
};
} else {return false;
};
};
};
};
smltojs0$0SmlToJsCompApp$1$2.okFolderPath$1371 = function(p$1374){if (p$1374 == "0") {return true;
} else {var fields$1379 = basis$0String$1.fields$231(function(c$1382){return c$1382 == 47;
},p$1374);
var fix$10280 = {};
fix$10280.$all = function(v$3245){lab$all: while (true) {if (v$3245 == null) {return true;
} else {var v$3246 = v$3245;
var v$3247 = v$3246[0];
var v$3248 = v$3246[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$3247)) {var t$10281 = v$3248;
var v$3245 = t$10281;
continue lab$all;
} else {return false;
};
};
};
};
var all$3244 = fix$10280.$all;
return all$3244(fields$1379);
};
};
smltojs0$0SmlToJsCompApp$1$2.okFilePath$1383 = function(p$1386){var fields$1387 = basis$0String$1.fields$231(function(c$1390){return c$1390 == 47;
},p$1386);
var v$1396 = basis$0List$1.rev$682(fields$1387);
if (v$1396 == null) {return false;
} else {var v$1402 = v$1396;
var v$1403 = v$1402[0];
var v$1404 = v$1402[1];
var t$10284;
var v$6336 = basis$0String$1.fields$231(function(c$6337){return c$6337 == 46;
},v$1403);
if (v$6336 == null) {t$10284 = false;
} else {var v$6338 = v$6336;
var v$6339 = v$6338[1];
if (v$6339 == null) {t$10284 = false;
} else {var v$6340 = v$6339;
if (v$6340[1] == null) {var v$6341 = v$6338[0];
var v$6342 = v$6340[0];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$6341)) {var fix$10285 = {};
fix$10285.$exists = function(v$6344){lab$exists: while (true) {if (v$6344 == null) {return false;
} else {var v$6345 = v$6344;
var v$6346 = v$6345[0];
var v$6347 = v$6345[1];
if (v$6342 == v$6346) {return true;
} else {var t$10286 = v$6347;
var v$6344 = t$10286;
continue lab$exists;
};
};
};
};
var exists$6343 = fix$10285.$exists;
t$10284 = (exists$6343(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211));
} else {t$10284 = false;
};
} else {t$10284 = false;
};
};
};
if (t$10284) {var fix$10282 = {};
fix$10282.$all = function(v$3251){lab$all: while (true) {if (v$3251 == null) {return true;
} else {var v$3252 = v$3251;
var v$3253 = v$3252[0];
var v$3254 = v$3252[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$3253)) {var t$10283 = v$3254;
var v$3251 = t$10283;
continue lab$all;
} else {return false;
};
};
};
};
var all$3250 = fix$10282.$all;
return all$3250(v$1404);
} else {return false;
};
};
};
smltojs0$0SmlToJsCompApp$1$2.allfiles$1405 = [null];
smltojs0$0SmlToJsCompApp$1$2.alldirs$1406 = [["0",null]];
smltojs0$0SmlToJsCompApp$1$2.filesTable$1407 = [[1]];
smltojs0$0SmlToJsCompApp$1$2.current$1408 = ["0"];
smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409 = [null];
smltojs0$0SmlToJsCompApp$1$2.splitPath$1410 = function(p$1413){if (p$1413 == "0") {return [p$1413,[1]];
} else {var fields$1418 = basis$0String$1.fields$231(function(c$1421){return c$1421 == 47;
},p$1413);
var v$1430 = basis$0List$1.rev$682(fields$1418);
if (v$1430 == null) {throw [basis$0Initial$1.en$Fail$54,"impossible: splitPath"];
} else {var v$1432 = v$1430;
var v$1433 = v$1432[1];
if (v$1433 == null) {var v$1438 = v$1432[0];
var t$10287;
var v$6350 = basis$0String$1.fields$231(function(c$6351){return c$6351 == 46;
},v$1438);
if (v$6350 == null) {t$10287 = false;
} else {var v$6352 = v$6350;
var v$6353 = v$6352[1];
if (v$6353 == null) {t$10287 = false;
} else {var v$6354 = v$6353;
if (v$6354[1] == null) {var v$6355 = v$6352[0];
var v$6356 = v$6354[0];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$6355)) {var fix$10288 = {};
fix$10288.$exists = function(v$6358){lab$exists: while (true) {if (v$6358 == null) {return false;
} else {var v$6359 = v$6358;
var v$6360 = v$6359[0];
var v$6361 = v$6359[1];
if (v$6356 == v$6360) {return true;
} else {var t$10289 = v$6361;
var v$6358 = t$10289;
continue lab$exists;
};
};
};
};
var exists$6357 = fix$10288.$exists;
t$10287 = (exists$6357(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211));
} else {t$10287 = false;
};
} else {t$10287 = false;
};
};
};
return t$10287?["0",[0,v$1438]]:[v$1438,[1]];
} else {var v$1443 = v$1432[0];
var t$10290;
var v$6363 = basis$0String$1.fields$231(function(c$6364){return c$6364 == 46;
},v$1443);
if (v$6363 == null) {t$10290 = false;
} else {var v$6365 = v$6363;
var v$6366 = v$6365[1];
if (v$6366 == null) {t$10290 = false;
} else {var v$6367 = v$6366;
if (v$6367[1] == null) {var v$6368 = v$6365[0];
var v$6369 = v$6367[0];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$6368)) {var fix$10291 = {};
fix$10291.$exists = function(v$6371){lab$exists: while (true) {if (v$6371 == null) {return false;
} else {var v$6372 = v$6371;
var v$6373 = v$6372[0];
var v$6374 = v$6372[1];
if (v$6369 == v$6373) {return true;
} else {var t$10292 = v$6374;
var v$6371 = t$10292;
continue lab$exists;
};
};
};
};
var exists$6370 = fix$10291.$exists;
t$10290 = (exists$6370(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211));
} else {t$10290 = false;
};
} else {t$10290 = false;
};
};
};
return t$10290?[basis$0String$1.concatWith$182("/",basis$0List$1.rev$682(v$1433)),[0,v$1443]]:[p$1413,[1]];
};
};
};
};
smltojs0$0SmlToJsCompApp$1$2.splitFolderPath$1444 = function(p$1447){if (p$1447 == "0") {return [p$1447,[1]];
} else {var fields$1452 = basis$0String$1.fields$231(function(c$1455){return c$1455 == 47;
},p$1447);
var v$1464 = basis$0List$1.rev$682(fields$1452);
if (v$1464 == null) {throw [basis$0Initial$1.en$Fail$54,"impossible: splitFolderPath"];
} else {var v$1466 = v$1464;
var v$1467 = v$1466[1];
if (v$1467 == null) {var v$1472 = v$1466[0];
return (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$1472))?["0",[0,v$1472]]:[v$1472,[1]];
} else {var v$1477 = v$1466[0];
return (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$1477))?[basis$0String$1.concatWith$182("/",basis$0List$1.rev$682(v$1467)),[0,v$1477]]:[p$1447,[1]];
};
};
};
};
smltojs0$0SmlToJsCompApp$1$2.currentFolder$1478 = function(v$1480){return (smltojs0$0SmlToJsCompApp$1$2.splitPath$1410(smltojs0$0SmlToJsCompApp$1$2.current$1408[0]))[0];
};
smltojs0$0SmlToJsCompApp$1$2.currentFile$1485 = function(v$1487){var t$10293;
var p$3264 = smltojs0$0SmlToJsCompApp$1$2.current$1408[0];
var fields$3265 = basis$0String$1.fields$231(function(c$3266){return c$3266 == 47;
},p$3264);
var v$3267 = basis$0List$1.rev$682(fields$3265);
if (v$3267 == null) {t$10293 = false;
} else {var v$3268 = v$3267;
var v$3269 = v$3268[0];
var v$3270 = v$3268[1];
var t$10296;
var v$6377 = basis$0String$1.fields$231(function(c$6378){return c$6378 == 46;
},v$3269);
if (v$6377 == null) {t$10296 = false;
} else {var v$6379 = v$6377;
var v$6380 = v$6379[1];
if (v$6380 == null) {t$10296 = false;
} else {var v$6381 = v$6380;
if (v$6381[1] == null) {var v$6382 = v$6379[0];
var v$6383 = v$6381[0];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$6382)) {var fix$10297 = {};
fix$10297.$exists = function(v$6385){lab$exists: while (true) {if (v$6385 == null) {return false;
} else {var v$6386 = v$6385;
var v$6387 = v$6386[0];
var v$6388 = v$6386[1];
if (v$6383 == v$6387) {return true;
} else {var t$10298 = v$6388;
var v$6385 = t$10298;
continue lab$exists;
};
};
};
};
var exists$6384 = fix$10297.$exists;
t$10296 = (exists$6384(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211));
} else {t$10296 = false;
};
} else {t$10296 = false;
};
};
};
if (t$10296) {var fix$10294 = {};
fix$10294.$all = function(v$3272){lab$all: while (true) {if (v$3272 == null) {return true;
} else {var v$3273 = v$3272;
var v$3274 = v$3273[0];
var v$3275 = v$3273[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$3274)) {var t$10295 = v$3275;
var v$3272 = t$10295;
continue lab$all;
} else {return false;
};
};
};
};
var all$3271 = fix$10294.$all;
t$10293 = (all$3271(v$3270));
} else {t$10293 = false;
};
};
return t$10293?[0,smltojs0$0SmlToJsCompApp$1$2.current$1408[0]]:[1];
};
smltojs0$0SmlToJsCompApp$1$2.currentIsFolder$1492 = function(v$1494){var t$10299;
var p$3278 = smltojs0$0SmlToJsCompApp$1$2.current$1408[0];
if (p$3278 == "0") {t$10299 = true;
} else {var fields$3284 = basis$0String$1.fields$231(function(c$3285){return c$3285 == 47;
},p$3278);
var fix$10300 = {};
fix$10300.$all = function(v$3287){lab$all: while (true) {if (v$3287 == null) {return true;
} else {var v$3288 = v$3287;
var v$3289 = v$3288[0];
var v$3290 = v$3288[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$3289)) {var t$10301 = v$3290;
var v$3287 = t$10301;
continue lab$all;
} else {return false;
};
};
};
};
var all$3286 = fix$10300.$all;
t$10299 = (all$3286(fields$3284));
};
return t$10299?[0,smltojs0$0SmlToJsCompApp$1$2.current$1408[0]]:[1];
};
smltojs0$0SmlToJsCompApp$1$2.fileExists$1499 = function(name$1502){var fix$10302 = {};
fix$10302.$exists = function(v$3299){lab$exists: while (true) {if (v$3299 == null) {return false;
} else {var v$3300 = v$3299;
var v$3301 = v$3300[0];
var v$3302 = v$3300[1];
if (v$3301 == name$1502) {return true;
} else {var t$10303 = v$3302;
var v$3299 = t$10303;
continue lab$exists;
};
};
};
};
var exists$3298 = fix$10302.$exists;
return exists$3298(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0]);
};
smltojs0$0SmlToJsCompApp$1$2.folderExists$1506 = function(name$1509){var fix$10304 = {};
fix$10304.$exists = function(v$3320){lab$exists: while (true) {if (v$3320 == null) {return false;
} else {var v$3321 = v$3320;
var v$3322 = v$3321[0];
var v$3323 = v$3321[1];
if (v$3322 == name$1509) {return true;
} else {var t$10305 = v$3323;
var v$3320 = t$10305;
continue lab$exists;
};
};
};
};
var exists$3319 = fix$10304.$exists;
return exists$3319(smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0]);
};
smltojs0$0SmlToJsCompApp$1$2.isServerPath$1513 = function(p$1516){var v$1521 = basis$0String$1.tokens$224(function(c$1528){return c$1528 == 47;
},p$1516);
if (v$1521 == null) {return false;
} else {var v$1523 = v$1521;
switch (v$1523[0]) { case "Server": {return true;
 break; }default: {return false;
} };
};
};
smltojs0$0SmlToJsCompApp$1$2.load$1607 = function(c$1610,fts$1613){return (function(dsm,thef){return dsm.openDefaultDatastore(function(err,ds) {thef([err,ds]);});})((function(obj){return obj.getDatastoreManager();})(c$1610),function(v$1618){var v$1624 = v$1618[1];
var thefilesTable$1619 = (function(obj,a1){return obj.getTable(a1);})(v$1624,"files");
(smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0] = [0,thefilesTable$1619],0);
var fileRecords$1621 = appfun2$0dropbox$1.allRecords$260(thefilesTable$1619);
var fix$10306 = {};
fix$10306.$app = function(v$3422){lab$app: while (true) {if (v$3422 == null) {return 0;
} else {var v$3423 = v$3422;
var v$3424 = v$3423[0];
var v$3425 = v$3423[1];
var loadDir$6403 = function(p$6404,n$6405){var d$6406;
switch (p$6404) { case "0": {d$6406 = n$6405;
 break; }default: {d$6406 = ((p$6404 + "/") + n$6405);
} };
var t$10309;
var fix$10307 = {};
fix$10307.$exists = function(v$6408){lab$exists: while (true) {if (v$6408 == null) {return false;
} else {var v$6409 = v$6408;
var v$6410 = v$6409[0];
var v$6411 = v$6409[1];
if (d$6406 == v$6410) {return true;
} else {var t$10308 = v$6411;
var v$6408 = t$10308;
continue lab$exists;
};
};
};
};
var exists$6407 = fix$10307.$exists;
t$10309 = (exists$6407(smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0]));
if (t$10309) {return 0;
} else {var h$6412 = [["id",d$6406],[["parent",p$6404],[["name",n$6405],[["kind","folder"],null]]]];
var t$10315 = fts$1613;
var t$10314;
var fix$10310 = {};
fix$10310.$foldl = function(v$6414,v$6415){lab$foldl: while (true) {if (v$6415 == null) {return v$6414;
} else {var v$6416 = v$6415;
var v$6417 = v$6416[0];
var v$6418 = v$6416[1];
var t$10311;
var v$6419 = v$6417[0];
var v$6420 = v$6417[1];
(function(fp,s,v){fp[s] = v;})(v$6414,v$6419,v$6420);
t$10311 = v$6414;
var t$10312 = t$10311;
var t$10313 = v$6418;
var v$6414 = t$10312;
var v$6415 = t$10313;
continue lab$foldl;
};
};
};
var foldl$6413 = fix$10310.$foldl;
var v$10048 = (function(){return {};})();
t$10314 = (foldl$6413(v$10048,h$6412));
(function(obj,a){return obj.add(a);})(t$10315,t$10314);
return (smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0] = [d$6406,smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0]],0);
};
};
var name$6421 = (function(obj,a1){return obj.get(a1);})(v$3424,"name");
var v$6422;
var fields$6423 = basis$0String$1.fields$231((function(env$10316){return function(c$6424){return c$6424 == 47;
};
})([]),name$6421);
var fix$10317 = {};
fix$10317.$loop = function(v$6426,v$6427){lab$loop: while (true) {if (v$6427 == null) {throw [basis$0Initial$1.en$Fail$54,"loadDirs.impossible"];
} else {var v$6428 = v$6427;
var v$6429 = v$6428[1];
if (v$6429 == null) {var v$6430 = v$6428[0];
var t$10319;
var v$6432 = basis$0String$1.fields$231((function(env$10318){return function(c$6433){return c$6433 == 46;
};
})([]),v$6430);
if (v$6432 == null) {t$10319 = false;
} else {var v$6434 = v$6432;
var v$6435 = v$6434[1];
if (v$6435 == null) {t$10319 = false;
} else {var v$6436 = v$6435;
if (v$6436[1] == null) {var v$6437 = v$6434[0];
var v$6438 = v$6436[0];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$6437)) {var fix$10320 = {};
fix$10320.$exists = function(v$6440){lab$exists: while (true) {if (v$6440 == null) {return false;
} else {var v$6441 = v$6440;
var v$6442 = v$6441[0];
var v$6443 = v$6441[1];
if (v$6438 == v$6442) {return true;
} else {var t$10321 = v$6443;
var v$6440 = t$10321;
continue lab$exists;
};
};
};
};
var exists$6439 = fix$10320.$exists;
t$10319 = (exists$6439(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211));
} else {t$10319 = false;
};
} else {t$10319 = false;
};
};
};
if (t$10319) {return [0,[v$6426,v$6430]];
} else {loadDir$6403(v$6426,v$6430);
return [1];
};
} else {var v$6444 = v$6428[0];
loadDir$6403(v$6426,v$6444);
var t$10322;
switch (v$6426) { case "0": {t$10322 = v$6444;
 break; }default: {t$10322 = ((v$6426 + "/") + v$6444);
} };
var t$10323 = t$10322;
var t$10324 = v$6429;
var v$6426 = t$10323;
var v$6427 = t$10324;
continue lab$loop;
};
};
};
};
var loop$6425 = fix$10317.$loop;
v$6422 = (loop$6425("0",fields$6423));
switch (v$6422[0]) { case 1: {0;
 break; }default: {var v$6445 = v$6422[1];
var v$6446 = v$6445[0];
var v$6447 = v$6445[1];
var h$6448 = [["id",name$6421],[["parent",v$6446],[["name",v$6447],[["kind","leaf"],null]]]];
var t$10330 = fts$1613;
var t$10329;
var fix$10325 = {};
fix$10325.$foldl = function(v$6450,v$6451){lab$foldl: while (true) {if (v$6451 == null) {return v$6450;
} else {var v$6452 = v$6451;
var v$6453 = v$6452[0];
var v$6454 = v$6452[1];
var t$10326;
var v$6455 = v$6453[0];
var v$6456 = v$6453[1];
(function(fp,s,v){fp[s] = v;})(v$6450,v$6455,v$6456);
t$10326 = v$6450;
var t$10327 = t$10326;
var t$10328 = v$6454;
var v$6450 = t$10327;
var v$6451 = t$10328;
continue lab$foldl;
};
};
};
var foldl$6449 = fix$10325.$foldl;
var v$10050 = (function(){return {};})();
t$10329 = (foldl$6449(v$10050,h$6448));
(function(obj,a){return obj.add(a);})(t$10330,t$10329);
(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0] = [name$6421,smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0]],0);
} };
var t$10331 = v$3425;
var v$3422 = t$10331;
continue lab$app;
};
};
};
var app$3421 = fix$10306.$app;
return app$3421(fileRecords$1621);
});
};
smltojs0$0SmlToJsCompApp$1$2.getFileRecord$1625 = function(filename$1628){var v$1633 = smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0];
switch (v$1633[0]) { case 0: {var v$1646 = v$1633[1];
var v$1641 = appfun2$0dropbox$1.query$241(v$1646,[["name",filename$1628],null]);
if (v$1641 == null) {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no records in Dropbox table for name=" + filename$1628];
} else {var v$1643 = v$1641;
if (v$1643[1] == null) {return v$1643[0];
} else {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: too many records in Dropbox table for name=" + filename$1628];
};
};
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no filesTable set"];
} };
};
smltojs0$0SmlToJsCompApp$1$2.loadFileContentFromServer$1647 = function(f$1650){var v$1655 = basis$0List$1.rev$682(basis$0String$1.tokens$224(function(c$1664){return c$1664 == 47;
},f$1650));
if (v$1655 == null) {throw [basis$0Initial$1.en$Fail$54,"failed to load server file content for " + f$1650];
} else {var v$1660 = v$1655;
var v$1661 = v$1660[0];
var c$1657;
var file$6457 = ("otests/" + v$1661) + "_";
var file$6458;
var t$10335 = file$6457 + "?_=";
var t$10334;
var t$10333 = basis$0Real$1.toString$153;
var t$10332;
var v$6459 = SmlPrims.getrealtime();
t$10332 = ((v$6459[0] - (-2147483648)) + (v$6459[1] / 1000000.0));
t$10334 = (t$10333(t$10332));
file$6458 = (t$10335 + t$10334);
var r$6460 = SmlPrims.newRequest();
(function(r,m,u,a){return r.open(m,u,a);})(r$6460,"GET",file$6458,false);
js$0Js$1.send$654(r$6460,[1]);
var v$6461 = (function(r){return SmlPrims.option(r.responseText);})(r$6460);
switch (v$6461[0]) { case 0: {c$1657 = v$6461[1];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"serverGet failed on file " + file$6458];
} };
var s$3500 = ("loaded file " + (("'" + f$1650) + "'")) + " from server";
notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,s$3500);
var s$3502;
var t$10341;
var t$10340;
var t$10339;
var t$10338 = basis$0Date$1.fmt$816;
var t$10337 = "%H:%M:%S";
var t$10336;
var v$10007 = SmlPrims.getrealtime();
t$10336 = (basis$0Date$1.fromTimeLocal$512(v$10007[0],v$10007[1]));
t$10339 = (t$10338(t$10337,t$10336));
t$10340 = (t$10339 + ": ");
t$10341 = (t$10340 + s$3500);
s$3502 = (t$10341 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$3502));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
return c$1657;
};
};
smltojs0$0SmlToJsCompApp$1$2.loadFileContent$1665 = function(filename$1668){var t$10345;
var fix$10343 = {};
fix$10343.$exists = function(v$3519){lab$exists: while (true) {if (v$3519 == null) {return false;
} else {var v$3520 = v$3519;
var v$3521 = v$3520[0];
var v$3522 = v$3520[1];
if (v$3521[0] == filename$1668) {return true;
} else {var t$10344 = v$3522;
var v$3519 = t$10344;
continue lab$exists;
};
};
};
};
var exists$3518 = fix$10343.$exists;
t$10345 = (exists$3518(smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0]));
if (t$10345) {(smltojs0$0SmlToJsCompApp$1$2.current$1408[0] = filename$1668,0);
return [1];
} else {var t$10342;
var v$3538 = basis$0String$1.tokens$224(function(c$3539){return c$3539 == 47;
},filename$1668);
if (v$3538 == null) {t$10342 = false;
} else {var v$3540 = v$3538;
switch (v$3540[0]) { case "Server": {t$10342 = true;
 break; }default: {t$10342 = false;
} };
};
if (t$10342) {return [0,smltojs0$0SmlToJsCompApp$1$2.loadFileContentFromServer$1647(filename$1668)];
} else {var r$1679;
var v$3542 = smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0];
switch (v$3542[0]) { case 0: {var v$3543 = v$3542[1];
var v$3544 = appfun2$0dropbox$1.query$241(v$3543,[["name",filename$1668],null]);
if (v$3544 == null) {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no records in Dropbox table for name=" + filename$1668];
} else {var v$3545 = v$3544;
if (v$3545[1] == null) {r$1679 = v$3545[0];
} else {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: too many records in Dropbox table for name=" + filename$1668];
};
};
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no filesTable set"];
} };
var c$1680 = (function(obj,a1){return obj.get(a1);})(r$1679,"content");
(smltojs0$0SmlToJsCompApp$1$2.current$1408[0] = filename$1668,0);
var s$3551 = "Loaded file " + (("'" + filename$1668) + "'");
notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,s$3551);
var s$3553;
var t$10351;
var t$10350;
var t$10349;
var t$10348 = basis$0Date$1.fmt$816;
var t$10347 = "%H:%M:%S";
var t$10346;
var v$10008 = SmlPrims.getrealtime();
t$10346 = (basis$0Date$1.fromTimeLocal$512(v$10008[0],v$10008[1]));
t$10349 = (t$10348(t$10347,t$10346));
t$10350 = (t$10349 + ": ");
t$10351 = (t$10350 + s$3551);
s$3553 = (t$10351 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$3553));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
return [0,c$1680];
};
};
};
smltojs0$0SmlToJsCompApp$1$2.treeStoreRemoveExceptServer$1689 = function(fts$1692,id$1695){var t$10352;
var v$3563 = basis$0String$1.tokens$224(function(c$3564){return c$3564 == 47;
},id$1695);
if (v$3563 == null) {t$10352 = false;
} else {var v$3565 = v$3563;
switch (v$3565[0]) { case "Server": {t$10352 = true;
 break; }default: {t$10352 = false;
} };
};
return t$10352?0:((function(obj,a){return obj.remove(a);})(fts$1692,id$1695));
};
smltojs0$0SmlToJsCompApp$1$2.clear$1700 = function(fts$1703,closetab$1706){var v$1736 = smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0];
switch (v$1736[0]) { case 0: {var v$1739 = v$1736[1];
var rs$1738 = appfun2$0dropbox$1.allRecords$260(v$1739);
var fix$10353 = {};
fix$10353.$app = function(v$3571){lab$app: while (true) {if (v$3571 == null) {return 0;
} else {var v$3572 = v$3571;
var v$3573 = v$3572[0];
var v$3574 = v$3572[1];
(function(obj){return obj.deleteRecord();})(v$3573);
var t$10354 = v$3574;
var v$3571 = t$10354;
continue lab$app;
};
};
};
var app$3570 = fix$10353.$app;
app$3570(rs$1738);
 break; }default: {0;
} };
var fix$10355 = {};
fix$10355.$app = function(v$3579){lab$app: while (true) {if (v$3579 == null) {return 0;
} else {var v$3580 = v$3579;
var v$3581 = v$3580[0];
var v$3582 = v$3580[1];
var t$10357;
var v$6463 = basis$0String$1.tokens$224((function(env$10356){return function(c$6464){return c$6464 == 47;
};
})([]),v$3581);
if (v$6463 == null) {t$10357 = false;
} else {var v$6465 = v$6463;
switch (v$6465[0]) { case "Server": {t$10357 = true;
 break; }default: {t$10357 = false;
} };
};
t$10357?0:((function(obj,a){return obj.remove(a);})(fts$1703,v$3581));
var t$10358 = v$3582;
var v$3579 = t$10358;
continue lab$app;
};
};
};
var app$3578 = fix$10355.$app;
app$3578(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0]);
var fix$10359 = {};
fix$10359.$app = function(v$3598){lab$app: while (true) {if (v$3598 == null) {return 0;
} else {var v$3599 = v$3598;
var v$3600 = v$3599[0];
var v$3601 = v$3599[1];
if ((v$3600 == "0")?false:true) {var t$10361;
var v$3622 = basis$0String$1.tokens$224((function(env$10360){return function(c$3623){return c$3623 == 47;
};
})([]),v$3600);
if (v$3622 == null) {t$10361 = false;
} else {var v$3624 = v$3622;
switch (v$3624[0]) { case "Server": {t$10361 = true;
 break; }default: {t$10361 = false;
} };
};
t$10361?0:((function(obj,a){return obj.remove(a);})(fts$1703,v$3600));
} else {0;
};
var t$10362 = v$3601;
var v$3598 = t$10362;
continue lab$app;
};
};
};
var app$3597 = fix$10359.$app;
app$3597(smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0]);
(smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0] = ["0",null],0);
(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0] = null,0);
(smltojs0$0SmlToJsCompApp$1$2.current$1408[0] = "0",0);
var fix$10363 = {};
fix$10363.$app = function(v$3635){lab$app: while (true) {if (v$3635 == null) {return 0;
} else {var v$3636 = v$3635;
var v$3637 = v$3636[0];
var v$3638 = v$3636[1];
var v$3640 = v$3637[0];
closetab$1706(v$3640);
var t$10364 = v$3638;
var v$3635 = t$10364;
continue lab$app;
};
};
};
var app$3634 = fix$10363.$app;
app$3634(smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0]);
return (smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0] = null,0);
};
smltojs0$0SmlToJsCompApp$1$2.mkAbsPath$1740 = function(n$1743){var v$1748 = (smltojs0$0SmlToJsCompApp$1$2.splitPath$1410(smltojs0$0SmlToJsCompApp$1$2.current$1408[0]))[0];
switch (v$1748) { case "0": {return n$1743;
 break; }default: {return (v$1748 + "/") + n$1743;
} };
};
var count$1749 = [0];
smltojs0$0SmlToJsCompApp$1$2.suggestNewFileName$1818 = function(base$1821){var fix$10365 = {};
fix$10365.$suggest = function(f$6480){lab$suggest: while (true) {var num$6481 = [count$1749[0],(count$1749[0] = (SmlPrims.chk_ovf_i32(count$1749[0] + 1)),0)][0];
var name$6484 = f$6480(num$6481);
var t$10368;
var fix$10366 = {};
fix$10366.$exists = function(v$6487){lab$exists: while (true) {if (v$6487 == null) {return false;
} else {var v$6488 = v$6487;
var v$6489 = v$6488[0];
var v$6490 = v$6488[1];
if (v$6489 == name$6484) {return true;
} else {var t$10367 = v$6490;
var v$6487 = t$10367;
continue lab$exists;
};
};
};
};
var exists$6486 = fix$10366.$exists;
t$10368 = (exists$6486(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0]));
if (t$10368) {var t$10369 = f$6480;
var f$6480 = t$10369;
continue lab$suggest;
} else {return name$6484;
};
};
};
var suggest$6479 = fix$10365.$suggest;
return suggest$6479(function(num$1824){return ((base$1821 + "-") + (basis$0Int32$1.toString$458(num$1824))) + ".sml";
});
};
smltojs0$0SmlToJsCompApp$1$2.suggestNewFolderName$1825 = function(v$1827){var fix$10370 = {};
fix$10370.$suggest = function(f$6505){lab$suggest: while (true) {var num$6506 = [count$1749[0],(count$1749[0] = (SmlPrims.chk_ovf_i32(count$1749[0] + 1)),0)][0];
var name$6509 = f$6505(num$6506);
var t$10373;
var fix$10371 = {};
fix$10371.$exists = function(v$6512){lab$exists: while (true) {if (v$6512 == null) {return false;
} else {var v$6513 = v$6512;
var v$6514 = v$6513[0];
var v$6515 = v$6513[1];
if (v$6514 == name$6509) {return true;
} else {var t$10372 = v$6515;
var v$6512 = t$10372;
continue lab$exists;
};
};
};
};
var exists$6511 = fix$10371.$exists;
t$10373 = (exists$6511(smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0]));
if (t$10373) {var t$10374 = f$6505;
var f$6505 = t$10374;
continue lab$suggest;
} else {return name$6509;
};
};
};
var suggest$6504 = fix$10370.$suggest;
return suggest$6504(function(num$1830){return "Folder-" + (basis$0Int32$1.toString$458(num$1830));
});
};
smltojs0$0SmlToJsCompApp$1$2.newFile$1831 = function(fts$1834,content$1837,name$1840){var t$10381;
var fix$10379 = {};
fix$10379.$exists = function(v$3739){lab$exists: while (true) {if (v$3739 == null) {return false;
} else {var v$3740 = v$3739;
var v$3741 = v$3740[0];
var v$3742 = v$3740[1];
if (v$3741 == name$1840) {return true;
} else {var t$10380 = v$3742;
var v$3739 = t$10380;
continue lab$exists;
};
};
};
};
var exists$3738 = fix$10379.$exists;
t$10381 = (exists$3738(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0]));
if (t$10381) {throw [basis$0Initial$1.en$Fail$54,"file already exists"];
} else {var t$10378;
var t$10375;
var v$6517 = basis$0String$1.fields$231(function(c$6518){return c$6518 == 46;
},name$1840);
if (v$6517 == null) {t$10375 = false;
} else {var v$6519 = v$6517;
var v$6520 = v$6519[1];
if (v$6520 == null) {t$10375 = false;
} else {var v$6521 = v$6520;
if (v$6521[1] == null) {var v$6522 = v$6519[0];
var v$6523 = v$6521[0];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$6522)) {var fix$10376 = {};
fix$10376.$exists = function(v$6525){lab$exists: while (true) {if (v$6525 == null) {return false;
} else {var v$6526 = v$6525;
var v$6527 = v$6526[0];
var v$6528 = v$6526[1];
if (v$6523 == v$6527) {return true;
} else {var t$10377 = v$6528;
var v$6525 = t$10377;
continue lab$exists;
};
};
};
};
var exists$6524 = fix$10376.$exists;
t$10375 = (exists$6524(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211));
} else {t$10375 = false;
};
} else {t$10375 = false;
};
};
};
t$10378 = (t$10375?false:true);
if (t$10378) {throw [basis$0Initial$1.en$Fail$54,"invalid new file name"];
} else {var lname$3753;
var v$3754 = (smltojs0$0SmlToJsCompApp$1$2.splitPath$1410(smltojs0$0SmlToJsCompApp$1$2.current$1408[0]))[0];
switch (v$3754) { case "0": {lname$3753 = name$1840;
 break; }default: {lname$3753 = ((v$3754 + "/") + name$1840);
} };
var t$10382;
var v$3758 = basis$0String$1.tokens$224(function(c$3759){return c$3759 == 47;
},lname$3753);
if (v$3758 == null) {t$10382 = false;
} else {var v$3760 = v$3758;
switch (v$3760[0]) { case "Server": {t$10382 = true;
 break; }default: {t$10382 = false;
} };
};
if (t$10382) {throw [basis$0Initial$1.en$Fail$54,"You cannot create new files in the Server folder"];
} else {var v$3761 = smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0];
switch (v$3761[0]) { case 0: {var v$3762 = v$3761[1];
var h$3764 = [["name",lname$3753],[["content",content$1837],null]];
var t$10386 = v$3762;
var t$10383;
var hash$3765 = (function(){return {};})();
var fix$10384 = {};
fix$10384.$app = function(v$3767){lab$app: while (true) {if (v$3767 == null) {return 0;
} else {var v$3768 = v$3767;
var v$3769 = v$3768[0];
var v$3770 = v$3768[1];
(function(fp,s,v){fp[s] = v;})(hash$3765,v$3769[0],v$3769[1]);
var t$10385 = v$3770;
var v$3767 = t$10385;
continue lab$app;
};
};
};
var app$3766 = fix$10384.$app;
app$3766(h$3764);
t$10383 = hash$3765;
(function(obj,a1){return obj.insert(a1);})(t$10386,t$10383);
0;
 break; }default: {0;
} };
(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0] = [lname$3753,smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0]],0);
var h$3773 = [["id",lname$3753],[["parent",(smltojs0$0SmlToJsCompApp$1$2.splitPath$1410(smltojs0$0SmlToJsCompApp$1$2.current$1408[0]))[0]],[["name",name$1840],[["kind","leaf"],null]]]];
var t$10392 = fts$1834;
var t$10391;
var fix$10387 = {};
fix$10387.$foldl = function(v$3775,v$3776){lab$foldl: while (true) {if (v$3776 == null) {return v$3775;
} else {var v$3777 = v$3776;
var v$3778 = v$3777[0];
var v$3779 = v$3777[1];
var t$10388;
var v$3780 = v$3778[0];
var v$3781 = v$3778[1];
(function(fp,s,v){fp[s] = v;})(v$3775,v$3780,v$3781);
t$10388 = v$3775;
var t$10389 = t$10388;
var t$10390 = v$3779;
var v$3775 = t$10389;
var v$3776 = t$10390;
continue lab$foldl;
};
};
};
var foldl$3774 = fix$10387.$foldl;
var v$10052 = (function(){return {};})();
t$10391 = (foldl$3774(v$10052,h$3773));
(function(obj,a){return obj.add(a);})(t$10392,t$10391);
(smltojs0$0SmlToJsCompApp$1$2.current$1408[0] = lname$3753,0);
return lname$3753;
};
};
};
};
smltojs0$0SmlToJsCompApp$1$2.newFolder$1849 = function(fts$1852,name$1855){var t$10395;
var fix$10393 = {};
fix$10393.$exists = function(v$3785){lab$exists: while (true) {if (v$3785 == null) {return false;
} else {var v$3786 = v$3785;
var v$3787 = v$3786[0];
var v$3788 = v$3786[1];
if (v$3787 == name$1855) {return true;
} else {var t$10394 = v$3788;
var v$3785 = t$10394;
continue lab$exists;
};
};
};
};
var exists$3784 = fix$10393.$exists;
t$10395 = (exists$3784(smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0]));
if (t$10395) {throw [basis$0Initial$1.en$Fail$54,"folder already exists"];
} else {if ((smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(name$1855))?false:true) {throw [basis$0Initial$1.en$Fail$54,"invalid new folder name"];
} else {var lname$3798;
var v$3799 = (smltojs0$0SmlToJsCompApp$1$2.splitPath$1410(smltojs0$0SmlToJsCompApp$1$2.current$1408[0]))[0];
switch (v$3799) { case "0": {lname$3798 = name$1855;
 break; }default: {lname$3798 = ((v$3799 + "/") + name$1855);
} };
var t$10396;
var v$3803 = basis$0String$1.tokens$224(function(c$3804){return c$3804 == 47;
},lname$3798);
if (v$3803 == null) {t$10396 = false;
} else {var v$3805 = v$3803;
switch (v$3805[0]) { case "Server": {t$10396 = true;
 break; }default: {t$10396 = false;
} };
};
if (t$10396) {throw [basis$0Initial$1.en$Fail$54,"You cannot create new folders in the Server folder"];
} else {var v$3806 = smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0];
switch (v$3806[0]) { case 0: {var v$3807 = v$3806[1];
var h$3809 = [["name",lname$3798],[["content",""],null]];
var t$10400 = v$3807;
var t$10397;
var hash$3810 = (function(){return {};})();
var fix$10398 = {};
fix$10398.$app = function(v$3812){lab$app: while (true) {if (v$3812 == null) {return 0;
} else {var v$3813 = v$3812;
var v$3814 = v$3813[0];
var v$3815 = v$3813[1];
(function(fp,s,v){fp[s] = v;})(hash$3810,v$3814[0],v$3814[1]);
var t$10399 = v$3815;
var v$3812 = t$10399;
continue lab$app;
};
};
};
var app$3811 = fix$10398.$app;
app$3811(h$3809);
t$10397 = hash$3810;
(function(obj,a1){return obj.insert(a1);})(t$10400,t$10397);
0;
 break; }default: {0;
} };
(smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0] = [lname$3798,smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0]],0);
var h$3818 = [["id",lname$3798],[["parent",(smltojs0$0SmlToJsCompApp$1$2.splitPath$1410(smltojs0$0SmlToJsCompApp$1$2.current$1408[0]))[0]],[["name",name$1855],[["kind","folder"],null]]]];
var t$10406 = fts$1852;
var t$10405;
var fix$10401 = {};
fix$10401.$foldl = function(v$3820,v$3821){lab$foldl: while (true) {if (v$3821 == null) {return v$3820;
} else {var v$3822 = v$3821;
var v$3823 = v$3822[0];
var v$3824 = v$3822[1];
var t$10402;
var v$3825 = v$3823[0];
var v$3826 = v$3823[1];
(function(fp,s,v){fp[s] = v;})(v$3820,v$3825,v$3826);
t$10402 = v$3820;
var t$10403 = t$10402;
var t$10404 = v$3824;
var v$3820 = t$10403;
var v$3821 = t$10404;
continue lab$foldl;
};
};
};
var foldl$3819 = fix$10401.$foldl;
var v$10054 = (function(){return {};})();
t$10405 = (foldl$3819(v$10054,h$3818));
(function(obj,a){return obj.add(a);})(t$10406,t$10405);
return lname$3798;
};
};
};
};
smltojs0$0SmlToJsCompApp$1$2.currentEditor$1864 = function(v$1866){var v$1871;
var t$10407;
var p$3828 = smltojs0$0SmlToJsCompApp$1$2.current$1408[0];
var fields$3829 = basis$0String$1.fields$231(function(c$3830){return c$3830 == 47;
},p$3828);
var v$3831 = basis$0List$1.rev$682(fields$3829);
if (v$3831 == null) {t$10407 = false;
} else {var v$3832 = v$3831;
var v$3833 = v$3832[0];
var v$3834 = v$3832[1];
var t$10410;
var v$6530 = basis$0String$1.fields$231(function(c$6531){return c$6531 == 46;
},v$3833);
if (v$6530 == null) {t$10410 = false;
} else {var v$6532 = v$6530;
var v$6533 = v$6532[1];
if (v$6533 == null) {t$10410 = false;
} else {var v$6534 = v$6533;
if (v$6534[1] == null) {var v$6535 = v$6532[0];
var v$6536 = v$6534[0];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$6535)) {var fix$10411 = {};
fix$10411.$exists = function(v$6538){lab$exists: while (true) {if (v$6538 == null) {return false;
} else {var v$6539 = v$6538;
var v$6540 = v$6539[0];
var v$6541 = v$6539[1];
if (v$6536 == v$6540) {return true;
} else {var t$10412 = v$6541;
var v$6538 = t$10412;
continue lab$exists;
};
};
};
};
var exists$6537 = fix$10411.$exists;
t$10410 = (exists$6537(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211));
} else {t$10410 = false;
};
} else {t$10410 = false;
};
};
};
if (t$10410) {var fix$10408 = {};
fix$10408.$all = function(v$3836){lab$all: while (true) {if (v$3836 == null) {return true;
} else {var v$3837 = v$3836;
var v$3838 = v$3837[0];
var v$3839 = v$3837[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$3838)) {var t$10409 = v$3839;
var v$3836 = t$10409;
continue lab$all;
} else {return false;
};
};
};
};
var all$3835 = fix$10408.$all;
t$10407 = (all$3835(v$3834));
} else {t$10407 = false;
};
};
v$1871 = (t$10407?[0,smltojs0$0SmlToJsCompApp$1$2.current$1408[0]]:[1]);
switch (v$1871[0]) { case 1: {return [1];
 break; }default: {var v$1889 = v$1871[1];
var v$1876 = basis$0List$1.find$392(function(v$1887){return v$1889 == v$1887[0];
},smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0]);
switch (v$1876[0]) { case 0: {return [0,[v$1889,v$1876[1][2]]];
 break; }default: {notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,"currentEditor: error");
var s$3847;
var t$10418;
var t$10417;
var t$10416;
var t$10415 = basis$0Date$1.fmt$816;
var t$10414 = "%H:%M:%S";
var t$10413;
var v$10009 = SmlPrims.getrealtime();
t$10413 = (basis$0Date$1.fromTimeLocal$512(v$10009[0],v$10009[1]));
t$10416 = (t$10415(t$10414,t$10413));
t$10417 = (t$10416 + ": ");
t$10418 = (t$10417 + "currentEditor: error");
s$3847 = (t$10418 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$3847));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
return [1];
} };
} };
};
smltojs0$0SmlToJsCompApp$1$2.showTab$1890 = function(n$1893){return (smltojs0$0SmlToJsCompApp$1$2.current$1408[0] = n$1893,0);
};
smltojs0$0SmlToJsCompApp$1$2.delete$1894 = function(fts$1897,closetab$1900){var v$1907;
var t$10419;
var p$3854 = smltojs0$0SmlToJsCompApp$1$2.current$1408[0];
if (p$3854 == "0") {t$10419 = true;
} else {var fields$3859 = basis$0String$1.fields$231(function(c$3860){return c$3860 == 47;
},p$3854);
var fix$10420 = {};
fix$10420.$all = function(v$3862){lab$all: while (true) {if (v$3862 == null) {return true;
} else {var v$3863 = v$3862;
var v$3864 = v$3863[0];
var v$3865 = v$3863[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$3864)) {var t$10421 = v$3865;
var v$3862 = t$10421;
continue lab$all;
} else {return false;
};
};
};
};
var all$3861 = fix$10420.$all;
t$10419 = (all$3861(fields$3859));
};
v$1907 = (t$10419?[0,smltojs0$0SmlToJsCompApp$1$2.current$1408[0]]:[1]);
switch (v$1907[0]) { case 0: {var v$1909 = v$1907[1];
switch (v$1909) { case "0": {return notify0$1026("#dd8888",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,"Cannot delete root folder");
 break; }default: {var t$10424;
var v$3867 = basis$0String$1.tokens$224(function(c$3868){return c$3868 == 47;
},v$1909);
if (v$3867 == null) {t$10424 = false;
} else {var v$3869 = v$3867;
switch (v$3869[0]) { case "Server": {t$10424 = true;
 break; }default: {t$10424 = false;
} };
};
if (t$10424) {notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,"You cannot delete folders in the Server folder");
var s$3872;
var t$10430;
var t$10429;
var t$10428;
var t$10427 = basis$0Date$1.fmt$816;
var t$10426 = "%H:%M:%S";
var t$10425;
var v$10010 = SmlPrims.getrealtime();
t$10425 = (basis$0Date$1.fromTimeLocal$512(v$10010[0],v$10010[1]));
t$10428 = (t$10427(t$10426,t$10425));
t$10429 = (t$10428 + ": ");
t$10430 = (t$10429 + "You cannot delete folders in the Server folder");
s$3872 = (t$10430 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$3872));
return (function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
} else {var v$1979 = basis$0List$1.partition$449(function(v$1984){var v$1985 = v$1984[0];
var s1$3877 = v$1909 + "/";
var n1$3879 = s1$3877.length;
var n2$3880 = v$1985.length;
var stop$3881 = (n1$3879 < n2$3880)?n1$3879:n2$3880;
var fix$10422 = {};
fix$10422.$h = function(j$3883){lab$h: while (true) {if (j$3883 == stop$3881) {return true;
} else {if ((s1$3877.charCodeAt(j$3883)) == (v$1985.charCodeAt(j$3883))) {var t$10423 = SmlPrims.chk_ovf_i32(j$3883 + 1);
var j$3883 = t$10423;
continue lab$h;
} else {return false;
};
};
};
};
var h$3882 = fix$10422.$h;
if (n1$3879 <= n2$3880) {return h$3882(0);
} else {return false;
};
},smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0]);
var v$1980 = v$1979[0];
var v$1981 = v$1979[1];
var v$1973 = basis$0List$1.partition$449(function(f$1978){var s1$3886 = v$1909 + "/";
var n1$3888 = s1$3886.length;
var n2$3889 = f$1978.length;
var stop$3890 = (n1$3888 < n2$3889)?n1$3888:n2$3889;
var fix$10431 = {};
fix$10431.$h = function(j$3892){lab$h: while (true) {if (j$3892 == stop$3890) {return true;
} else {if ((s1$3886.charCodeAt(j$3892)) == (f$1978.charCodeAt(j$3892))) {var t$10432 = SmlPrims.chk_ovf_i32(j$3892 + 1);
var j$3892 = t$10432;
continue lab$h;
} else {return false;
};
};
};
};
var h$3891 = fix$10431.$h;
if (n1$3888 <= n2$3889) {return h$3891(0);
} else {return false;
};
},smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0]);
var v$1974 = v$1973[0];
var v$1975 = v$1973[1];
var v$1963 = basis$0List$1.partition$449(function(f$1968){if (f$1968 == v$1909) {return true;
} else {var s1$3899 = v$1909 + "/";
var n1$3901 = s1$3899.length;
var n2$3902 = f$1968.length;
var stop$3903 = (n1$3901 < n2$3902)?n1$3901:n2$3902;
var fix$10433 = {};
fix$10433.$h = function(j$3905){lab$h: while (true) {if (j$3905 == stop$3903) {return true;
} else {if ((s1$3899.charCodeAt(j$3905)) == (f$1968.charCodeAt(j$3905))) {var t$10434 = SmlPrims.chk_ovf_i32(j$3905 + 1);
var j$3905 = t$10434;
continue lab$h;
} else {return false;
};
};
};
};
var h$3904 = fix$10433.$h;
if (n1$3901 <= n2$3902) {return h$3904(0);
} else {return false;
};
};
},smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0]);
var v$1964 = v$1963[0];
var v$1965 = v$1963[1];
(smltojs0$0SmlToJsCompApp$1$2.current$1408[0] = "0",0);
(smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0] = v$1981,0);
(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0] = v$1975,0);
(smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0] = v$1965,0);
var fix$10435 = {};
fix$10435.$app = function(v$3956){lab$app: while (true) {if (v$3956 == null) {return 0;
} else {var v$3957 = v$3956;
var v$3958 = v$3957[0];
var v$3959 = v$3957[1];
var t$10437;
var v$6545 = basis$0String$1.tokens$224((function(env$10436){return function(c$6546){return c$6546 == 47;
};
})([]),v$3958);
if (v$6545 == null) {t$10437 = false;
} else {var v$6547 = v$6545;
switch (v$6547[0]) { case "Server": {t$10437 = true;
 break; }default: {t$10437 = false;
} };
};
t$10437?0:((function(obj,a){return obj.remove(a);})(fts$1897,v$3958));
var t$10438 = v$3959;
var v$3956 = t$10438;
continue lab$app;
};
};
};
var app$3955 = fix$10435.$app;
app$3955(v$1974);
var fix$10439 = {};
fix$10439.$app = function(v$3970){lab$app: while (true) {if (v$3970 == null) {return 0;
} else {var v$3971 = v$3970;
var v$3972 = v$3971[0];
var v$3973 = v$3971[1];
var t$10441;
var v$6549 = basis$0String$1.tokens$224((function(env$10440){return function(c$6550){return c$6550 == 47;
};
})([]),v$3972);
if (v$6549 == null) {t$10441 = false;
} else {var v$6551 = v$6549;
switch (v$6551[0]) { case "Server": {t$10441 = true;
 break; }default: {t$10441 = false;
} };
};
t$10441?0:((function(obj,a){return obj.remove(a);})(fts$1897,v$3972));
var t$10442 = v$3973;
var v$3970 = t$10442;
continue lab$app;
};
};
};
var app$3969 = fix$10439.$app;
app$3969(v$1964);
var fix$10443 = {};
fix$10443.$app = function(v$3987){lab$app: while (true) {if (v$3987 == null) {return 0;
} else {var v$3988 = v$3987;
var v$3989 = v$3988[0];
var v$3990 = v$3988[1];
var v$3992 = v$3989[0];
closetab$1900(v$3992);
var t$10444 = v$3990;
var v$3987 = t$10444;
continue lab$app;
};
};
};
var app$3986 = fix$10443.$app;
app$3986(v$1980);
var fix$10445 = {};
fix$10445.$app = function(v$3995){lab$app: while (true) {if (v$3995 == null) {return 0;
} else {var v$3996 = v$3995;
var v$3997 = v$3996[0];
var v$3998 = v$3996[1];
try {var r$4020;
var v$4021 = smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0];
switch (v$4021[0]) { case 0: {var v$4022 = v$4021[1];
var v$4023 = appfun2$0dropbox$1.query$241(v$4022,[["name",v$3997],null]);
if (v$4023 == null) {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no records in Dropbox table for name=" + v$3997];
} else {var v$4024 = v$4023;
if (v$4024[1] == null) {r$4020 = v$4024[0];
} else {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: too many records in Dropbox table for name=" + v$3997];
};
};
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no filesTable set"];
} };
(function(obj){return obj.deleteRecord();})(r$4020);
var s$4027 = "Deleted file " + (("'" + v$3997) + "'");
var s$4031;
var t$10452;
var t$10451;
var t$10450;
var t$10449 = basis$0Date$1.fmt$816;
var t$10448 = "%H:%M:%S";
var t$10447;
var v$10011 = SmlPrims.getrealtime();
t$10447 = (basis$0Date$1.fromTimeLocal$512(v$10011[0],v$10011[1]));
t$10450 = (t$10449(t$10448,t$10447));
t$10451 = (t$10450 + ": ");
t$10452 = (t$10451 + s$4027);
s$4031 = (t$10452 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$4031));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
} catch(v$10446) {((function(env$10453){return function(v$4036){return 0;
};
})([]))(v$10446);
};
var t$10454 = v$3998;
var v$3995 = t$10454;
continue lab$app;
};
};
};
var app$3994 = fix$10445.$app;
app$3994(v$1974);
var fix$10455 = {};
fix$10455.$app = function(v$4039){lab$app: while (true) {if (v$4039 == null) {return 0;
} else {var v$4040 = v$4039;
var v$4041 = v$4040[0];
var v$4042 = v$4040[1];
try {var r$4064;
var v$4065 = smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0];
switch (v$4065[0]) { case 0: {var v$4066 = v$4065[1];
var v$4067 = appfun2$0dropbox$1.query$241(v$4066,[["name",v$4041],null]);
if (v$4067 == null) {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no records in Dropbox table for name=" + v$4041];
} else {var v$4068 = v$4067;
if (v$4068[1] == null) {r$4064 = v$4068[0];
} else {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: too many records in Dropbox table for name=" + v$4041];
};
};
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no filesTable set"];
} };
(function(obj){return obj.deleteRecord();})(r$4064);
var s$4071 = "Deleted folder " + (("'" + v$4041) + "'");
var s$4075;
var t$10462;
var t$10461;
var t$10460;
var t$10459 = basis$0Date$1.fmt$816;
var t$10458 = "%H:%M:%S";
var t$10457;
var v$10012 = SmlPrims.getrealtime();
t$10457 = (basis$0Date$1.fromTimeLocal$512(v$10012[0],v$10012[1]));
t$10460 = (t$10459(t$10458,t$10457));
t$10461 = (t$10460 + ": ");
t$10462 = (t$10461 + s$4071);
s$4075 = (t$10462 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$4075));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
} catch(v$10456) {((function(env$10463){return function(v$4080){return 0;
};
})([]))(v$10456);
};
var t$10464 = v$4042;
var v$4039 = t$10464;
continue lab$app;
};
};
};
var app$4038 = fix$10455.$app;
app$4038(v$1964);
var s$4081 = ("Deleted folder " + (("'" + v$1909) + "'")) + " completely";
notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,s$4081);
var s$4083;
var t$10470;
var t$10469;
var t$10468;
var t$10467 = basis$0Date$1.fmt$816;
var t$10466 = "%H:%M:%S";
var t$10465;
var v$10013 = SmlPrims.getrealtime();
t$10465 = (basis$0Date$1.fromTimeLocal$512(v$10013[0],v$10013[1]));
t$10468 = (t$10467(t$10466,t$10465));
t$10469 = (t$10468 + ": ");
t$10470 = (t$10469 + s$4081);
s$4083 = (t$10470 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$4083));
return (function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
};
} };
 break; }default: {var f$1986 = smltojs0$0SmlToJsCompApp$1$2.current$1408[0];
var t$10471;
var v$4095 = basis$0String$1.tokens$224(function(c$4096){return c$4096 == 47;
},f$1986);
if (v$4095 == null) {t$10471 = false;
} else {var v$4097 = v$4095;
switch (v$4097[0]) { case "Server": {t$10471 = true;
 break; }default: {t$10471 = false;
} };
};
if (t$10471) {notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,"You cannot delete files in the Server folder");
var s$4100;
var t$10477;
var t$10476;
var t$10475;
var t$10474 = basis$0Date$1.fmt$816;
var t$10473 = "%H:%M:%S";
var t$10472;
var v$10014 = SmlPrims.getrealtime();
t$10472 = (basis$0Date$1.fromTimeLocal$512(v$10014[0],v$10014[1]));
t$10475 = (t$10474(t$10473,t$10472));
t$10476 = (t$10475 + ": ");
t$10477 = (t$10476 + "You cannot delete files in the Server folder");
s$4100 = (t$10477 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$4100));
return (function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
} else {(smltojs0$0SmlToJsCompApp$1$2.current$1408[0] = "0",0);
(smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0] = (basis$0List$1.filter$417(function(v$2011){var v$2012 = v$2011[0];
return (v$2012 == f$1986)?false:true;
},smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0])),0);
(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0] = (basis$0List$1.filter$417(function(f$$2008){return (f$$2008 == f$1986)?false:true;
},smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0])),0);
var t$10478;
var v$4121 = basis$0String$1.tokens$224(function(c$4122){return c$4122 == 47;
},f$1986);
if (v$4121 == null) {t$10478 = false;
} else {var v$4123 = v$4121;
switch (v$4123[0]) { case "Server": {t$10478 = true;
 break; }default: {t$10478 = false;
} };
};
t$10478?0:((function(obj,a){return obj.remove(a);})(fts$1897,f$1986));
closetab$1900(f$1986);
try {var r$2001;
var v$4127 = smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0];
switch (v$4127[0]) { case 0: {var v$4128 = v$4127[1];
var v$4129 = appfun2$0dropbox$1.query$241(v$4128,[["name",f$1986],null]);
if (v$4129 == null) {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no records in Dropbox table for name=" + f$1986];
} else {var v$4130 = v$4129;
if (v$4130[1] == null) {r$2001 = v$4130[0];
} else {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: too many records in Dropbox table for name=" + f$1986];
};
};
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no filesTable set"];
} };
(function(obj){return obj.deleteRecord();})(r$2001);
var s$4134 = "Deleted file " + (("'" + f$1986) + "'");
notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,s$4134);
var s$4136;
var t$10485;
var t$10484;
var t$10483;
var t$10482 = basis$0Date$1.fmt$816;
var t$10481 = "%H:%M:%S";
var t$10480;
var v$10015 = SmlPrims.getrealtime();
t$10480 = (basis$0Date$1.fromTimeLocal$512(v$10015[0],v$10015[1]));
t$10483 = (t$10482(t$10481,t$10480));
t$10484 = (t$10483 + ": ");
t$10485 = (t$10484 + s$4134);
s$4136 = (t$10485 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$4136));
return (function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
} catch(v$10479) {return (function(v$2005){return 0;
})(v$10479);
};
};
} };
};
smltojs0$0SmlToJsCompApp$1$2.addTab$2013 = function(filename$2016,md5$2019,editor$2022){return (smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0] = [[filename$2016,[md5$2019],editor$2022],smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0]],0);
};
smltojs0$0SmlToJsCompApp$1$2.saveFile$2023 = function(v$2050,v$2051,v$2052){var c$2029 = v$2052[0](0);
var newMd5$2034 = md5$0md5$1.fromString$410(c$2029);
if (v$2051[0] == newMd5$2034) {return 0;
} else {var t$10487;
var v$4153 = basis$0String$1.tokens$224(function(c$4154){return c$4154 == 47;
},v$2050);
if (v$4153 == null) {t$10487 = false;
} else {var v$4155 = v$4153;
switch (v$4155[0]) { case "Server": {t$10487 = true;
 break; }default: {t$10487 = false;
} };
};
if (t$10487) {var s$4156 = ("Modified server file " + (("'" + v$2050) + "'")) + " not saved";
notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,s$4156);
var s$4158;
var t$10493;
var t$10492;
var t$10491;
var t$10490 = basis$0Date$1.fmt$816;
var t$10489 = "%H:%M:%S";
var t$10488;
var v$10016 = SmlPrims.getrealtime();
t$10488 = (basis$0Date$1.fromTimeLocal$512(v$10016[0],v$10016[1]));
t$10491 = (t$10490(t$10489,t$10488));
t$10492 = (t$10491 + ": ");
t$10493 = (t$10492 + s$4156);
s$4158 = (t$10493 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$4158));
return (function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
} else {try {var r$2043;
var v$4169 = smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0];
switch (v$4169[0]) { case 0: {var v$4170 = v$4169[1];
var v$4171 = appfun2$0dropbox$1.query$241(v$4170,[["name",v$2050],null]);
if (v$4171 == null) {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no records in Dropbox table for name=" + v$2050];
} else {var v$4172 = v$4171;
if (v$4172[1] == null) {r$2043 = v$4172[0];
} else {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: too many records in Dropbox table for name=" + v$2050];
};
};
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no filesTable set"];
} };
(function(obj,a1,a2){return obj.set(a1,a2);})(r$2043,"content",c$2029);
var s$4178 = "Saved file " + (("'" + v$2050) + "'");
notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,s$4178);
var s$4180;
var t$10499;
var t$10498;
var t$10497;
var t$10496 = basis$0Date$1.fmt$816;
var t$10495 = "%H:%M:%S";
var t$10494;
var v$10017 = SmlPrims.getrealtime();
t$10494 = (basis$0Date$1.fromTimeLocal$512(v$10017[0],v$10017[1]));
t$10497 = (t$10496(t$10495,t$10494));
t$10498 = (t$10497 + ": ");
t$10499 = (t$10498 + s$4178);
s$4180 = (t$10499 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$4180));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
return (v$2051[0] = newMd5$2034,0);
} catch(v$10486) {return (function(v$2049){return 0;
})(v$10486);
};
};
};
};
smltojs0$0SmlToJsCompApp$1$2.autosave$2053 = function(v$2055){var fix$10500 = {};
fix$10500.$app = function(v$4192){lab$app: while (true) {if (v$4192 == null) {return 0;
} else {var v$4193 = v$4192;
var v$4194 = v$4193[0];
var v$4195 = v$4193[1];
smltojs0$0SmlToJsCompApp$1$2.saveFile$2023(v$4194[0],v$4194[1],v$4194[2]);
var t$10501 = v$4195;
var v$4192 = t$10501;
continue lab$app;
};
};
};
var app$4191 = fix$10500.$app;
return app$4191(smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0]);
};
smltojs0$0SmlToJsCompApp$1$2.closeTab$2056 = function(n$2059){var v$2084;
var t$10502;
var p$4198 = smltojs0$0SmlToJsCompApp$1$2.current$1408[0];
var fields$4199 = basis$0String$1.fields$231(function(c$4200){return c$4200 == 47;
},p$4198);
var v$4201 = basis$0List$1.rev$682(fields$4199);
if (v$4201 == null) {t$10502 = false;
} else {var v$4202 = v$4201;
var v$4203 = v$4202[0];
var v$4204 = v$4202[1];
var t$10505;
var v$6556 = basis$0String$1.fields$231(function(c$6557){return c$6557 == 46;
},v$4203);
if (v$6556 == null) {t$10505 = false;
} else {var v$6558 = v$6556;
var v$6559 = v$6558[1];
if (v$6559 == null) {t$10505 = false;
} else {var v$6560 = v$6559;
if (v$6560[1] == null) {var v$6561 = v$6558[0];
var v$6562 = v$6560[0];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$6561)) {var fix$10506 = {};
fix$10506.$exists = function(v$6564){lab$exists: while (true) {if (v$6564 == null) {return false;
} else {var v$6565 = v$6564;
var v$6566 = v$6565[0];
var v$6567 = v$6565[1];
if (v$6562 == v$6566) {return true;
} else {var t$10507 = v$6567;
var v$6564 = t$10507;
continue lab$exists;
};
};
};
};
var exists$6563 = fix$10506.$exists;
t$10505 = (exists$6563(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211));
} else {t$10505 = false;
};
} else {t$10505 = false;
};
};
};
if (t$10505) {var fix$10503 = {};
fix$10503.$all = function(v$4206){lab$all: while (true) {if (v$4206 == null) {return true;
} else {var v$4207 = v$4206;
var v$4208 = v$4207[0];
var v$4209 = v$4207[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$4208)) {var t$10504 = v$4209;
var v$4206 = t$10504;
continue lab$all;
} else {return false;
};
};
};
};
var all$4205 = fix$10503.$all;
t$10502 = (all$4205(v$4204));
} else {t$10502 = false;
};
};
v$2084 = (t$10502?[0,smltojs0$0SmlToJsCompApp$1$2.current$1408[0]]:[1]);
switch (v$2084[0]) { case 0: {var v$2090 = v$2084[1];
(n$2059 == v$2090)?(smltojs0$0SmlToJsCompApp$1$2.current$1408[0] = "0",0):0;
 break; }default: {0;
} };
var v$2072 = basis$0List$1.find$392(function(v$2077){return v$2077[0] == n$2059;
},smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0]);
switch (v$2072[0]) { case 0: {var v$2074 = v$2072[1];
smltojs0$0SmlToJsCompApp$1$2.saveFile$2023(v$2074[0],v$2074[1],v$2074[2]);
 break; }default: {0;
} };
return (smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0] = (basis$0List$1.filter$417(function(v$2065){var v$2066 = v$2065[0];
return (v$2066 == n$2059)?false:true;
},smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0])),0);
};
smltojs0$0SmlToJsCompApp$1$2.stripAbsolute$2091 = function(a$2094){var t$10509;
if (a$2094.length > 0) {var t$10508;
if (0 >= a$2094.length) {throw CompilerInitial.exn$Subscript$52;
} else {t$10508 = (a$2094.charCodeAt(0));
};
t$10509 = (t$10508 == 47);
} else {t$10509 = false;
};
return t$10509?[0,basis$0String$1.extract$116(a$2094,1,[1])]:[1];
};
smltojs0$0SmlToJsCompApp$1$2.move$2103 = function(fts$2106,folderpath$2109,filename$2112,newfile$2115){var v$2179;
var t$10512;
var fields$4231 = basis$0String$1.fields$231(function(c$4232){return c$4232 == 47;
},newfile$2115);
var v$4233 = basis$0List$1.rev$682(fields$4231);
if (v$4233 == null) {t$10512 = false;
} else {var v$4234 = v$4233;
var v$4235 = v$4234[0];
var v$4236 = v$4234[1];
var t$10515;
var v$6572 = basis$0String$1.fields$231(function(c$6573){return c$6573 == 46;
},v$4235);
if (v$6572 == null) {t$10515 = false;
} else {var v$6574 = v$6572;
var v$6575 = v$6574[1];
if (v$6575 == null) {t$10515 = false;
} else {var v$6576 = v$6575;
if (v$6576[1] == null) {var v$6577 = v$6574[0];
var v$6578 = v$6576[0];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$6577)) {var fix$10516 = {};
fix$10516.$exists = function(v$6580){lab$exists: while (true) {if (v$6580 == null) {return false;
} else {var v$6581 = v$6580;
var v$6582 = v$6581[0];
var v$6583 = v$6581[1];
if (v$6578 == v$6582) {return true;
} else {var t$10517 = v$6583;
var v$6580 = t$10517;
continue lab$exists;
};
};
};
};
var exists$6579 = fix$10516.$exists;
t$10515 = (exists$6579(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211));
} else {t$10515 = false;
};
} else {t$10515 = false;
};
};
};
if (t$10515) {var fix$10513 = {};
fix$10513.$all = function(v$4238){lab$all: while (true) {if (v$4238 == null) {return true;
} else {var v$4239 = v$4238;
var v$4240 = v$4239[0];
var v$4241 = v$4239[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$4240)) {var t$10514 = v$4241;
var v$4238 = t$10514;
continue lab$all;
} else {return false;
};
};
};
};
var all$4237 = fix$10513.$all;
t$10512 = (all$4237(v$4236));
} else {t$10512 = false;
};
};
if (t$10512) {var v$2192 = smltojs0$0SmlToJsCompApp$1$2.splitPath$1410(newfile$2115);
var v$2193 = v$2192[1];
switch (v$2193[0]) { case 0: {var v$2200 = v$2192[0];
var t$10520;
switch (folderpath$2109) { case "0": {t$10520 = newfile$2115;
 break; }default: {t$10520 = ((folderpath$2109 + "/") + newfile$2115);
} };
var t$10519 = v$2193[1];
var t$10518;
if (v$2200 == "0") {t$10518 = folderpath$2109;
} else {switch (folderpath$2109) { case "0": {t$10518 = v$2200;
 break; }default: {t$10518 = ((folderpath$2109 + "/") + v$2200);
} };
};
v$2179 = [t$10520,t$10519,t$10518];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"move.impossible: newfile is a file"];
} };
} else {var v$2206;
var t$10511;
if (newfile$2115.length > 0) {var t$10510;
if (0 >= newfile$2115.length) {throw CompilerInitial.exn$Subscript$52;
} else {t$10510 = (newfile$2115.charCodeAt(0));
};
t$10511 = (t$10510 == 47);
} else {t$10511 = false;
};
v$2206 = (t$10511?[0,basis$0String$1.extract$116(newfile$2115,1,[1])]:[1]);
switch (v$2206[0]) { case 0: {var v$2222 = v$2206[1];
var t$10521;
var fields$4261 = basis$0String$1.fields$231(function(c$4262){return c$4262 == 47;
},v$2222);
var v$4263 = basis$0List$1.rev$682(fields$4261);
if (v$4263 == null) {t$10521 = false;
} else {var v$4264 = v$4263;
var v$4265 = v$4264[0];
var v$4266 = v$4264[1];
var t$10524;
var v$6586 = basis$0String$1.fields$231(function(c$6587){return c$6587 == 46;
},v$4265);
if (v$6586 == null) {t$10524 = false;
} else {var v$6588 = v$6586;
var v$6589 = v$6588[1];
if (v$6589 == null) {t$10524 = false;
} else {var v$6590 = v$6589;
if (v$6590[1] == null) {var v$6591 = v$6588[0];
var v$6592 = v$6590[0];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$6591)) {var fix$10525 = {};
fix$10525.$exists = function(v$6594){lab$exists: while (true) {if (v$6594 == null) {return false;
} else {var v$6595 = v$6594;
var v$6596 = v$6595[0];
var v$6597 = v$6595[1];
if (v$6592 == v$6596) {return true;
} else {var t$10526 = v$6597;
var v$6594 = t$10526;
continue lab$exists;
};
};
};
};
var exists$6593 = fix$10525.$exists;
t$10524 = (exists$6593(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211));
} else {t$10524 = false;
};
} else {t$10524 = false;
};
};
};
if (t$10524) {var fix$10522 = {};
fix$10522.$all = function(v$4268){lab$all: while (true) {if (v$4268 == null) {return true;
} else {var v$4269 = v$4268;
var v$4270 = v$4269[0];
var v$4271 = v$4269[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$4270)) {var t$10523 = v$4271;
var v$4268 = t$10523;
continue lab$all;
} else {return false;
};
};
};
};
var all$4267 = fix$10522.$all;
t$10521 = (all$4267(v$4266));
} else {t$10521 = false;
};
};
if (t$10521) {var v$2217 = smltojs0$0SmlToJsCompApp$1$2.splitPath$1410(v$2222);
var v$2218 = v$2217[1];
switch (v$2218[0]) { case 0: {v$2179 = [v$2222,v$2218[1],v$2217[0]];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"move.impossible: newfile is a file"];
} };
} else {throw [basis$0Initial$1.en$Fail$54,"invalid target path " + (("'" + newfile$2115) + "'")];
};
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"invalid target path " + (("'" + newfile$2115) + "'")];
} };
};
var v$2180 = v$2179[0];
var v$2181 = v$2179[1];
var v$2182 = v$2179[2];
var filepath$2120;
switch (folderpath$2109) { case "0": {filepath$2120 = filename$2112;
 break; }default: {filepath$2120 = ((folderpath$2109 + "/") + filename$2112);
} };
var s$4285 = (("Moving file " + (("'" + filepath$2120) + "'")) + " into ") + (("'" + v$2180) + "'");
notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,s$4285);
var s$4287;
var t$10532;
var t$10531;
var t$10530;
var t$10529 = basis$0Date$1.fmt$816;
var t$10528 = "%H:%M:%S";
var t$10527;
var v$10018 = SmlPrims.getrealtime();
t$10527 = (basis$0Date$1.fromTimeLocal$512(v$10018[0],v$10018[1]));
t$10530 = (t$10529(t$10528,t$10527));
t$10531 = (t$10530 + ": ");
t$10532 = (t$10531 + s$4285);
s$4287 = (t$10532 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$4287));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
var t$10540;
var v$4302 = basis$0String$1.tokens$224(function(c$4303){return c$4303 == 47;
},v$2180);
if (v$4302 == null) {t$10540 = false;
} else {var v$4304 = v$4302;
switch (v$4304[0]) { case "Server": {t$10540 = true;
 break; }default: {t$10540 = false;
} };
};
if (t$10540) {throw [basis$0Initial$1.en$Fail$54,"file cannot be moved to the server"];
} else {var t$10539;
var fix$10537 = {};
fix$10537.$exists = function(v$4307){lab$exists: while (true) {if (v$4307 == null) {return false;
} else {var v$4308 = v$4307;
var v$4309 = v$4308[0];
var v$4310 = v$4308[1];
if (v$4309 == v$2180) {return true;
} else {var t$10538 = v$4310;
var v$4307 = t$10538;
continue lab$exists;
};
};
};
};
var exists$4306 = fix$10537.$exists;
t$10539 = (exists$4306(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0]));
if (t$10539) {throw [basis$0Initial$1.en$Fail$54,"file already exists"];
} else {var t$10536;
var t$10535;
var fix$10533 = {};
fix$10533.$exists = function(v$4319){lab$exists: while (true) {if (v$4319 == null) {return false;
} else {var v$4320 = v$4319;
var v$4321 = v$4320[0];
var v$4322 = v$4320[1];
if (v$4321 == v$2182) {return true;
} else {var t$10534 = v$4322;
var v$4319 = t$10534;
continue lab$exists;
};
};
};
};
var exists$4318 = fix$10533.$exists;
t$10535 = (exists$4318(smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0]));
t$10536 = (t$10535?false:true);
if (t$10536) {throw [basis$0Initial$1.en$Fail$54,("target folder " + (("'" + v$2182) + "'")) + " does not exist"];
} else {var v$2138 = basis$0List$1.find$392(function(v$2176){return v$2176[0] == filepath$2120;
},smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0]);
switch (v$2138[0]) { case 0: {var v$2172 = v$2138[1];
var v$2173 = v$2172[2];
(smltojs0$0SmlToJsCompApp$1$2.current$1408[0] = "0",0);
(smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0] = (basis$0List$1.filter$417(function(v$2170){var v$2171 = v$2170[0];
return (v$2171 == filepath$2120)?false:true;
},smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0])),0);
(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0] = (basis$0List$1.map$332(function(n$2163){return ((n$2163 == filepath$2120)?false:true)?n$2163:v$2180;
},smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0])),0);
var t$10541;
var v$4354 = basis$0String$1.tokens$224(function(c$4355){return c$4355 == 47;
},filepath$2120);
if (v$4354 == null) {t$10541 = false;
} else {var v$4356 = v$4354;
switch (v$4356[0]) { case "Server": {t$10541 = true;
 break; }default: {t$10541 = false;
} };
};
t$10541?0:((function(obj,a){return obj.remove(a);})(fts$2106,filepath$2120));
var h$4360 = [["id",v$2180],[["parent",v$2182],[["name",v$2181],[["kind","leaf"],null]]]];
var t$10547 = fts$2106;
var t$10546;
var fix$10542 = {};
fix$10542.$foldl = function(v$4362,v$4363){lab$foldl: while (true) {if (v$4363 == null) {return v$4362;
} else {var v$4364 = v$4363;
var v$4365 = v$4364[0];
var v$4366 = v$4364[1];
var t$10543;
var v$4367 = v$4365[0];
var v$4368 = v$4365[1];
(function(fp,s,v){fp[s] = v;})(v$4362,v$4367,v$4368);
t$10543 = v$4362;
var t$10544 = t$10543;
var t$10545 = v$4366;
var v$4362 = t$10544;
var v$4363 = t$10545;
continue lab$foldl;
};
};
};
var foldl$4361 = fix$10542.$foldl;
var v$10056 = (function(){return {};})();
t$10546 = (foldl$4361(v$10056,h$4360));
(function(obj,a){return obj.add(a);})(t$10547,t$10546);
try {var r$2156;
var v$4370 = smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0];
switch (v$4370[0]) { case 0: {var v$4371 = v$4370[1];
var v$4372 = appfun2$0dropbox$1.query$241(v$4371,[["name",filepath$2120],null]);
if (v$4372 == null) {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no records in Dropbox table for name=" + filepath$2120];
} else {var v$4373 = v$4372;
if (v$4373[1] == null) {r$2156 = v$4373[0];
} else {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: too many records in Dropbox table for name=" + filepath$2120];
};
};
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"getFileRecord: no filesTable set"];
} };
(function(obj,a1,a2){return obj.set(a1,a2);})(r$2156,"name",v$2180);
var s$4379 = (("Moved file " + (("'" + filename$2112) + "'")) + " to ") + (("'" + v$2181) + "'");
notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,s$4379);
var s$4381;
var t$10554;
var t$10553;
var t$10552;
var t$10551 = basis$0Date$1.fmt$816;
var t$10550 = "%H:%M:%S";
var t$10549;
var v$10019 = SmlPrims.getrealtime();
t$10549 = (basis$0Date$1.fromTimeLocal$512(v$10019[0],v$10019[1]));
t$10552 = (t$10551(t$10550,t$10549));
t$10553 = (t$10552 + ": ");
t$10554 = (t$10553 + s$4379);
s$4381 = (t$10554 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$4381));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
} catch(v$10548) {(function(v$2160){return 0;
})(v$10548);
};
return [v$2180,v$2173[0](0)];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"impossible: cannot locate file in tab structure!"];
} };
};
};
};
};
smltojs0$0SmlToJsCompApp$1$2.ftsServer$2223;
var content$2224;
var file$6602;
var t$10558 = "otests/content?_=";
var t$10557;
var t$10556 = basis$0Real$1.toString$153;
var t$10555;
var v$6603 = SmlPrims.getrealtime();
t$10555 = ((v$6603[0] - (-2147483648)) + (v$6603[1] / 1000000.0));
t$10557 = (t$10556(t$10555));
file$6602 = (t$10558 + t$10557);
var r$6604 = SmlPrims.newRequest();
(function(r,m,u,a){return r.open(m,u,a);})(r$6604,"GET",file$6602,false);
js$0Js$1.send$654(r$6604,[1]);
var v$6605 = (function(r){return SmlPrims.option(r.responseText);})(r$6604);
switch (v$6605[0]) { case 0: {content$2224 = v$6605[1];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"serverGet failed on file " + file$6602];
} };
var content$2225 = basis$0String$1.translate$217(function(c$2228){return ((c$2228 == 32)?true:((9 <= c$2228)?(c$2228 <= 13):false))?"":(SmlPrims.implode([c$2228,null]));
},content$2224);
var lines$2233 = basis$0String$1.tokens$224(function(c$2236){return c$2236 == 59;
},content$2225);
var t$10580;
var t$10579 = [["id","Server"],[["name","Server"],[["kind","folder"],[["parent","0"],null]]]];
var t$10578;
var t$10559;
var v$6606 = null;
var fix$10560 = {};
fix$10560.$foldr = function(v$6608){if (v$6608 == null) {return v$6606;
} else {var v$6609 = v$6608;
var v$6610 = v$6609[0];
var v$6611 = v$6609[1];
var v$6613 = fix$10560.$foldr(v$6611);
var t$10577 = basis$0List$1.s$n$686;
var t$10561;
var v$6616 = basis$0String$1.tokens$224(function(c$6617){return c$6617 == 61;
},v$6610);
if (v$6616 == null) {t$10561 = null;
} else {var v$6618 = v$6616;
var v$6619 = v$6618[1];
if (v$6619 == null) {notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,"syntax error in otests/content file");
var s$6643;
var t$10567;
var t$10566;
var t$10565;
var t$10564 = basis$0Date$1.fmt$816;
var t$10563 = "%H:%M:%S";
var t$10562;
var v$10021 = SmlPrims.getrealtime();
t$10562 = (basis$0Date$1.fromTimeLocal$512(v$10021[0],v$10021[1]));
t$10565 = (t$10564(t$10563,t$10562));
t$10566 = (t$10565 + ": ");
t$10567 = (t$10566 + "syntax error in otests/content file");
s$6643 = (t$10567 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$6643));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
t$10561 = null;
} else {var v$6620 = v$6619;
if (v$6620[1] == null) {var v$6621 = v$6618[0];
var v$6622 = v$6620[0];
var sfolder$6623 = "Server/" + v$6621;
var t$10570;
var t$10569 = [["id",sfolder$6623],[["name",v$6621],[["kind","folder"],[["parent","Server"],null]]]];
var t$10568;
var files$6626 = basis$0String$1.tokens$224(function(c$6627){return c$6627 == 44;
},v$6622);
t$10568 = (basis$0List$1.map$332(function(f$6628){return [["id",(sfolder$6623 + "/") + f$6628],[["name",f$6628],[["kind","file"],[["parent",sfolder$6623],null]]]];
},files$6626));
t$10570 = [t$10569,t$10568];
t$10561 = t$10570;
} else {notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,"syntax error in otests/content file");
var s$6633;
var t$10576;
var t$10575;
var t$10574;
var t$10573 = basis$0Date$1.fmt$816;
var t$10572 = "%H:%M:%S";
var t$10571;
var v$10020 = SmlPrims.getrealtime();
t$10571 = (basis$0Date$1.fromTimeLocal$512(v$10020[0],v$10020[1]));
t$10574 = (t$10573(t$10572,t$10571));
t$10575 = (t$10574 + ": ");
t$10576 = (t$10575 + "syntax error in otests/content file");
s$6633 = (t$10576 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$6633));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
t$10561 = null;
};
};
};
return t$10577(t$10561,v$6613);
};
};
var foldr$6607 = fix$10560.$foldr;
t$10559 = (function(v$10165){return foldr$6607(v$10165);
});
t$10578 = (t$10559(lines$2233));
t$10580 = [t$10579,t$10578];
smltojs0$0SmlToJsCompApp$1$2.ftsServer$2223 = t$10580;
smltojs0$0SmlToJsCompApp$1$2.addEditorTab$2285 = function(v$2321,v$2322){return function(filename$2292){return function(content$2295){var inarea$2296;
var attrs$4496 = [["style","border:0;"],null];
var elem$4497 = document.createTextNode(content$2295);
var newelem$4498 = document.createElement("textarea");
var fix$10581 = {};
fix$10581.$app = function(v$4500){lab$app: while (true) {if (v$4500 == null) {return 0;
} else {var v$4501 = v$4500;
var v$4502 = v$4501[0];
var v$4503 = v$4501[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4498,v$4502[0],v$4502[1]);
var t$10582 = v$4503;
var v$4500 = t$10582;
continue lab$app;
};
};
};
var app$4499 = fix$10581.$app;
app$4499(attrs$4496);
(function(e,a){return e.appendChild(a);})(newelem$4498,elem$4497);
inarea$2296 = newelem$4498;
var inputarea$2297;
var attrs$4506 = [["class","textareacontainer"],null];
var newelem$4508 = document.createElement("div");
var fix$10583 = {};
fix$10583.$app = function(v$4510){lab$app: while (true) {if (v$4510 == null) {return 0;
} else {var v$4511 = v$4510;
var v$4512 = v$4511[0];
var v$4513 = v$4511[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4508,v$4512[0],v$4512[1]);
var t$10584 = v$4513;
var v$4510 = t$10584;
continue lab$app;
};
};
};
var app$4509 = fix$10583.$app;
app$4509(attrs$4506);
(function(e,a){return e.appendChild(a);})(newelem$4508,inarea$2296);
inputarea$2297 = newelem$4508;
var m$4514;
var v$6009;
var h$4521 = [["style","height:100%;"],[["title",filename$2292],[["closable","true"],null]]];
v$6009 = (function(f$4523){return (function(s,f){require([s,'dojo/domReady!'],f);})("dijit/layout/ContentPane",function(Cp$4524){var p$4525;
var t$10590 = Cp$4524;
var t$10589;
var fix$10585 = {};
fix$10585.$foldl = function(v$4527,v$4528){lab$foldl: while (true) {if (v$4528 == null) {return v$4527;
} else {var v$4529 = v$4528;
var v$4530 = v$4529[0];
var v$4531 = v$4529[1];
var t$10586;
var v$4532 = v$4530[0];
var v$4533 = v$4530[1];
(function(fp,s,v){fp[s] = v;})(v$4527,v$4532,v$4533);
t$10586 = v$4527;
var t$10587 = t$10586;
var t$10588 = v$4531;
var v$4527 = t$10587;
var v$4528 = t$10588;
continue lab$foldl;
};
};
};
var foldl$4526 = fix$10585.$foldl;
var v$10058 = (function(){return {};})();
t$10589 = (foldl$4526(v$10058,h$4521));
p$4525 = ((function(c,h){return new c(h);})(t$10590,t$10589));
(function(w,e){w.set('content', e);})(p$4525,inputarea$2297);
return f$4523(p$4525);
});
});
m$4514 = (function(c$4519){return v$6009(function(v$4520){(function(w,f){w.onClose = f;})(v$4520,function(v$6659){smltojs0$0SmlToJsCompApp$1$2.closeTab$2056(filename$2292);
return true;
});
(function(w,f){w.onShow = f;})(v$4520,function(v$6660){return (smltojs0$0SmlToJsCompApp$1$2.current$1408[0] = filename$2292,0);
});
(function(obj,a){return obj.addChild(a);})(v$2321,v$4520);
(function(obj,a1,a2){return obj.selectChild(a1,a2);})(v$2321,v$4520,true);
(v$2322[0] = [[filename$2292,v$4520],v$2322[0]],0);
var a$6661 = 0;
return c$4519(a$6661);
});
});
m$4514(function(x$4515){return x$4515;
});
var editor$2299 = smltojs0$0SmlToJsCompApp$1$2.mkEditor$1206(inarea$2296);
return (smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0] = [[filename$2292,[md5$0md5$1.fromString$410(content$2295)],editor$2299],smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0]],0);
};
};
};
smltojs0$0SmlToJsCompApp$1$2.button$2323 = function(s$2326){var attrs$4553 = [["style","height:25px; width:100px;"],null];
var elem$4554;
var attrs$4562 = null;
var elem$4563 = document.createTextNode(s$2326);
var newelem$4564 = document.createElement("b");
var fix$10591 = {};
fix$10591.$app = function(v$4566){lab$app: while (true) {if (v$4566 == null) {return 0;
} else {var v$4567 = v$4566;
var v$4568 = v$4567[0];
var v$4569 = v$4567[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4564,v$4568[0],v$4568[1]);
var t$10592 = v$4569;
var v$4566 = t$10592;
continue lab$app;
};
};
};
var app$4565 = fix$10591.$app;
app$4565(attrs$4562);
(function(e,a){return e.appendChild(a);})(newelem$4564,elem$4563);
elem$4554 = newelem$4564;
var newelem$4555 = document.createElement("button");
var fix$10593 = {};
fix$10593.$app = function(v$4557){lab$app: while (true) {if (v$4557 == null) {return 0;
} else {var v$4558 = v$4557;
var v$4559 = v$4558[0];
var v$4560 = v$4558[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4555,v$4559[0],v$4559[1]);
var t$10594 = v$4560;
var v$4557 = t$10594;
continue lab$app;
};
};
};
var app$4556 = fix$10593.$app;
app$4556(attrs$4553);
(function(e,a){return e.appendChild(a);})(newelem$4555,elem$4554);
return newelem$4555;
};
smltojs0$0SmlToJsCompApp$1$2.withDialog$2327 = function(v$2369,v$2368,v$2373,v$2370,v$2371,v$2372){var msgArea$2336;
var attrs$4572 = [["class","notify_area2"],[["style","opacity:0.0;top:0px;"],null]];
var newelem$4573 = document.createElement("span");
var fix$10595 = {};
fix$10595.$app = function(v$4575){lab$app: while (true) {if (v$4575 == null) {return 0;
} else {var v$4576 = v$4575;
var v$4577 = v$4576[0];
var v$4578 = v$4576[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4573,v$4577[0],v$4577[1]);
var t$10596 = v$4578;
var v$4575 = t$10596;
continue lab$app;
};
};
};
var app$4574 = fix$10595.$app;
app$4574(attrs$4572);
msgArea$2336 = newelem$4573;
var field$2355;
var attrs$4581 = [["type","text"],[["value",v$2371],null]];
var newelem$4582 = document.createElement("input");
var fix$10597 = {};
fix$10597.$app = function(v$4584){lab$app: while (true) {if (v$4584 == null) {return 0;
} else {var v$4585 = v$4584;
var v$4586 = v$4585[0];
var v$4587 = v$4585[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4582,v$4586[0],v$4586[1]);
var t$10598 = v$4587;
var v$4584 = t$10598;
continue lab$app;
};
};
};
var app$4583 = fix$10597.$app;
app$4583(attrs$4581);
field$2355 = newelem$4582;
var but$2356 = smltojs0$0SmlToJsCompApp$1$2.button$2323(v$2369);
var content$2357;
var attrs$4589 = [["style","width:400px;"],null];
var elem$4590;
var v$6017;
var attrs$4602 = null;
var elem$4603;
var v$6019 = document.createTextNode(v$2370 + ": ");
var e$4613 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$4613,v$6019);
(function(e,a){return e.appendChild(a);})(e$4613,field$2355);
elem$4603 = e$4613;
var newelem$4604 = document.createElement("p");
var fix$10599 = {};
fix$10599.$app = function(v$4606){lab$app: while (true) {if (v$4606 == null) {return 0;
} else {var v$4607 = v$4606;
var v$4608 = v$4607[0];
var v$4609 = v$4607[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4604,v$4608[0],v$4608[1]);
var t$10600 = v$4609;
var v$4606 = t$10600;
continue lab$app;
};
};
};
var app$4605 = fix$10599.$app;
app$4605(attrs$4602);
(function(e,a){return e.appendChild(a);})(newelem$4604,elem$4603);
v$6017 = newelem$4604;
var v$6018;
var attrs$4617 = null;
var elem$4618;
var v$6023;
var v$6026 = document.createTextNode(" ");
var e$4632 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$4632,but$2356);
(function(e,a){return e.appendChild(a);})(e$4632,v$6026);
v$6023 = e$4632;
var e$4628 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$4628,v$6023);
(function(e,a){return e.appendChild(a);})(e$4628,msgArea$2336);
elem$4618 = e$4628;
var newelem$4619 = document.createElement("p");
var fix$10601 = {};
fix$10601.$app = function(v$4621){lab$app: while (true) {if (v$4621 == null) {return 0;
} else {var v$4622 = v$4621;
var v$4623 = v$4622[0];
var v$4624 = v$4622[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4619,v$4623[0],v$4623[1]);
var t$10602 = v$4624;
var v$4621 = t$10602;
continue lab$app;
};
};
};
var app$4620 = fix$10601.$app;
app$4620(attrs$4617);
(function(e,a){return e.appendChild(a);})(newelem$4619,elem$4618);
v$6018 = newelem$4619;
var e$4600 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$4600,v$6017);
(function(e,a){return e.appendChild(a);})(e$4600,v$6018);
elem$4590 = e$4600;
var newelem$4591 = document.createElement("p");
var fix$10603 = {};
fix$10603.$app = function(v$4593){lab$app: while (true) {if (v$4593 == null) {return 0;
} else {var v$4594 = v$4593;
var v$4595 = v$4594[0];
var v$4596 = v$4594[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4591,v$4595[0],v$4595[1]);
var t$10604 = v$4596;
var v$4593 = t$10604;
continue lab$app;
};
};
};
var app$4592 = fix$10603.$app;
app$4592(attrs$4589);
(function(e,a){return e.appendChild(a);})(newelem$4591,elem$4590);
content$2357 = newelem$4591;
var dM$2358;
var v$6027;
var h$4639 = [["title",v$2368],null];
v$6027 = (function(f$4641){return (function(s,f){require([s,'dojo/domReady!'],f);})("dijit/Dialog",function(D$4642){var d$4643;
var t$10610 = D$4642;
var t$10609;
var fix$10605 = {};
fix$10605.$foldl = function(v$4645,v$4646){lab$foldl: while (true) {if (v$4646 == null) {return v$4645;
} else {var v$4647 = v$4646;
var v$4648 = v$4647[0];
var v$4649 = v$4647[1];
var t$10606;
var v$4650 = v$4648[0];
var v$4651 = v$4648[1];
(function(fp,s,v){fp[s] = v;})(v$4645,v$4650,v$4651);
t$10606 = v$4645;
var t$10607 = t$10606;
var t$10608 = v$4649;
var v$4645 = t$10607;
var v$4646 = t$10608;
continue lab$foldl;
};
};
};
var foldl$4644 = fix$10605.$foldl;
var v$10060 = (function(){return {};})();
t$10609 = (foldl$4644(v$10060,h$4639));
d$4643 = ((function(c,h){return new c(h);})(t$10610,t$10609));
(function(w,e){w.set('content', e);})(d$4643,content$2357);
return f$4641(d$4643);
});
});
dM$2358 = (function(c$4637){return v$6027(function(v$4638){js$0Js$1.installEventHandler$197(but$2356,4,function(v$6672){var s$6673 = (function(e){return e.value;})(field$2355);
try {var t$6674 = v$2372(s$6673);
(function(obj){return obj.hide();})(v$4638);
v$2373(t$6674);
return true;
} catch(v$10611) {return (function(v$6675){var t$10612 = v$6675;
if (t$10612[0] == basis$0Initial$1.en$Fail$54) {var msg$6676 = v$6675[1];
notify0$1026("#dd8888",msgArea$2336,msg$6676);
return true;
} else {throw v$6675;
};
})(v$10611);
};
});
(function(obj){return obj.show();})(v$4638);
var a$6677 = 0;
return c$4637(a$6677);
});
});
return dM$2358(function(x$4662){return x$4662;
});
};
smltojs0$0SmlToJsCompApp$1$2.confirmDialog$2374 = function(caption$2377,label$2380,msg$2383,f$2386){var cancel$2387 = smltojs0$0SmlToJsCompApp$1$2.button$2323("Cancel");
var but$2388 = smltojs0$0SmlToJsCompApp$1$2.button$2323(label$2380);
var content$2389;
var attrs$4664 = [["style","width:400px;"],null];
var elem$4665;
var v$6029;
var attrs$4677 = null;
var newelem$4679 = document.createElement("p");
var fix$10613 = {};
fix$10613.$app = function(v$4681){lab$app: while (true) {if (v$4681 == null) {return 0;
} else {var v$4682 = v$4681;
var v$4683 = v$4682[0];
var v$4684 = v$4682[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4679,v$4683[0],v$4683[1]);
var t$10614 = v$4684;
var v$4681 = t$10614;
continue lab$app;
};
};
};
var app$4680 = fix$10613.$app;
app$4680(attrs$4677);
(function(e,a){return e.appendChild(a);})(newelem$4679,msg$2383);
v$6029 = newelem$4679;
var v$6030;
var attrs$4686 = [["style","text-align:center;"],null];
var elem$4687;
var v$6031;
var v$6034 = document.createTextNode(" ");
var e$4701 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$4701,cancel$2387);
(function(e,a){return e.appendChild(a);})(e$4701,v$6034);
v$6031 = e$4701;
var e$4697 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$4697,v$6031);
(function(e,a){return e.appendChild(a);})(e$4697,but$2388);
elem$4687 = e$4697;
var newelem$4688 = document.createElement("p");
var fix$10615 = {};
fix$10615.$app = function(v$4690){lab$app: while (true) {if (v$4690 == null) {return 0;
} else {var v$4691 = v$4690;
var v$4692 = v$4691[0];
var v$4693 = v$4691[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4688,v$4692[0],v$4692[1]);
var t$10616 = v$4693;
var v$4690 = t$10616;
continue lab$app;
};
};
};
var app$4689 = fix$10615.$app;
app$4689(attrs$4686);
(function(e,a){return e.appendChild(a);})(newelem$4688,elem$4687);
v$6030 = newelem$4688;
var e$4675 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$4675,v$6029);
(function(e,a){return e.appendChild(a);})(e$4675,v$6030);
elem$4665 = e$4675;
var newelem$4666 = document.createElement("p");
var fix$10617 = {};
fix$10617.$app = function(v$4668){lab$app: while (true) {if (v$4668 == null) {return 0;
} else {var v$4669 = v$4668;
var v$4670 = v$4669[0];
var v$4671 = v$4669[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4666,v$4670[0],v$4670[1]);
var t$10618 = v$4671;
var v$4668 = t$10618;
continue lab$app;
};
};
};
var app$4667 = fix$10617.$app;
app$4667(attrs$4664);
(function(e,a){return e.appendChild(a);})(newelem$4666,elem$4665);
content$2389 = newelem$4666;
var dM$2390;
var v$6035;
var h$4708 = [["title",caption$2377],null];
v$6035 = (function(f$4710){return (function(s,f){require([s,'dojo/domReady!'],f);})("dijit/Dialog",function(D$4711){var d$4712;
var t$10624 = D$4711;
var t$10623;
var fix$10619 = {};
fix$10619.$foldl = function(v$4714,v$4715){lab$foldl: while (true) {if (v$4715 == null) {return v$4714;
} else {var v$4716 = v$4715;
var v$4717 = v$4716[0];
var v$4718 = v$4716[1];
var t$10620;
var v$4719 = v$4717[0];
var v$4720 = v$4717[1];
(function(fp,s,v){fp[s] = v;})(v$4714,v$4719,v$4720);
t$10620 = v$4714;
var t$10621 = t$10620;
var t$10622 = v$4718;
var v$4714 = t$10621;
var v$4715 = t$10622;
continue lab$foldl;
};
};
};
var foldl$4713 = fix$10619.$foldl;
var v$10062 = (function(){return {};})();
t$10623 = (foldl$4713(v$10062,h$4708));
d$4712 = ((function(c,h){return new c(h);})(t$10624,t$10623));
(function(w,e){w.set('content', e);})(d$4712,content$2389);
return f$4710(d$4712);
});
});
dM$2390 = (function(c$4706){return v$6035(function(v$4707){js$0Js$1.installEventHandler$197(but$2388,4,function(v$6685){(function(obj){return obj.hide();})(v$4707);
f$2386(0);
return true;
});
js$0Js$1.installEventHandler$197(cancel$2387,4,function(v$6686){(function(obj){return obj.hide();})(v$4707);
return true;
});
(function(obj){return obj.show();})(v$4707);
var a$6687 = 0;
return c$4706(a$6687);
});
});
return dM$2390(function(x$4727){return x$4727;
});
};
smltojs0$0SmlToJsCompApp$1$2.infoDialog$2410 = function(buttonlabel$2413,caption$2416,content$2419){var but$2420 = smltojs0$0SmlToJsCompApp$1$2.button$2323(buttonlabel$2413);
var content$2421;
var attrs$4729 = [["style","width:500px;"],null];
var elem$4730;
var v$6038;
var attrs$4742 = [["style","text-align:center;"],null];
var newelem$4744 = document.createElement("p");
var fix$10625 = {};
fix$10625.$app = function(v$4746){lab$app: while (true) {if (v$4746 == null) {return 0;
} else {var v$4747 = v$4746;
var v$4748 = v$4747[0];
var v$4749 = v$4747[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4744,v$4748[0],v$4748[1]);
var t$10626 = v$4749;
var v$4746 = t$10626;
continue lab$app;
};
};
};
var app$4745 = fix$10625.$app;
app$4745(attrs$4742);
(function(e,a){return e.appendChild(a);})(newelem$4744,but$2420);
v$6038 = newelem$4744;
var e$4740 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$4740,content$2419);
(function(e,a){return e.appendChild(a);})(e$4740,v$6038);
elem$4730 = e$4740;
var newelem$4731 = document.createElement("p");
var fix$10627 = {};
fix$10627.$app = function(v$4733){lab$app: while (true) {if (v$4733 == null) {return 0;
} else {var v$4734 = v$4733;
var v$4735 = v$4734[0];
var v$4736 = v$4734[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$4731,v$4735[0],v$4735[1]);
var t$10628 = v$4736;
var v$4733 = t$10628;
continue lab$app;
};
};
};
var app$4732 = fix$10627.$app;
app$4732(attrs$4729);
(function(e,a){return e.appendChild(a);})(newelem$4731,elem$4730);
content$2421 = newelem$4731;
var dM$2422;
var v$6039;
var h$4755 = [["title",caption$2416],null];
v$6039 = (function(f$4757){return (function(s,f){require([s,'dojo/domReady!'],f);})("dijit/Dialog",function(D$4758){var d$4759;
var t$10634 = D$4758;
var t$10633;
var fix$10629 = {};
fix$10629.$foldl = function(v$4761,v$4762){lab$foldl: while (true) {if (v$4762 == null) {return v$4761;
} else {var v$4763 = v$4762;
var v$4764 = v$4763[0];
var v$4765 = v$4763[1];
var t$10630;
var v$4766 = v$4764[0];
var v$4767 = v$4764[1];
(function(fp,s,v){fp[s] = v;})(v$4761,v$4766,v$4767);
t$10630 = v$4761;
var t$10631 = t$10630;
var t$10632 = v$4765;
var v$4761 = t$10631;
var v$4762 = t$10632;
continue lab$foldl;
};
};
};
var foldl$4760 = fix$10629.$foldl;
var v$10064 = (function(){return {};})();
t$10633 = (foldl$4760(v$10064,h$4755));
d$4759 = ((function(c,h){return new c(h);})(t$10634,t$10633));
(function(w,e){w.set('content', e);})(d$4759,content$2421);
return f$4757(d$4759);
});
});
dM$2422 = (function(c$4753){return v$6039(function(v$4754){js$0Js$1.installEventHandler$197(but$2420,4,function(v$6694){(function(obj){return obj.hide();})(v$4754);
return true;
});
(function(obj){return obj.show();})(v$4754);
var a$6695 = 0;
return c$4753(a$6695);
});
});
return dM$2422(function(x$4773){return x$4773;
});
};
smltojs0$0SmlToJsCompApp$1$2.infoDialogOk$2434 = function(v$10067){return function(v$10068){return smltojs0$0SmlToJsCompApp$1$2.infoDialog$2410("Ok",v$10067,v$10068);
};
};
smltojs0$0SmlToJsCompApp$1$2.menuHandle_NewNamedFile$2435 = function(tabsmap$2438,fts$2441,v$2443){var content$2444;
var t$10639;
var t$10638 = "(* File created ";
var t$10637;
var t$10636 = basis$0Date$1.toString$826;
var t$10635;
var v$10022 = SmlPrims.getrealtime();
t$10635 = (basis$0Date$1.fromTimeLocal$512(v$10022[0],v$10022[1]));
t$10637 = (t$10636(t$10635));
t$10639 = (t$10638 + t$10637);
content$2444 = (t$10639 + " *)\n");
var t$10650 = smltojs0$0SmlToJsCompApp$1$2.withDialog$2327;
var t$10649 = "Create";
var t$10648 = "New File";
var t$10647 = function(s$2447){return ((smltojs0$0SmlToJsCompApp$1$2.addEditorTab$2285(tabsmap$2438[0],tabsmap$2438[1]))(s$2447))(content$2444);
};
var t$10646 = "Name";
var t$10645;
var fix$10640 = {};
fix$10640.$suggest = function(f$6699){lab$suggest: while (true) {var num$6700 = [count$1749[0],(count$1749[0] = (SmlPrims.chk_ovf_i32(count$1749[0] + 1)),0)][0];
var name$6701 = f$6699(num$6700);
var t$10643;
var fix$10641 = {};
fix$10641.$exists = function(v$6704){lab$exists: while (true) {if (v$6704 == null) {return false;
} else {var v$6705 = v$6704;
var v$6706 = v$6705[0];
var v$6707 = v$6705[1];
if (v$6706 == name$6701) {return true;
} else {var t$10642 = v$6707;
var v$6704 = t$10642;
continue lab$exists;
};
};
};
};
var exists$6703 = fix$10641.$exists;
t$10643 = (exists$6703(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0]));
if (t$10643) {var t$10644 = f$6699;
var f$6699 = t$10644;
continue lab$suggest;
} else {return name$6701;
};
};
};
var suggest$6698 = fix$10640.$suggest;
t$10645 = (suggest$6698(function(num$6708){return ("Untitled-" + (basis$0Int32$1.toString$458(num$6708))) + ".sml";
}));
return t$10650(t$10649,t$10648,t$10647,t$10646,t$10645,function(v$10071){return smltojs0$0SmlToJsCompApp$1$2.newFile$1831(fts$2441,content$2444,v$10071);
});
};
smltojs0$0SmlToJsCompApp$1$2.menuHandle_MoveFile$2454 = function(tabsmap$2457,fts$2460,closetab$2463,v$2465){var path$2466 = smltojs0$0SmlToJsCompApp$1$2.current$1408[0];
var v$2473 = smltojs0$0SmlToJsCompApp$1$2.splitPath$1410(path$2466);
var v$2474 = v$2473[1];
switch (v$2474[0]) { case 0: {var v$2490 = v$2473[0];
var v$2491 = v$2474[1];
return smltojs0$0SmlToJsCompApp$1$2.withDialog$2327("Move","Move/Rename File",function(v$2479){var v$2482 = v$2479[0];
var v$2483 = v$2479[1];
closetab$2463(path$2466);
return ((smltojs0$0SmlToJsCompApp$1$2.addEditorTab$2285(tabsmap$2457[0],tabsmap$2457[1]))(v$2482))(v$2483);
},"New name",v$2491,function(v$10075){return smltojs0$0SmlToJsCompApp$1$2.move$2103(fts$2460,v$2490,v$2491,v$10075);
});
 break; }default: {return notify0$1026("#dd8888",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,"Renaming of folders not supported");
} };
};
smltojs0$0SmlToJsCompApp$1$2.menuHandle_FilesDelete$2493 = function(fts$2496,closetab$2499,v$2501){var msg$2502;
var v$2507;
var t$10651;
var p$4779 = smltojs0$0SmlToJsCompApp$1$2.current$1408[0];
var fields$4780 = basis$0String$1.fields$231(function(c$4781){return c$4781 == 47;
},p$4779);
var v$4782 = basis$0List$1.rev$682(fields$4780);
if (v$4782 == null) {t$10651 = false;
} else {var v$4783 = v$4782;
var v$4784 = v$4783[0];
var v$4785 = v$4783[1];
var t$10654;
var v$6710 = basis$0String$1.fields$231(function(c$6711){return c$6711 == 46;
},v$4784);
if (v$6710 == null) {t$10654 = false;
} else {var v$6712 = v$6710;
var v$6713 = v$6712[1];
if (v$6713 == null) {t$10654 = false;
} else {var v$6714 = v$6713;
if (v$6714[1] == null) {var v$6715 = v$6712[0];
var v$6716 = v$6714[0];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$6715)) {var fix$10655 = {};
fix$10655.$exists = function(v$6718){lab$exists: while (true) {if (v$6718 == null) {return false;
} else {var v$6719 = v$6718;
var v$6720 = v$6719[0];
var v$6721 = v$6719[1];
if (v$6716 == v$6720) {return true;
} else {var t$10656 = v$6721;
var v$6718 = t$10656;
continue lab$exists;
};
};
};
};
var exists$6717 = fix$10655.$exists;
t$10654 = (exists$6717(smltojs0$0SmlToJsCompApp$1$1.fileExtensions$211));
} else {t$10654 = false;
};
} else {t$10654 = false;
};
};
};
if (t$10654) {var fix$10652 = {};
fix$10652.$all = function(v$4787){lab$all: while (true) {if (v$4787 == null) {return true;
} else {var v$4788 = v$4787;
var v$4789 = v$4788[0];
var v$4790 = v$4788[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$4789)) {var t$10653 = v$4790;
var v$4787 = t$10653;
continue lab$all;
} else {return false;
};
};
};
};
var all$4786 = fix$10652.$all;
t$10651 = (all$4786(v$4785));
} else {t$10651 = false;
};
};
v$2507 = (t$10651?[0,smltojs0$0SmlToJsCompApp$1$2.current$1408[0]]:[1]);
switch (v$2507[0]) { case 0: {msg$2502 = (("Do you really want to delete the file " + (("'" + v$2507[1]) + "'")) + "?");
 break; }default: {var v$2514;
var t$10657;
var p$4797 = smltojs0$0SmlToJsCompApp$1$2.current$1408[0];
if (p$4797 == "0") {t$10657 = true;
} else {var fields$4802 = basis$0String$1.fields$231(function(c$4803){return c$4803 == 47;
},p$4797);
var fix$10658 = {};
fix$10658.$all = function(v$4805){lab$all: while (true) {if (v$4805 == null) {return true;
} else {var v$4806 = v$4805;
var v$4807 = v$4806[0];
var v$4808 = v$4806[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$4807)) {var t$10659 = v$4808;
var v$4805 = t$10659;
continue lab$all;
} else {return false;
};
};
};
};
var all$4804 = fix$10658.$all;
t$10657 = (all$4804(fields$4802));
};
v$2514 = (t$10657?[0,smltojs0$0SmlToJsCompApp$1$2.current$1408[0]]:[1]);
switch (v$2514[0]) { case 0: {msg$2502 = (("Do you really want to delete the folder " + (("'" + v$2514[1]) + "'")) + " and all its containing files?");
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"menuHandle_FilesDelete.impossible"];
} };
} };
return smltojs0$0SmlToJsCompApp$1$2.confirmDialog$2374("Confirm Deletion","Delete",document.createTextNode(msg$2502),function(v$2518){return smltojs0$0SmlToJsCompApp$1$2.delete$1894(fts$2496,closetab$2499);
});
};
smltojs0$0SmlToJsCompApp$1$2.menuHandle_Export$2519 = function(v$2521){var v$10116 = document.createTextNode("Not yet implemented");
return smltojs0$0SmlToJsCompApp$1$2.infoDialog$2410("Ok","Files Export to Zip",v$10116);
};
smltojs0$0SmlToJsCompApp$1$2.menuHandle_Import$2522 = function(v$2524){var v$10118 = document.createTextNode("Not yet implemented");
return smltojs0$0SmlToJsCompApp$1$2.infoDialog$2410("Ok","Files Import from Zip",v$10118);
};
smltojs0$0SmlToJsCompApp$1$2.menuHandle_NewFolder$2525 = function(fts$2528,v$2530){var t$10670 = smltojs0$0SmlToJsCompApp$1$2.withDialog$2327;
var t$10669 = "Create";
var t$10668 = "New Folder";
var t$10667 = function(s$2533){return 0;
};
var t$10666 = "Name";
var t$10665;
var fix$10660 = {};
fix$10660.$suggest = function(f$6736){lab$suggest: while (true) {var num$6737 = [count$1749[0],(count$1749[0] = (SmlPrims.chk_ovf_i32(count$1749[0] + 1)),0)][0];
var name$6740 = f$6736(num$6737);
var t$10663;
var fix$10661 = {};
fix$10661.$exists = function(v$6743){lab$exists: while (true) {if (v$6743 == null) {return false;
} else {var v$6744 = v$6743;
var v$6745 = v$6744[0];
var v$6746 = v$6744[1];
if (v$6745 == name$6740) {return true;
} else {var t$10662 = v$6746;
var v$6743 = t$10662;
continue lab$exists;
};
};
};
};
var exists$6742 = fix$10661.$exists;
t$10663 = (exists$6742(smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0]));
if (t$10663) {var t$10664 = f$6736;
var f$6736 = t$10664;
continue lab$suggest;
} else {return name$6740;
};
};
};
var suggest$6735 = fix$10660.$suggest;
t$10665 = (suggest$6735(function(num$4828){return "Folder-" + (basis$0Int32$1.toString$458(num$4828));
}));
return t$10670(t$10669,t$10668,t$10667,t$10666,t$10665,function(v$10077){return smltojs0$0SmlToJsCompApp$1$2.newFolder$1849(fts$2528,v$10077);
});
};
smltojs0$0SmlToJsCompApp$1$2.treeHandle_LoadFile$2540 = function(tabsmap$2543,selecttab$2546,v$2550){var v$2562 = v$2550[0];
var t$10671;
if (v$2562 == "0") {t$10671 = true;
} else {var fields$4836 = basis$0String$1.fields$231(function(c$4837){return c$4837 == 47;
},v$2562);
var fix$10672 = {};
fix$10672.$all = function(v$4839){lab$all: while (true) {if (v$4839 == null) {return true;
} else {var v$4840 = v$4839;
var v$4841 = v$4840[0];
var v$4842 = v$4840[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$4841)) {var t$10673 = v$4842;
var v$4839 = t$10673;
continue lab$all;
} else {return false;
};
};
};
};
var all$4838 = fix$10672.$all;
t$10671 = (all$4838(fields$4836));
};
if (t$10671) {return (smltojs0$0SmlToJsCompApp$1$2.current$1408[0] = v$2562,0);
} else {var v$2559 = smltojs0$0SmlToJsCompApp$1$2.loadFileContent$1665(v$2562);
switch (v$2559[0]) { case 0: {var v$2561 = v$2559[1];
return ((smltojs0$0SmlToJsCompApp$1$2.addEditorTab$2285(tabsmap$2543[0],tabsmap$2543[1]))(v$2562))(v$2561);
 break; }default: {return selecttab$2546(v$2562);
} };
};
};
smltojs0$0SmlToJsCompApp$1$2.menuHandle_OpenDemo$2564 = function(tabsmap$2567,fts$2570,demo$2573,v$2575){var name$2576;
var fix$10674 = {};
fix$10674.$suggest = function(f$6749){lab$suggest: while (true) {var num$6750 = [count$1749[0],(count$1749[0] = (SmlPrims.chk_ovf_i32(count$1749[0] + 1)),0)][0];
var name$6751 = f$6749(num$6750);
var t$10677;
var fix$10675 = {};
fix$10675.$exists = function(v$6754){lab$exists: while (true) {if (v$6754 == null) {return false;
} else {var v$6755 = v$6754;
var v$6756 = v$6755[0];
var v$6757 = v$6755[1];
if (v$6756 == name$6751) {return true;
} else {var t$10676 = v$6757;
var v$6754 = t$10676;
continue lab$exists;
};
};
};
};
var exists$6753 = fix$10675.$exists;
t$10677 = (exists$6753(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0]));
if (t$10677) {var t$10678 = f$6749;
var f$6749 = t$10678;
continue lab$suggest;
} else {return name$6751;
};
};
};
var suggest$6748 = fix$10674.$suggest;
name$2576 = (suggest$6748(function(num$6758){return ("Demo-" + (basis$0Int32$1.toString$458(num$6758))) + ".sml";
}));
var path$2577 = smltojs0$0SmlToJsCompApp$1$2.newFile$1831(fts$2570,demo$2573,name$2576);
return ((smltojs0$0SmlToJsCompApp$1$2.addEditorTab$2285(tabsmap$2567[0],tabsmap$2567[1]))(path$2577))(demo$2573);
};
smltojs0$0SmlToJsCompApp$1$2.menuHandle_DropboxSignIn$2578 = function(key$2581,v$2583){var t$10687;
var t$10683;
var t$10679;
var v$6081 = smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0];
var v$6082 = null;
var fix$10680 = {};
fix$10680.$eq_list = function(v$10120,v$10121){lab$eq_list: while (true) {if (v$10120 == null) {return (v$10121 == null)?true:false;
} else {if (v$10121 == null) {return false;
} else {var v$10122 = v$10120;
var v$10123 = v$10121;
if (v$10122[0] == v$10123[0]) {var t$10681 = v$10122[1];
var t$10682 = v$10123[1];
var v$10120 = t$10681;
var v$10121 = t$10682;
continue lab$eq_list;
} else {return false;
};
};
};
};
};
var eq_list$10119 = fix$10680.$eq_list;
t$10679 = (eq_list$10119(v$6081,v$6082));
if (t$10679) {var v$6087 = smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0];
var v$6088 = ["0",null];
var fix$10684 = {};
fix$10684.$eq_list = function(v$10126,v$10127){lab$eq_list: while (true) {if (v$10126 == null) {return (v$10127 == null)?true:false;
} else {if (v$10127 == null) {return false;
} else {var v$10128 = v$10126;
var v$10129 = v$10127;
if (v$10128[0] == v$10129[0]) {var t$10685 = v$10128[1];
var t$10686 = v$10129[1];
var v$10126 = t$10685;
var v$10127 = t$10686;
continue lab$eq_list;
} else {return false;
};
};
};
};
};
var eq_list$10125 = fix$10684.$eq_list;
t$10683 = (eq_list$10125(v$6087,v$6088));
} else {t$10683 = false;
};
t$10687 = (t$10683?true:((basis$0Option$1.isSome$56(0))(smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0])));
if (t$10687) {return (function(obj){return obj.authenticate();})((function(k){return new Dropbox.Client({key:k});})(key$2581));
} else {var msg$2592 = document.createTextNode("Signing in to Dropbox will delete all application data created in this session. If this is the first time you sign in to Dropbox from this application, you will be asked to allow the application to store data in a special area of your Dropbox account.");
return smltojs0$0SmlToJsCompApp$1$2.confirmDialog$2374("Dropbox Sign In","Sign in",msg$2592,function(v$4880){return (function(obj){return obj.authenticate();})((function(k){return new Dropbox.Client({key:k});})(key$2581));
});
};
};
smltojs0$0SmlToJsCompApp$1$2.menuHandle_DropboxSignOut$2601 = function(c$2604,fts$2607,closetab$2610,v$2612){var msg$2613 = document.createTextNode("Signing out of Dropbox will not delete any data in the Dropbox datastore. You will always be able to sign in again using the \"Sign in\" entry in the Dropbox menu.");
var fix$10688 = {};
fix$10688.$app = function(v$4884){lab$app: while (true) {if (v$4884 == null) {return 0;
} else {var v$4885 = v$4884;
var v$4886 = v$4885[0];
var v$4887 = v$4885[1];
smltojs0$0SmlToJsCompApp$1$2.saveFile$2023(v$4886[0],v$4886[1],v$4886[2]);
var t$10689 = v$4887;
var v$4884 = t$10689;
continue lab$app;
};
};
};
var app$4883 = fix$10688.$app;
app$4883(smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0]);
return smltojs0$0SmlToJsCompApp$1$2.confirmDialog$2374("Dropbox Sign Out","Sign out",msg$2613,function(v$2617){var t$10699 = c$2604;
var t$10696;
var h$4890 = null;
var hash$4891 = (function(){return {};})();
var fix$10697 = {};
fix$10697.$app = function(v$4893){lab$app: while (true) {if (v$4893 == null) {return 0;
} else {var v$4894 = v$4893;
var v$4895 = v$4894[0];
var v$4896 = v$4894[1];
(function(fp,s,v){fp[s] = v;})(hash$4891,v$4895[0],v$4895[1]);
var t$10698 = v$4896;
var v$4893 = t$10698;
continue lab$app;
};
};
};
var app$4892 = fix$10697.$app;
app$4892(h$4890);
t$10696 = hash$4891;
return (function(obj,a1,a2){return obj.signOut(a1,a2);})(t$10699,t$10696,function(v$4897){(smltojs0$0SmlToJsCompApp$1$2.filesTable$1407[0] = [1],0);
smltojs0$0SmlToJsCompApp$1$2.clear$1700(fts$2607,closetab$2610);
notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,"Signed out of Dropbox");
var s$6760;
var t$10695;
var t$10694;
var t$10693;
var t$10692 = basis$0Date$1.fmt$816;
var t$10691 = "%H:%M:%S";
var t$10690;
var v$10025 = SmlPrims.getrealtime();
t$10690 = (basis$0Date$1.fromTimeLocal$512(v$10025[0],v$10025[1]));
t$10693 = (t$10692(t$10691,t$10690));
t$10694 = (t$10693 + ": ");
t$10695 = (t$10694 + "Signed out of Dropbox");
s$6760 = (t$10695 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$6760));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
return (function(e,a,b){return e.setAttribute(a,b);})(smltojs0$0SmlToJsCompApp$1$2.dropboxAreaElem$981,"src","nodropbox.png");
});
});
};
smltojs0$0SmlToJsCompApp$1$2.menuHandle_CompileAndRun$2626 = function(v$2628){var v$2634 = smltojs0$0SmlToJsCompApp$1$2.currentEditor$1864(0);
switch (v$2634[0]) { case 0: {var v$2636 = v$2634[1];
var v$2637 = v$2636[0];
var v$2638 = v$2636[1];
var res$4912;
var v$4914 = v$2638[0](0);
var p_old$4915 = basis$0Control$1.printer_get$55(0);
var buf$4916 = [null];
basis$0Control$1.printer_set$54(function(s$4917){return (buf$4916[0] = [s$4917,buf$4916[0]],0);
});
try {smltojs0$0SmlToJsCompApp$1$1.compute$102(v$2637,v$4914);
} catch(v$10700) {(function(v$4919){return 0;
})(v$10700);
};
var res$4920 = SmlPrims.concat(basis$0List$1.rev$682(buf$4916[0]));
basis$0Control$1.printer_set$54(p_old$4915);
res$4912 = res$4920;
return smltojs0$0SmlToJsCompApp$1$2.outRef$1053[0](res$4912);
 break; }default: {notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,"No file selected");
var s$4924;
var t$10706;
var t$10705;
var t$10704;
var t$10703 = basis$0Date$1.fmt$816;
var t$10702 = "%H:%M:%S";
var t$10701;
var v$10026 = SmlPrims.getrealtime();
t$10701 = (basis$0Date$1.fromTimeLocal$512(v$10026[0],v$10026[1]));
t$10704 = (t$10703(t$10702,t$10701));
t$10705 = (t$10704 + ": ");
t$10706 = (t$10705 + "No file selected");
s$4924 = (t$10706 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$4924));
return (function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
} };
};
smltojs0$0SmlToJsCompApp$1$2.poweredby$2639 = function(v$2641){var v$6111;
var attrs$5004 = null;
var elem$5005;
var v$6113;
var v$6115;
var v$6117;
var v$6119;
var v$6121;
var v$6123;
var v$6125;
var v$6127;
var v$6129 = document.createTextNode("This IDE is based on ");
var v$6130;
var attrs$6762 = [["href","http://www.smlserver.org/smltojs"],[["target","_blank"],null]];
var elem$6763 = document.createTextNode("SMLtoJs");
var newelem$6764 = document.createElement("a");
var fix$10707 = {};
fix$10707.$app = function(v$6766){lab$app: while (true) {if (v$6766 == null) {return 0;
} else {var v$6767 = v$6766;
var v$6768 = v$6767[0];
var v$6769 = v$6767[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$6764,v$6768[0],v$6768[1]);
var t$10708 = v$6769;
var v$6766 = t$10708;
continue lab$app;
};
};
};
var app$6765 = fix$10707.$app;
app$6765(attrs$6762);
(function(e,a){return e.appendChild(a);})(newelem$6764,elem$6763);
v$6130 = newelem$6764;
var e$5047 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5047,v$6129);
(function(e,a){return e.appendChild(a);})(e$5047,v$6130);
v$6127 = e$5047;
var v$6128 = document.createTextNode(", a Standard ML to JavaScript compiler. The front-end uses ");
var e$5043 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5043,v$6127);
(function(e,a){return e.appendChild(a);})(e$5043,v$6128);
v$6125 = e$5043;
var v$6126;
var attrs$6771 = [["href","http://dojotoolkit.org/"],[["target","_blank"],null]];
var elem$6772 = document.createTextNode("Dojo");
var newelem$6773 = document.createElement("a");
var fix$10709 = {};
fix$10709.$app = function(v$6775){lab$app: while (true) {if (v$6775 == null) {return 0;
} else {var v$6776 = v$6775;
var v$6777 = v$6776[0];
var v$6778 = v$6776[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$6773,v$6777[0],v$6777[1]);
var t$10710 = v$6778;
var v$6775 = t$10710;
continue lab$app;
};
};
};
var app$6774 = fix$10709.$app;
app$6774(attrs$6771);
(function(e,a){return e.appendChild(a);})(newelem$6773,elem$6772);
v$6126 = newelem$6773;
var e$5039 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5039,v$6125);
(function(e,a){return e.appendChild(a);})(e$5039,v$6126);
v$6123 = e$5039;
var v$6124 = document.createTextNode(" and ");
var e$5035 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5035,v$6123);
(function(e,a){return e.appendChild(a);})(e$5035,v$6124);
v$6121 = e$5035;
var v$6122;
var attrs$6780 = [["href","http://codemirror.net"],[["target","_blank"],null]];
var elem$6781 = document.createTextNode("CodeMirror");
var newelem$6782 = document.createElement("a");
var fix$10711 = {};
fix$10711.$app = function(v$6784){lab$app: while (true) {if (v$6784 == null) {return 0;
} else {var v$6785 = v$6784;
var v$6786 = v$6785[0];
var v$6787 = v$6785[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$6782,v$6786[0],v$6786[1]);
var t$10712 = v$6787;
var v$6784 = t$10712;
continue lab$app;
};
};
};
var app$6783 = fix$10711.$app;
app$6783(attrs$6780);
(function(e,a){return e.appendChild(a);})(newelem$6782,elem$6781);
v$6122 = newelem$6782;
var e$5031 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5031,v$6121);
(function(e,a){return e.appendChild(a);})(e$5031,v$6122);
v$6119 = e$5031;
var v$6120 = document.createTextNode(". The IDE ");
var e$5027 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5027,v$6119);
(function(e,a){return e.appendChild(a);})(e$5027,v$6120);
v$6117 = e$5027;
var v$6118 = document.createTextNode(" allows for the user to save source files in a personal and secure ");
var e$5023 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5023,v$6117);
(function(e,a){return e.appendChild(a);})(e$5023,v$6118);
v$6115 = e$5023;
var v$6116;
var attrs$6789 = [["href","https://www.dropbox.com/developers/datastore"],[["target","_blank"],null]];
var elem$6790 = document.createTextNode("Dropbox datastore");
var newelem$6791 = document.createElement("a");
var fix$10713 = {};
fix$10713.$app = function(v$6793){lab$app: while (true) {if (v$6793 == null) {return 0;
} else {var v$6794 = v$6793;
var v$6795 = v$6794[0];
var v$6796 = v$6794[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$6791,v$6795[0],v$6795[1]);
var t$10714 = v$6796;
var v$6793 = t$10714;
continue lab$app;
};
};
};
var app$6792 = fix$10713.$app;
app$6792(attrs$6789);
(function(e,a){return e.appendChild(a);})(newelem$6791,elem$6790);
v$6116 = newelem$6791;
var e$5019 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5019,v$6115);
(function(e,a){return e.appendChild(a);})(e$5019,v$6116);
v$6113 = e$5019;
var v$6114 = document.createTextNode(".");
var e$5015 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5015,v$6113);
(function(e,a){return e.appendChild(a);})(e$5015,v$6114);
elem$5005 = e$5015;
var newelem$5006 = document.createElement("p");
var fix$10715 = {};
fix$10715.$app = function(v$5008){lab$app: while (true) {if (v$5008 == null) {return 0;
} else {var v$5009 = v$5008;
var v$5010 = v$5009[0];
var v$5011 = v$5009[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$5006,v$5010[0],v$5010[1]);
var t$10716 = v$5011;
var v$5008 = t$10716;
continue lab$app;
};
};
};
var app$5007 = fix$10715.$app;
app$5007(attrs$5004);
(function(e,a){return e.appendChild(a);})(newelem$5006,elem$5005);
v$6111 = newelem$5006;
var v$6112;
var attrs$5055 = null;
var elem$5056;
var v$6131;
var v$6133;
var v$6135;
var v$6137;
var v$6139;
var v$6141;
var v$6143 = document.createTextNode(" The sources for this IDE are");
var v$6144 = document.createTextNode(" available by download from the ");
var e$5090 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5090,v$6143);
(function(e,a){return e.appendChild(a);})(e$5090,v$6144);
v$6141 = e$5090;
var v$6142;
var attrs$6798 = [["href","https://github.com/melsman/mlkit"],[["target","_blank"],null]];
var elem$6799 = document.createTextNode("Github MLKit Repository");
var newelem$6800 = document.createElement("a");
var fix$10717 = {};
fix$10717.$app = function(v$6802){lab$app: while (true) {if (v$6802 == null) {return 0;
} else {var v$6803 = v$6802;
var v$6804 = v$6803[0];
var v$6805 = v$6803[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$6800,v$6804[0],v$6804[1]);
var t$10718 = v$6805;
var v$6802 = t$10718;
continue lab$app;
};
};
};
var app$6801 = fix$10717.$app;
app$6801(attrs$6798);
(function(e,a){return e.appendChild(a);})(newelem$6800,elem$6799);
v$6142 = newelem$6800;
var e$5086 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5086,v$6141);
(function(e,a){return e.appendChild(a);})(e$5086,v$6142);
v$6139 = e$5086;
var v$6140 = document.createTextNode(" and are distributed");
var e$5082 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5082,v$6139);
(function(e,a){return e.appendChild(a);})(e$5082,v$6140);
v$6137 = e$5082;
var v$6138 = document.createTextNode(" under the GPL2 license; some parts of the sources are also available under the MIT license.");
var e$5078 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5078,v$6137);
(function(e,a){return e.appendChild(a);})(e$5078,v$6138);
v$6135 = e$5078;
var v$6136 = document.createTextNode(" For information about licenses, please consult the sources at the ");
var e$5074 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5074,v$6135);
(function(e,a){return e.appendChild(a);})(e$5074,v$6136);
v$6133 = e$5074;
var v$6134;
var attrs$6807 = [["href","https://github.com/melsman/mlkit"],[["target","_blank"],null]];
var elem$6808 = document.createTextNode("Github MLKit Repository");
var newelem$6809 = document.createElement("a");
var fix$10719 = {};
fix$10719.$app = function(v$6811){lab$app: while (true) {if (v$6811 == null) {return 0;
} else {var v$6812 = v$6811;
var v$6813 = v$6812[0];
var v$6814 = v$6812[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$6809,v$6813[0],v$6813[1]);
var t$10720 = v$6814;
var v$6811 = t$10720;
continue lab$app;
};
};
};
var app$6810 = fix$10719.$app;
app$6810(attrs$6807);
(function(e,a){return e.appendChild(a);})(newelem$6809,elem$6808);
v$6134 = newelem$6809;
var e$5070 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5070,v$6133);
(function(e,a){return e.appendChild(a);})(e$5070,v$6134);
v$6131 = e$5070;
var v$6132 = document.createTextNode(".");
var e$5066 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5066,v$6131);
(function(e,a){return e.appendChild(a);})(e$5066,v$6132);
elem$5056 = e$5066;
var newelem$5057 = document.createElement("p");
var fix$10721 = {};
fix$10721.$app = function(v$5059){lab$app: while (true) {if (v$5059 == null) {return 0;
} else {var v$5060 = v$5059;
var v$5061 = v$5060[0];
var v$5062 = v$5060[1];
(function(e,a,b){return e.setAttribute(a,b);})(newelem$5057,v$5061[0],v$5061[1]);
var t$10722 = v$5062;
var v$5059 = t$10722;
continue lab$app;
};
};
};
var app$5058 = fix$10721.$app;
app$5058(attrs$5055);
(function(e,a){return e.appendChild(a);})(newelem$5057,elem$5056);
v$6112 = newelem$5057;
var e$5002 = document.createDocumentFragment();
(function(e,a){return e.appendChild(a);})(e$5002,v$6111);
(function(e,a){return e.appendChild(a);})(e$5002,v$6112);
return e$5002;
};
smltojs0$0SmlToJsCompApp$1$2.menu$2656 = function(tabs$2659,fts$2662,closetab$2665){var v$6145;
var h$5102 = [["region","center"],[smltojs0$0SmlToJsCompApp$1$2.menuStyle$1294,null]];
v$6145 = (function(f$5103){return (function(s,f){require([s,'dojo/domReady!'],f);})("dijit/MenuBar",function(MenuBar$5104){var menubar$5105;
var t$10728 = MenuBar$5104;
var t$10727;
var fix$10723 = {};
fix$10723.$foldl = function(v$5107,v$5108){lab$foldl: while (true) {if (v$5108 == null) {return v$5107;
} else {var v$5109 = v$5108;
var v$5110 = v$5109[0];
var v$5111 = v$5109[1];
var t$10724;
var v$5112 = v$5110[0];
var v$5113 = v$5110[1];
(function(fp,s,v){fp[s] = v;})(v$5107,v$5112,v$5113);
t$10724 = v$5107;
var t$10725 = t$10724;
var t$10726 = v$5111;
var v$5107 = t$10725;
var v$5108 = t$10726;
continue lab$foldl;
};
};
};
var foldl$5106 = fix$10723.$foldl;
var v$10080 = (function(){return {};})();
t$10727 = (foldl$5106(v$10080,h$5102));
menubar$5105 = ((function(c,h){return new c(h);})(t$10728,t$10727));
return f$5103([menubar$5105,[menubar$5105,true]]);
});
});
return function(c$5100){return v$6145(function(v$5101){var v$9023 = v$5101[0];
var v$9024 = v$5101[1];
var v$9025 = (dojo$0dojo$1.menu$801(v$9024[0],v$9024[1]))("File");
return v$9025(function(v$9027){var v$9028 = (dojo$0dojo$1.item$827(v$9027[0],v$9027[1]))(["New file",[0,dojo$0dojo$1.newPage$3265],function(v$9029){var content$9030;
var t$10733;
var t$10732 = "(* File created ";
var t$10731;
var t$10730 = basis$0Date$1.toString$826;
var t$10729;
var v$10027 = SmlPrims.getrealtime();
t$10729 = (basis$0Date$1.fromTimeLocal$512(v$10027[0],v$10027[1]));
t$10731 = (t$10730(t$10729));
t$10733 = (t$10732 + t$10731);
content$9030 = (t$10733 + " *)\n");
var t$10744 = smltojs0$0SmlToJsCompApp$1$2.withDialog$2327;
var t$10743 = "Create";
var t$10742 = "New File";
var t$10741 = function(s$9031){return ((smltojs0$0SmlToJsCompApp$1$2.addEditorTab$2285(tabs$2659[0],tabs$2659[1]))(s$9031))(content$9030);
};
var t$10740 = "Name";
var t$10739;
var fix$10734 = {};
fix$10734.$suggest = function(f$9033){lab$suggest: while (true) {var num$9034 = [count$1749[0],(count$1749[0] = (SmlPrims.chk_ovf_i32(count$1749[0] + 1)),0)][0];
var name$9035 = f$9033(num$9034);
var t$10737;
var fix$10735 = {};
fix$10735.$exists = function(v$9037){lab$exists: while (true) {if (v$9037 == null) {return false;
} else {var v$9038 = v$9037;
var v$9039 = v$9038[0];
var v$9040 = v$9038[1];
if (v$9039 == name$9035) {return true;
} else {var t$10736 = v$9040;
var v$9037 = t$10736;
continue lab$exists;
};
};
};
};
var exists$9036 = fix$10735.$exists;
t$10737 = (exists$9036(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0]));
if (t$10737) {var t$10738 = f$9033;
var f$9033 = t$10738;
continue lab$suggest;
} else {return name$9035;
};
};
};
var suggest$9032 = fix$10734.$suggest;
t$10739 = (suggest$9032(function(num$9041){return ("Untitled-" + (basis$0Int32$1.toString$458(num$9041))) + ".sml";
}));
return t$10744(t$10743,t$10742,t$10741,t$10740,t$10739,function(v$10084){return smltojs0$0SmlToJsCompApp$1$2.newFile$1831(fts$2662,content$9030,v$10084);
});
}]);
return v$9028(function(v$9042){var v$9043 = (dojo$0dojo$1.item$827(v$9027[0],v$9027[1]))(["New folder",[0,dojo$0dojo$1.folderClosed$3224],function(v$9992){var t$10755 = smltojs0$0SmlToJsCompApp$1$2.withDialog$2327;
var t$10754 = "Create";
var t$10753 = "New Folder";
var t$10752 = function(s$9993){return 0;
};
var t$10751 = "Name";
var t$10750;
var fix$10745 = {};
fix$10745.$suggest = function(f$9995){lab$suggest: while (true) {var num$9996 = [count$1749[0],(count$1749[0] = (SmlPrims.chk_ovf_i32(count$1749[0] + 1)),0)][0];
var name$9997 = f$9995(num$9996);
var t$10748;
var fix$10746 = {};
fix$10746.$exists = function(v$9999){lab$exists: while (true) {if (v$9999 == null) {return false;
} else {var v$10000 = v$9999;
var v$10001 = v$10000[0];
var v$10002 = v$10000[1];
if (v$10001 == name$9997) {return true;
} else {var t$10747 = v$10002;
var v$9999 = t$10747;
continue lab$exists;
};
};
};
};
var exists$9998 = fix$10746.$exists;
t$10748 = (exists$9998(smltojs0$0SmlToJsCompApp$1$2.alldirs$1406[0]));
if (t$10748) {var t$10749 = f$9995;
var f$9995 = t$10749;
continue lab$suggest;
} else {return name$9997;
};
};
};
var suggest$9994 = fix$10745.$suggest;
t$10750 = (suggest$9994(function(num$10003){return "Folder-" + (basis$0Int32$1.toString$458(num$10003));
}));
return t$10755(t$10754,t$10753,t$10752,t$10751,t$10750,function(v$10086){return smltojs0$0SmlToJsCompApp$1$2.newFolder$1849(fts$2662,v$10086);
});
}]);
return v$9043(function(v$9044){var v$9045 = (dojo$0dojo$1.item$827(v$9027[0],v$9027[1]))(["Move",[0,dojo$0dojo$1.paste$3236],function(v$9046){var path$9047 = smltojs0$0SmlToJsCompApp$1$2.current$1408[0];
var v$9048 = smltojs0$0SmlToJsCompApp$1$2.splitPath$1410(path$9047);
var v$9049 = v$9048[1];
switch (v$9049[0]) { case 0: {var v$9050 = v$9048[0];
var v$9051 = v$9049[1];
return smltojs0$0SmlToJsCompApp$1$2.withDialog$2327("Move","Move/Rename File",function(v$9052){var v$9053 = v$9052[0];
var v$9054 = v$9052[1];
closetab$2665(path$9047);
return ((smltojs0$0SmlToJsCompApp$1$2.addEditorTab$2285(tabs$2659[0],tabs$2659[1]))(v$9053))(v$9054);
},"New name",v$9051,function(v$10090){return smltojs0$0SmlToJsCompApp$1$2.move$2103(fts$2662,v$9050,v$9051,v$10090);
});
 break; }default: {return notify0$1026("#dd8888",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,"Renaming of folders not supported");
} };
}]);
return v$9045(function(v$9055){var v$9056 = (dojo$0dojo$1.item$827(v$9027[0],v$9027[1]))(["Delete",[0,dojo$0dojo$1.delete$3237],function(v$10093){return smltojs0$0SmlToJsCompApp$1$2.menuHandle_FilesDelete$2493(fts$2662,closetab$2665,v$10093);
}]);
return v$9056(function(v$9057){var v$9058 = (dojo$0dojo$1.item$827(v$9027[0],v$9027[1]))(["Export (zip)",[0,dojo$0dojo$1.indent$3252],function(v$9059){var v$10133 = document.createTextNode("Not yet implemented");
return smltojs0$0SmlToJsCompApp$1$2.infoDialog$2410("Ok","Files Export to Zip",v$10133);
}]);
return v$9058(function(v$9060){var v$9061 = (dojo$0dojo$1.item$827(v$9027[0],v$9027[1]))(["Import (zip)",[0,dojo$0dojo$1.outdent$3253],function(v$9062){var v$10135 = document.createTextNode("Not yet implemented");
return smltojs0$0SmlToJsCompApp$1$2.infoDialog$2410("Ok","Files Import from Zip",v$10135);
}]);
return v$9061(function(v$9063){var v$9064;
switch (smltojs0$0SmlToJsCompApp$1$1.demoinput$76[0]) { case 1: {var a$9065 = 0;
v$9064 = (function(f$9066){return f$9066(a$9065);
});
 break; }default: {var v$9067 = smltojs0$0SmlToJsCompApp$1$1.demoinput$76[1];
v$9064 = ((dojo$0dojo$1.item$827(v$9027[0],v$9027[1]))(["Open Demo File",[1],function(v$9068){var name$9069;
var fix$10756 = {};
fix$10756.$suggest = function(f$9071){lab$suggest: while (true) {var num$9072 = [count$1749[0],(count$1749[0] = (SmlPrims.chk_ovf_i32(count$1749[0] + 1)),0)][0];
var name$9073 = f$9071(num$9072);
var t$10759;
var fix$10757 = {};
fix$10757.$exists = function(v$9075){lab$exists: while (true) {if (v$9075 == null) {return false;
} else {var v$9076 = v$9075;
var v$9077 = v$9076[0];
var v$9078 = v$9076[1];
if (v$9077 == name$9073) {return true;
} else {var t$10758 = v$9078;
var v$9075 = t$10758;
continue lab$exists;
};
};
};
};
var exists$9074 = fix$10757.$exists;
t$10759 = (exists$9074(smltojs0$0SmlToJsCompApp$1$2.allfiles$1405[0]));
if (t$10759) {var t$10760 = f$9071;
var f$9071 = t$10760;
continue lab$suggest;
} else {return name$9073;
};
};
};
var suggest$9070 = fix$10756.$suggest;
name$9069 = (suggest$9070(function(num$9079){return ("Demo-" + (basis$0Int32$1.toString$458(num$9079))) + ".sml";
}));
var path$9080 = smltojs0$0SmlToJsCompApp$1$2.newFile$1831(fts$2662,v$9067,name$9069);
return ((smltojs0$0SmlToJsCompApp$1$2.addEditorTab$2285(tabs$2659[0],tabs$2659[1]))(path$9080))(v$9067);
}]));
} };
return v$9064(function(v$9081){var v$9082;
switch (smltojs0$0SmlToJsCompApp$1$1.dropboxKey$210[0]) { case 1: {var a$9083 = 0;
v$9082 = (function(f$9084){return f$9084(a$9083);
});
 break; }default: {var v$9085 = smltojs0$0SmlToJsCompApp$1$1.dropboxKey$210[1];
var v$9086 = (dojo$0dojo$1.menu$801(v$9024[0],v$9024[1]))("Dropbox");
v$9082 = (function(c$9087){return v$9086(function(v$9088){var f$9089 = function(v$9090){var c$9091 = (function(k){return new Dropbox.Client({key:k});})(v$9085);
(function(c,f){c.authenticate({interactive:false}, f);})(c$9091,function(v$9092){return 0;
});
if ((function(obj){return obj.isAuthenticated();})(c$9091)) {smltojs0$0SmlToJsCompApp$1$2.load$1607(c$9091,fts$2662);
var s$9093 = "Dropbox authenticated with userid " + ((function(obj){return obj.dropboxUid();})(c$9091));
notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,s$9093);
var s$9094;
var t$10766;
var t$10765;
var t$10764;
var t$10763 = basis$0Date$1.fmt$816;
var t$10762 = "%H:%M:%S";
var t$10761;
var v$10028 = SmlPrims.getrealtime();
t$10761 = (basis$0Date$1.fromTimeLocal$512(v$10028[0],v$10028[1]));
t$10764 = (t$10763(t$10762,t$10761));
t$10765 = (t$10764 + ": ");
t$10766 = (t$10765 + s$9093);
s$9094 = (t$10766 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$9094));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
(function(e,a,b){return e.setAttribute(a,b);})(smltojs0$0SmlToJsCompApp$1$2.dropboxAreaElem$981,"src","dropbox.png");
} else {notify0$1026("#88dd88",smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980,"Not dropbox authenticated");
var s$9095;
var t$10772;
var t$10771;
var t$10770;
var t$10769 = basis$0Date$1.fmt$816;
var t$10768 = "%H:%M:%S";
var t$10767;
var v$10029 = SmlPrims.getrealtime();
t$10767 = (basis$0Date$1.fromTimeLocal$512(v$10029[0],v$10029[1]));
t$10770 = (t$10769(t$10768,t$10767));
t$10771 = (t$10770 + ": ");
t$10772 = (t$10771 + "Not dropbox authenticated");
s$9095 = (t$10772 + "\n");
(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.logarea$975,document.createTextNode(s$9095));
(function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.logarea$975);
};
var m$9096;
var v$9097 = (dojo$0dojo$1.item$827(v$9088[0],v$9088[1]))(["Sign in",[0,dojo$0dojo$1.createLink$3272],function(v$10095){return smltojs0$0SmlToJsCompApp$1$2.menuHandle_DropboxSignIn$2578(v$9085,v$10095);
}]);
m$9096 = (function(c$9098){return v$9097(function(v$9099){return ((dojo$0dojo$1.item$827(v$9088[0],v$9088[1]))(["Sign out",[0,dojo$0dojo$1.unlink$3273],function(v$10099){return smltojs0$0SmlToJsCompApp$1$2.menuHandle_DropboxSignOut$2601(c$9091,fts$2662,closetab$2665,v$10099);
}]))(c$9098);
});
});
return m$9096(function(x$9100){return x$9100;
});
};
var head$9101 = (function(s){return document.getElementsByTagName(s)[0];})("head");
var script$9102 = document.createElement("script");
(function(fp,s,v){fp[s] = v;})(script$9102,"type","text/javascript");
(function(fp,s,v){fp[s] = v;})(script$9102,"src","https://www.dropbox.com/static/api/dropbox-datastores-1.0-latest.js");
(function(fp,s,v){fp[s] = v;})(script$9102,"onreadystatechange",function(v$10166){return f$9089(v$10166);
});
(function(fp,s,v){fp[s] = v;})(script$9102,"onload",function(v$10167){return f$9089(v$10167);
});
(function(e,a){return e.appendChild(a);})(head$9101,script$9102);
var a$9103 = 0;
return c$9087(a$9103);
});
});
} };
return v$9082(function(v$9104){var v$9105 = (dojo$0dojo$1.item$827(v$9024[0],v$9024[1]))(["Compile->Run",[1],function(v$10168){return smltojs0$0SmlToJsCompApp$1$2.menuHandle_CompileAndRun$2626(v$10168);
}]);
return v$9105(function(v$9106){var v$9107 = (dojo$0dojo$1.item$827(v$9024[0],v$9024[1]))(["Clear output",[1],function(v$9108){var fix$10773 = {};
fix$10773.$whileSome = function(g$9110){lab$whileSome: while (true) {var v$9111 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.outarea$973);
switch (v$9111[0]) { case 0: {var v$9112 = v$9111[1];
g$9110(v$9112);
var t$10774 = g$9110;
var g$9110 = t$10774;
continue lab$whileSome;
 break; }default: {return 0;
} };
};
};
var whileSome$9109 = fix$10773.$whileSome;
return whileSome$9109(function(e$9113){return (function(e,a){return e.removeChild(a);})(smltojs0$0SmlToJsCompApp$1$2.outarea$973,e$9113);
});
}]);
return v$9107(function(v$9114){var v$9115;
var h$9116 = [["region","left"],[["style","padding:0;padding-right:10;background-color:#eeeeee;"],null]];
v$9115 = (function(f$9117){return (function(s,f){require([s,'dojo/domReady!'],f);})("dijit/layout/ContentPane",function(Cp$9118){var p$9119;
var t$10780 = Cp$9118;
var t$10779;
var fix$10775 = {};
fix$10775.$foldl = function(v$9121,v$9122){lab$foldl: while (true) {if (v$9122 == null) {return v$9121;
} else {var v$9123 = v$9122;
var v$9124 = v$9123[0];
var v$9125 = v$9123[1];
var t$10776;
var v$9126 = v$9124[0];
var v$9127 = v$9124[1];
(function(fp,s,v){fp[s] = v;})(v$9121,v$9126,v$9127);
t$10776 = v$9121;
var t$10777 = t$10776;
var t$10778 = v$9125;
var v$9121 = t$10777;
var v$9122 = t$10778;
continue lab$foldl;
};
};
};
var foldl$9120 = fix$10775.$foldl;
var v$10100 = (function(){return {};})();
t$10779 = (foldl$9120(v$10100,h$9116));
p$9119 = ((function(c,h){return new c(h);})(t$10780,t$10779));
(function(w,e){w.set('content', e);})(p$9119,smltojs0$0SmlToJsCompApp$1$2.logo$1293);
return f$9117(p$9119);
});
});
return v$9115(function(v$9128){var v$9129;
var h$9130 = [["region","right"],[smltojs0$0SmlToJsCompApp$1$2.menuStyle$1294,null]];
v$9129 = (function(f$9131){return (function(s,f){require([s,'dojo/domReady!'],f);})("dijit/MenuBar",function(MenuBar$9132){var menubar$9133;
var t$10786 = MenuBar$9132;
var t$10785;
var fix$10781 = {};
fix$10781.$foldl = function(v$9135,v$9136){lab$foldl: while (true) {if (v$9136 == null) {return v$9135;
} else {var v$9137 = v$9136;
var v$9138 = v$9137[0];
var v$9139 = v$9137[1];
var t$10782;
var v$9140 = v$9138[0];
var v$9141 = v$9138[1];
(function(fp,s,v){fp[s] = v;})(v$9135,v$9140,v$9141);
t$10782 = v$9135;
var t$10783 = t$10782;
var t$10784 = v$9139;
var v$9135 = t$10783;
var v$9136 = t$10784;
continue lab$foldl;
};
};
};
var foldl$9134 = fix$10781.$foldl;
var v$10102 = (function(){return {};})();
t$10785 = (foldl$9134(v$10102,h$9130));
menubar$9133 = ((function(c,h){return new c(h);})(t$10786,t$10785));
return f$9131([menubar$9133,[menubar$9133,true]]);
});
});
return v$9129(function(v$9142){var v$9143 = v$9142[0];
var v$9144 = v$9142[1];
var v$9145 = (dojo$0dojo$1.menu$801(v$9144[0],v$9144[1]))("Help");
return v$9145(function(v$9146){var v$9147 = (dojo$0dojo$1.item$827(v$9146[0],v$9146[1]))(["About",[0,dojo$0dojo$1.newPage$3265],function(v$9148){var v$10137 = smltojs0$0SmlToJsCompApp$1$1.about$58(0);
return smltojs0$0SmlToJsCompApp$1$2.infoDialog$2410("Ok","About SMLtoJs Online",v$10137);
}]);
return v$9147(function(v$9149){var v$9150 = (dojo$0dojo$1.item$827(v$9146[0],v$9146[1]))(["Powered by...",[0,dojo$0dojo$1.newPage$3265],function(v$9151){var v$10139 = smltojs0$0SmlToJsCompApp$1$2.poweredby$2639(0);
return smltojs0$0SmlToJsCompApp$1$2.infoDialog$2410("Ok","Powered by...",v$10139);
}]);
return v$9150(function(v$9152){return ((dojo$0dojo$1.layoutContainer$316([["region","top"],[["style","height:30px;"],null]]))([v$9128,[v$9023,[v$9143,null]]]))(c$5100);
});
});
});
});
});
});
});
});
});
});
});
});
});
});
});
});
});
};
};
smltojs0$0SmlToJsCompApp$1$2.everything$2752;
var v$6209 = dojo$0dojo$1.advTabContainer$571([["region","top"],[["splitter","true"],[["style","height:70%;border:0;"],[["tabPosition","bottom"],null]]]]);
smltojs0$0SmlToJsCompApp$1$2.everything$2752 = (function(c$5300){return v$6209(function(v$5301){var v$9881 = v$5301[0];
var v$9882 = v$5301[1];
var v$9883 = v$9882[1];
var v$9884 = v$9882[0];
var v$9885;
var v$10104 = [[["id","0"],[["name","/"],[["kind","folder"],null]]],smltojs0$0SmlToJsCompApp$1$2.ftsServer$2223];
v$9885 = (function(v$10105){return dojo$0dojo$1.treeStore$481(v$10104,v$10105);
});
return v$9885(function(v$9887){var v$9888 = (((dojo$0dojo$1.tree$567([["region","left"],[["splitter","true"],[["style","width:20%;"],null]]]))("0"))(function(v$9889){var v$9890 = v$9889[0];
var t$10787;
if (v$9890 == "0") {t$10787 = true;
} else {var fields$9891 = basis$0String$1.fields$231(function(c$9892){return c$9892 == 47;
},v$9890);
var fix$10788 = {};
fix$10788.$all = function(v$9894){lab$all: while (true) {if (v$9894 == null) {return true;
} else {var v$9895 = v$9894;
var v$9896 = v$9895[0];
var v$9897 = v$9895[1];
if (smltojs0$0SmlToJsCompApp$1$2.okFolderName$1320(v$9896)) {var t$10789 = v$9897;
var v$9894 = t$10789;
continue lab$all;
} else {return false;
};
};
};
};
var all$9893 = fix$10788.$all;
t$10787 = (all$9893(fields$9891));
};
if (t$10787) {return (smltojs0$0SmlToJsCompApp$1$2.current$1408[0] = v$9890,0);
} else {var v$9898 = smltojs0$0SmlToJsCompApp$1$2.loadFileContent$1665(v$9890);
switch (v$9898[0]) { case 0: {var v$9899 = v$9898[1];
return ((smltojs0$0SmlToJsCompApp$1$2.addEditorTab$2285(v$9881[0],v$9881[1]))(v$9890))(v$9899);
 break; }default: {return v$9883(v$9890);
} };
};
}))(v$9887);
return v$9888(function(v$9900){var v$9901 = smltojs0$0SmlToJsCompApp$1$2.menu$2656(v$9881,v$9887,v$9884);
return v$9901(function(v$9902){var v$9903;
var h$9904 = [["title","Output"],null];
v$9903 = (function(f$9905){return (function(s,f){require([s,'dojo/domReady!'],f);})("dijit/layout/ContentPane",function(Cp$9906){var p$9907;
var t$10795 = Cp$9906;
var t$10794;
var fix$10790 = {};
fix$10790.$foldl = function(v$9909,v$9910){lab$foldl: while (true) {if (v$9910 == null) {return v$9909;
} else {var v$9911 = v$9910;
var v$9912 = v$9911[0];
var v$9913 = v$9911[1];
var t$10791;
var v$9914 = v$9912[0];
var v$9915 = v$9912[1];
(function(fp,s,v){fp[s] = v;})(v$9909,v$9914,v$9915);
t$10791 = v$9909;
var t$10792 = t$10791;
var t$10793 = v$9913;
var v$9909 = t$10792;
var v$9910 = t$10793;
continue lab$foldl;
};
};
};
var foldl$9908 = fix$10790.$foldl;
var v$10106 = (function(){return {};})();
t$10794 = (foldl$9908(v$10106,h$9904));
p$9907 = ((function(c,h){return new c(h);})(t$10795,t$10794));
(function(w,e){w.set('content', e);})(p$9907,smltojs0$0SmlToJsCompApp$1$2.outareaDiv$974);
return f$9905(p$9907);
});
});
return v$9903(function(v$9916){var v$9917;
var h$9918 = [["title","Message Log"],null];
v$9917 = (function(f$9919){return (function(s,f){require([s,'dojo/domReady!'],f);})("dijit/layout/ContentPane",function(Cp$9920){var p$9921;
var t$10801 = Cp$9920;
var t$10800;
var fix$10796 = {};
fix$10796.$foldl = function(v$9923,v$9924){lab$foldl: while (true) {if (v$9924 == null) {return v$9923;
} else {var v$9925 = v$9924;
var v$9926 = v$9925[0];
var v$9927 = v$9925[1];
var t$10797;
var v$9928 = v$9926[0];
var v$9929 = v$9926[1];
(function(fp,s,v){fp[s] = v;})(v$9923,v$9928,v$9929);
t$10797 = v$9923;
var t$10798 = t$10797;
var t$10799 = v$9927;
var v$9923 = t$10798;
var v$9924 = t$10799;
continue lab$foldl;
};
};
};
var foldl$9922 = fix$10796.$foldl;
var v$10108 = (function(){return {};})();
t$10800 = (foldl$9922(v$10108,h$9918));
p$9921 = ((function(c,h){return new c(h);})(t$10801,t$10800));
(function(w,e){w.set('content', e);})(p$9921,smltojs0$0SmlToJsCompApp$1$2.logareaDiv$976);
return f$9919(p$9921);
});
});
return v$9917(function(v$9930){var v$9931 = (dojo$0dojo$1.tabContainer$314([["region","center"],[["style","height:30%;"],[["tabPosition","bottom"],null]]]))([v$9916,[v$9930,null]]);
return v$9931(function(v$9932){var v$9933 = (dojo$0dojo$1.borderContainer$315([["region","center"],null]))([v$9881[0],[v$9932,null]]);
return v$9933(function(v$9934){var v$9935;
switch (smltojs0$0SmlToJsCompApp$1$1.rightPane$212[0]) { case 0: {var v$9936 = smltojs0$0SmlToJsCompApp$1$1.rightPane$212[1];
var v$9937;
var h$9938 = [["region","right"],[["splitter","true"],null]];
var e$9939 = v$9936(0);
v$9937 = (function(f$9940){return (function(s,f){require([s,'dojo/domReady!'],f);})("dijit/layout/ContentPane",function(Cp$9941){var p$9942;
var t$10807 = Cp$9941;
var t$10806;
var fix$10802 = {};
fix$10802.$foldl = function(v$9944,v$9945){lab$foldl: while (true) {if (v$9945 == null) {return v$9944;
} else {var v$9946 = v$9945;
var v$9947 = v$9946[0];
var v$9948 = v$9946[1];
var t$10803;
var v$9949 = v$9947[0];
var v$9950 = v$9947[1];
(function(fp,s,v){fp[s] = v;})(v$9944,v$9949,v$9950);
t$10803 = v$9944;
var t$10804 = t$10803;
var t$10805 = v$9948;
var v$9944 = t$10804;
var v$9945 = t$10805;
continue lab$foldl;
};
};
};
var foldl$9943 = fix$10802.$foldl;
var v$10110 = (function(){return {};})();
t$10806 = (foldl$9943(v$10110,h$9938));
p$9942 = ((function(c,h){return new c(h);})(t$10807,t$10806));
(function(w,e){w.set('content', e);})(p$9942,e$9939);
return f$9940(p$9942);
});
});
v$9935 = (function(c$9951){return v$9937(function(v$9952){var a$9953 = [v$9952,null];
return c$9951(a$9953);
});
});
 break; }default: {var a$9954 = null;
v$9935 = (function(f$9955){return f$9955(a$9954);
});
} };
return v$9935(function(v$9956){return ((dojo$0dojo$1.borderContainer$315([["style","height: 100%; width: 100%;"],null]))(basis$0List$1.s$n$686([v$9900,[v$9902,[v$9934,null]]],v$9956)))(c$5300);
});
});
});
});
});
});
});
});
});
});
var t$10808;
var v$5393 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(js$0Js$1.document$88,"body");
switch (v$5393[0]) { case 0: {t$10808 = v$5393[1];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"getElem"];
} };
(function(e,a){return e.appendChild(a);})(t$10808,smltojs0$0SmlToJsCompApp$1$2.notifyAreaElem$980);
var t$10809;
var v$5399 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(js$0Js$1.document$88,"body");
switch (v$5399[0]) { case 0: {t$10809 = v$5399[1];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"getElem"];
} };
(function(e,a){return e.appendChild(a);})(t$10809,smltojs0$0SmlToJsCompApp$1$2.dropboxAreaElem$981);
var t$10811 = dojo$0dojo$1.attachToElement$201;
var t$10810;
var v$5403 = (function(d,id){return SmlPrims.option(d.getElementById(id));})(js$0Js$1.document$88,"body");
switch (v$5403[0]) { case 0: {t$10810 = v$5403[1];
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"getElem"];
} };
t$10811(t$10810,smltojs0$0SmlToJsCompApp$1$2.everything$2752,function(v$2823){return 0;
});
smltojs0$0SmlToJsCompApp$1$2.onload$2803 = function(v$2805){var v$5407 = (function(e){return SmlPrims.option(e.firstChild);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111);
switch (v$5407[0]) { case 0: {var v$5408 = v$5407[1];
var v$5409 = (function(e){return SmlPrims.option(e.nextSibling);})(v$5408);
switch (v$5409[0]) { case 0: {var v$5410 = v$5409[1];
var v$5411 = (function(e){return SmlPrims.option(e.nextSibling);})(v$5410);
switch (v$5411[0]) { case 0: {(function(e,a){return e.removeChild(a);})(smltojs0$0SmlToJsCompApp$1$2.topelem$1111,v$5411[1]);
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"cleanupBody"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"cleanupBody2"];
} };
 break; }default: {throw [basis$0Initial$1.en$Fail$54,"cleanupBody3"];
} };
(smltojs0$0SmlToJsCompApp$1$2.outRef$1053[0] = (function(s$5416){(function(e,a){return e.appendChild(a);})(smltojs0$0SmlToJsCompApp$1$2.outarea$973,document.createTextNode(s$5416));
return (function(t){t.scrollTop = t.scrollHeight;})(smltojs0$0SmlToJsCompApp$1$2.outarea$973);
}),0);
smltojs0$0SmlToJsCompApp$1$1.onloadhook$155(function(s$5421){return smltojs0$0SmlToJsCompApp$1$2.outRef$1053[0](s$5421);
});
(function(i,f){return setInterval(f,i);})(10000,function(v$5424){var fix$10812 = {};
fix$10812.$app = function(v$5426){lab$app: while (true) {if (v$5426 == null) {return 0;
} else {var v$5427 = v$5426;
var v$5428 = v$5427[0];
var v$5429 = v$5427[1];
smltojs0$0SmlToJsCompApp$1$2.saveFile$2023(v$5428[0],v$5428[1],v$5428[2]);
var t$10813 = v$5429;
var v$5426 = t$10813;
continue lab$app;
};
};
};
var app$5425 = fix$10812.$app;
return app$5425(smltojs0$0SmlToJsCompApp$1$2.filesInTabs$1409[0]);
});
return 0;
};
smltojs0$0SmlToJsCompApp$1$2.setWindowOnload$2812 = function(f$2815){return (function(a){return window.onload=a;})(f$2815);
};
(function(a){return window.onload=a;})(function(v$10169){return smltojs0$0SmlToJsCompApp$1$2.onload$2803(v$10169);
});
return 0;
})();
